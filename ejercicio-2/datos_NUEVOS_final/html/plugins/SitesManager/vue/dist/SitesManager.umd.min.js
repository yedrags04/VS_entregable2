(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["SitesManager"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["SitesManager"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,a){return function(e){var t={};function a(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,a),r.l=!0,r.exports}return a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(i,r,function(t){return e[t]}.bind(null,r));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="plugins/SitesManager/vue/dist/",a(a.s="fae3")}({"19dc":function(t,a){t.exports=e},"8bbf":function(e,a){e.exports=t},a5a2:function(e,t){e.exports=a},fae3:function(e,t,a){"use strict";if(a.r(t),a.d(t,"SiteTypesStore",(function(){return d})),a.d(t,"CurrencyStore",(function(){return b})),a.d(t,"TimezoneStore",(function(){return g})),a.d(t,"SitesManagement",(function(){return Re})),a.d(t,"ManageGlobalSettings",(function(){return Ct})),a.d(t,"ExcludeQueryParameterSettings",(function(){return Tt})),a.d(t,"SiteWithoutData",(function(){return Wt})),"undefined"!==typeof window){var i=window.document.currentScript,r=i&&i.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);r&&(a.p=r[1])}var n=a("8bbf"),l=a("19dc");function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */const{$:o}=window;class c{constructor(){s(this,"state",Object(n["reactive"])({isLoading:!1,typesById:{}})),s(this,"typesById",Object(n["computed"])(()=>Object(n["readonly"])(this.state).typesById)),s(this,"isLoading",Object(n["computed"])(()=>Object(n["readonly"])(this.state).isLoading)),s(this,"types",Object(n["computed"])(()=>Object.values(this.typesById.value))),s(this,"response",void 0)}init(){return this.fetchAvailableTypes()}fetchAvailableTypes(){return this.response?Promise.resolve(this.response):(this.state.isLoading=!0,this.response=l["AjaxHelper"].fetch({method:"API.getAvailableMeasurableTypes",filter_limit:"-1"}).then(e=>(e.forEach(e=>{this.state.typesById[e.id]=e}),this.types.value)).finally(()=>{this.state.isLoading=!1}),this.response)}getEditSiteIdParameter(){const e=l["MatomoUrl"].hashQuery.value.match(/editsiteid=([0-9]+)/);if(!e)return;const t="1"===l["MatomoUrl"].urlParsed.value.showaddsite||"true"===l["MatomoUrl"].urlParsed.value.showaddsite,a=e[1];return a&&o.isNumeric(a)&&!t?a:void 0}removeEditSiteIdParameterFromHash(){const e=Object.assign({},l["MatomoUrl"].hashParsed.value);delete e.editsiteid,l["MatomoUrl"].updateHash(e)}}var d=new c;function u(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */class m{constructor(){u(this,"privateState",Object(n["reactive"])({isLoading:!1,currencies:{}})),u(this,"currencies",Object(n["computed"])(()=>Object(n["readonly"])(this.privateState).currencies)),u(this,"isLoading",Object(n["computed"])(()=>Object(n["readonly"])(this.privateState).isLoading)),u(this,"initializePromise",null)}init(){return this.initializePromise||(this.initializePromise=this.fetchCurrencies()),this.initializePromise}fetchCurrencies(){return this.privateState.isLoading=!0,l["AjaxHelper"].fetch({method:"SitesManager.getCurrencyList"}).then(e=>{this.privateState.currencies=e}).finally(()=>{this.privateState.isLoading=!1})}}var b=new m;function h(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */class p{constructor(){h(this,"privateState",Object(n["reactive"])({isLoading:!1,timezones:[],timezoneSupportEnabled:!1})),h(this,"state",Object(n["computed"])(()=>Object(n["readonly"])(this.privateState))),h(this,"timezones",Object(n["computed"])(()=>this.state.value.timezones)),h(this,"timezoneSupportEnabled",Object(n["computed"])(()=>this.state.value.timezoneSupportEnabled)),h(this,"isLoading",Object(n["computed"])(()=>this.state.value.isLoading)),h(this,"initializePromise",null)}init(){return this.initializePromise||(this.privateState.isLoading=!0,this.initializePromise=Promise.all([this.checkTimezoneSupportEnabled(),this.fetchTimezones()]).finally(()=>{this.privateState.isLoading=!1})),this.initializePromise}fetchTimezones(){return l["AjaxHelper"].fetch({method:"SitesManager.getTimezonesList"}).then(e=>{const t=[];Object.entries(e).forEach(([e,a])=>{Object.entries(a).forEach(([a,i])=>{t.push({group:e,label:a,code:i})})}),this.privateState.timezones=t})}checkTimezoneSupportEnabled(){return l["AjaxHelper"].fetch({method:"SitesManager.isTimezoneSupportEnabled"}).then(e=>{this.privateState.timezoneSupportEnabled=e.value})}}var g=new p;const S={class:"SitesManager",ref:"root"},O={class:"sites-manager-header"},j=["innerHTML"],y=Object(n["createElementVNode"])("br",null,null,-1),v=["innerHTML"],f={class:"loadingPiwik"},E={class:"ui-confirm add-site-dialog"},x={class:"center"},N=Object(n["createElementVNode"])("br",null,null,-1),V={class:"card-row"},M={class:"center"},T=["title","onClick"],P={class:"ui-button-text"},C={class:"sitesManagerList"},w={key:0},D={class:"bottomButtonBar"};function k(e,t,a,i,r,l){const s=Object(n["resolveComponent"])("EnrichedHeadline"),o=Object(n["resolveComponent"])("MatomoLoader"),c=Object(n["resolveComponent"])("ButtonBar"),d=Object(n["resolveComponent"])("ContentBlock"),u=Object(n["resolveComponent"])("MatomoDialog"),m=Object(n["resolveComponent"])("SiteFields"),b=Object(n["resolveDirective"])("content-intro");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",S,[Object(n["createElementVNode"])("div",O,[Object(n["withDirectives"])((Object(n["openBlock"])(),Object(n["createElementBlock"])("div",null,[Object(n["withDirectives"])(Object(n["createElementVNode"])("h2",null,[Object(n["createVNode"])(s,{"help-url":e.externalRawLink("https://matomo.org/docs/manage-websites/"),"feature-name":e.translate("SitesManager_WebsitesManagement")},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.headlineText),1)]),_:1},8,["help-url","feature-name"])],512),[[n["vShow"],e.availableTypes.length]]),Object(n["createElementVNode"])("p",null,[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.translate("SitesManager_MainDescription"))+" ",1),Object(n["createElementVNode"])("span",{innerHTML:e.$sanitize(e.mainDescription)},null,8,j),Object(n["withDirectives"])(Object(n["createElementVNode"])("span",null,[y,Object(n["createElementVNode"])("span",{innerHTML:e.$sanitize(e.superUserAccessMessage)},null,8,v)],512),[[n["vShow"],e.hasSuperUserAccess]])])])),[[b]])]),Object(n["createElementVNode"])("div",null,[Object(n["createElementVNode"])("div",{class:Object(n["normalizeClass"])({hide_only:!e.isLoading})},[Object(n["createElementVNode"])("div",f,[Object(n["createVNode"])(o),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("General_LoadingData")),1)])],2)]),Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(c,{"site-is-being-edited":e.isSiteBeingEdited,"has-prev":e.hasPrev,hasNext:e.hasNext,"offset-start":e.offsetStart,"offset-end":e.offsetEnd,"total-number-of-sites":e.totalNumberOfSites,"is-loading":e.isLoading,"search-term":e.searchTerm,"is-searching":!!e.activeSearchTerm,"onUpdate:searchTerm":t[0]||(t[0]=t=>e.searchTerm=t),onAdd:t[1]||(t[1]=t=>e.addNewEntity()),onSearch:t[2]||(t[2]=t=>e.searchSites(t)),onPrev:t[3]||(t[3]=t=>e.previousPage()),onNext:t[4]||(t[4]=t=>e.nextPage())},null,8,["site-is-being-edited","has-prev","hasNext","offset-start","offset-end","total-number-of-sites","is-loading","search-term","is-searching"])]),Object(n["createVNode"])(u,{modelValue:e.showAddSiteDialog,"onUpdate:modelValue":t[5]||(t[5]=t=>e.showAddSiteDialog=t)},{default:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",E,[Object(n["createElementVNode"])("div",null,[Object(n["createElementVNode"])("h2",null,Object(n["toDisplayString"])(e.translate("SitesManager_ChooseMeasurableTypeHeadline")),1),Object(n["createElementVNode"])("div",x,[Object(n["createElementVNode"])("p",null,Object(n["toDisplayString"])(e.subheaderText),1),N]),Object(n["createElementVNode"])("div",V,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.availableTypes,t=>(Object(n["openBlock"])(),Object(n["createBlock"])(d,{key:t.id,"content-title":t.name},{default:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("p",M,Object(n["toDisplayString"])(t.longDescription),1),Object(n["createElementVNode"])("button",{type:"button",title:t.description,class:"modal-close btn btn-block",onClick:a=>e.addSite(t.id),"aria-disabled":"false"},[Object(n["createElementVNode"])("span",P,Object(n["toDisplayString"])(t.name),1)],8,T)]),_:2},1032,["content-title"]))),128))])])])]),_:1},8,["modelValue"]),Object(n["createElementVNode"])("div",C,[e.activeSearchTerm&&0===e.sites.length&&!e.isLoading?(Object(n["openBlock"])(),Object(n["createElementBlock"])("p",w,[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.translate("SitesManager_NotFound"))+" ",1),Object(n["createElementVNode"])("strong",null,Object(n["toDisplayString"])(e.activeSearchTerm),1)])):Object(n["createCommentVNode"])("",!0),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.sites,(a,i)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:a.idsite},[Object(n["createVNode"])(m,{site:a,"timezone-support-enabled":e.timezoneSupportEnabled,"utc-time":e.utcTime,"global-settings":e.globalSettings,"privacy-manager-enabled":e.privacyManagerEnabled,onEditSite:t[6]||(t[6]=e=>this.isSiteBeingEdited=!0),onCancelEditSite:t[7]||(t[7]=t=>e.afterCancelEdit(t)),onCancelEditPrivacy:t[8]||(t[8]=t=>e.afterCancelEdit(t)),onDelete:t[9]||(t[9]=t=>e.afterDelete(t)),onSave:t=>e.afterSave(t.site,t.settingValues,i,t.isNew)},null,8,["site","timezone-support-enabled","utc-time","global-settings","privacy-manager-enabled","onSave"])]))),128))]),Object(n["createElementVNode"])("div",D,[Object(n["createVNode"])(c,{"site-is-being-edited":e.isSiteBeingEdited,"has-prev":e.hasPrev,hasNext:e.hasNext,"offset-start":e.offsetStart,"offset-end":e.offsetEnd,"total-number-of-sites":e.totalNumberOfSites,"is-loading":e.isLoading,"search-term":e.searchTerm,"is-searching":!!e.activeSearchTerm,"onUpdate:searchTerm":t[10]||(t[10]=t=>e.searchTerm=t),onAdd:t[11]||(t[11]=t=>e.addNewEntity()),onSearch:t[12]||(t[12]=t=>e.searchSites(t)),onPrev:t[13]||(t[13]=t=>e.previousPage()),onNext:t[14]||(t[14]=t=>e.nextPage())},null,8,["site-is-being-edited","has-prev","hasNext","offset-start","offset-end","total-number-of-sites","is-loading","search-term","is-searching"])])],512)}const _={class:"sitesButtonBar clearfix"},G={class:"search"},L=["value","placeholder","disabled"],A=["title"],U={class:"paging"},B=["disabled"],I={style:{cursor:"pointer"}},z={class:"counter"},H=["disabled"],F={style:{cursor:"pointer"},class:"pointer"};function Q(e,t,a,i,r,l){return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",_,[Object(n["withDirectives"])(Object(n["createElementVNode"])("a",{class:Object(n["normalizeClass"])(["btn addSite",{disabled:e.siteIsBeingEdited}]),onClick:t[0]||(t[0]=t=>e.addNewEntity()),tabindex:"1"},Object(n["toDisplayString"])(e.availableTypes.length>1?e.translate("SitesManager_AddMeasurable"):e.translate("SitesManager_AddSite")),3),[[n["vShow"],e.hasSuperUserAccess&&e.availableTypes]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",G,[Object(n["createElementVNode"])("input",{value:e.searchTerm,onKeydown:t[1]||(t[1]=t=>e.onKeydown(t)),placeholder:e.translate("Actions_SubmenuSitesearch"),type:"text",disabled:e.siteIsBeingEdited},null,40,L),Object(n["createElementVNode"])("div",{onClick:t[2]||(t[2]=t=>e.searchSite()),title:e.translate("General_ClickToSearch"),class:"search_ico icon-search"},null,8,A)],512),[[n["vShow"],e.hasPrev||e.hasNext||e.isSearching]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",U,[Object(n["createElementVNode"])("a",{class:"btn prev",disabled:!(e.hasPrev&&!e.isLoading&&!e.siteIsBeingEdited)||void 0,onClick:t[3]||(t[3]=t=>e.previousPage())},[Object(n["createElementVNode"])("span",I,"« "+Object(n["toDisplayString"])(e.translate("General_Previous")),1)],8,B),Object(n["withDirectives"])(Object(n["createElementVNode"])("span",z,[Object(n["createElementVNode"])("span",null,Object(n["toDisplayString"])(e.paginationText),1)],512),[[n["vShow"],e.hasPrev||e.hasNext]]),Object(n["createElementVNode"])("a",{class:"btn next",disabled:!(e.hasNext&&!e.isLoading&&!e.siteIsBeingEdited)||void 0,onClick:t[4]||(t[4]=t=>e.nextPage())},[Object(n["createElementVNode"])("span",F,Object(n["toDisplayString"])(e.translate("General_Next"))+" »",1)],8,H)],512),[[n["vShow"],e.hasPrev||e.hasNext]])])}var R=Object(n["defineComponent"])({props:{siteIsBeingEdited:{type:Boolean,required:!0},hasPrev:{type:Boolean,required:!0},hasNext:{type:Boolean,required:!0},offsetStart:{type:Number,required:!0},offsetEnd:{type:Number,required:!0},totalNumberOfSites:{type:Number},isLoading:{type:Boolean,required:!0},searchTerm:{type:String,required:!0},isSearching:{type:Boolean,required:!0}},emits:["add","search","prev","next","update:searchTerm"],created(){d.init(),this.onKeydown=Object(l["debounce"])(this.onKeydown,50)},computed:{hasSuperUserAccess(){return l["Matomo"].hasSuperUserAccess},availableTypes(){return d.types.value},paginationText(){let e;return e=this.isSearching?Object(l["translate"])("General_PaginationWithoutTotal",""+this.offsetStart,""+this.offsetEnd):Object(l["translate"])("General_Pagination",""+this.offsetStart,""+this.offsetEnd,null===this.totalNumberOfSites?"?":""+this.totalNumberOfSites),` ${e} `}},methods:{addNewEntity(){this.$emit("add")},searchSite(){this.siteIsBeingEdited||this.$emit("search")},previousPage(){this.$emit("prev")},nextPage(){this.$emit("next")},onKeydown(e){setTimeout(()=>{"Enter"!==e.key?this.$emit("update:searchTerm",e.target.value):this.searchSiteOnEnter(e)})},searchSiteOnEnter(e){e.preventDefault(),this.searchSite()}}});R.render=Q;var $=R;const W=["idsite","type"],K={class:"card-content"},q={key:0,class:"row"},Y={class:"col m3"},X={class:"title"},J={class:"title"},Z=["target","title","href"],ee={class:"col m4"},te={class:"title"},ae={class:"title"},ie={class:"title"},re={class:"title"},ne={class:"col m4"},le={class:"title"},se=["href"],oe={key:0},ce={class:"title"},de={key:1},ue={class:"title"},me={key:2},be={class:"title"},he={class:"col m1 right-align"},pe=["title"],ge=Object(n["createElementVNode"])("span",{class:"icon-edit"},null,-1),Se=[ge],Oe=["title"],je=Object(n["createElementVNode"])("span",{class:"icon-delete"},null,-1),ye=[je],ve={key:1},fe={class:"form-group row"},Ee={class:"col s12 m6 input-field"},xe=["placeholder"],Ne=Object(n["createElementVNode"])("div",{class:"col s12 m6"},null,-1),Ve=["id"],Me={key:0},Te=Object(n["createElementVNode"])("br",null,null,-1),Pe=Object(n["createElementVNode"])("br",null,null,-1),Ce={class:""},we={class:"editingSiteFooter"},De=["disabled","value"],ke=["disabled"],_e=["innerHTML"];function Ge(e,t,a,i,r,l){var s,o,c;const d=Object(n["resolveComponent"])("ActivityIndicator"),u=Object(n["resolveComponent"])("GroupedSettings"),m=Object(n["resolveComponent"])("Field"),b=Object(n["resolveComponent"])("PasswordConfirmation");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{class:Object(n["normalizeClass"])(["site card hoverable",{editingSite:e.editMode}]),idsite:e.theSite.idsite,type:e.theSite.type,ref:"root"},[Object(n["createElementVNode"])("div",K,[e.editMode?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",q,[Object(n["createElementVNode"])("div",Y,[Object(n["createElementVNode"])("h4",null,Object(n["toDisplayString"])(e.theSite.name),1),Object(n["createElementVNode"])("ul",null,[Object(n["createElementVNode"])("li",null,[Object(n["createElementVNode"])("span",X,Object(n["toDisplayString"])(e.translate("General_Id"))+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.theSite.idsite),1)]),Object(n["withDirectives"])(Object(n["createElementVNode"])("li",null,[Object(n["createElementVNode"])("span",J,Object(n["toDisplayString"])(e.translate("SitesManager_Type"))+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.currentType.name),1)],512),[[n["vShow"],e.availableTypes.length>1]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("li",null,[Object(n["createElementVNode"])("a",{target:e.isInternalSetupUrl?"_self":"_blank",title:e.translate("SitesManager_ShowTrackingTag"),href:e.setupUrl},Object(n["toDisplayString"])(e.translate("SitesManager_ShowTrackingTag")),9,Z)],512),[[n["vShow"],e.theSite.idsite&&e.howToSetupUrl]])])]),Object(n["createElementVNode"])("div",ee,[Object(n["createElementVNode"])("ul",null,[Object(n["createElementVNode"])("li",null,[Object(n["createElementVNode"])("span",te,Object(n["toDisplayString"])(e.translate("SitesManager_Timezone"))+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.theSite.timezone_name),1)]),Object(n["createElementVNode"])("li",null,[Object(n["createElementVNode"])("span",ae,Object(n["toDisplayString"])(e.translate("SitesManager_Currency"))+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.theSite.currency_name),1)]),Object(n["withDirectives"])(Object(n["createElementVNode"])("li",null,[Object(n["createElementVNode"])("span",ie,Object(n["toDisplayString"])(e.translate("Goals_Ecommerce"))+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("General_Yes")),1)],512),[[n["vShow"],1===e.theSite.ecommerce||"1"===e.theSite.ecommerce]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("li",null,[Object(n["createElementVNode"])("span",re,Object(n["toDisplayString"])(e.translate("Actions_SubmenuSitesearch"))+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("General_Yes")),1)],512),[[n["vShow"],1===e.theSite.sitesearch||"1"===e.theSite.sitesearch]])])]),Object(n["createElementVNode"])("div",ne,[Object(n["createElementVNode"])("ul",null,[Object(n["createElementVNode"])("li",null,[Object(n["createElementVNode"])("span",le,Object(n["toDisplayString"])(e.translate("SitesManager_Urls")),1),Object(n["createTextVNode"])(": "),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.theSite.alias_urls,(t,a)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",{key:t},[Object(n["createElementVNode"])("a",{target:"_blank",rel:"noreferrer noopener",href:t},Object(n["toDisplayString"])(t)+Object(n["toDisplayString"])(a===e.theSite.alias_urls.length-1?"":", "),9,se)]))),128))]),null!==(s=e.theSite.excluded_ips)&&void 0!==s&&s.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",oe,[Object(n["createElementVNode"])("span",ce,Object(n["toDisplayString"])(e.translate("SitesManager_ExcludedIps"))+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.theSite.excluded_ips.split(/\s*,\s*/g).join(", ")),1)])):Object(n["createCommentVNode"])("",!0),null!==(o=e.theSite.excluded_parameters)&&void 0!==o&&o.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",de,[Object(n["createElementVNode"])("span",ue,Object(n["toDisplayString"])(e.translate("SitesManager_ExcludedParameters"))+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.theSite.excluded_parameters.split(/\s*,\s*/g).join(", ")),1)])):Object(n["createCommentVNode"])("",!0),null!==(c=e.theSite.excluded_user_agents)&&void 0!==c&&c.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",me,[Object(n["createElementVNode"])("span",be,Object(n["toDisplayString"])(e.translate("SitesManager_ExcludedUserAgents"))+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.theSite.excluded_user_agents.split(/\s*,\s*/g).join(", ")),1)])):Object(n["createCommentVNode"])("",!0)])]),Object(n["createElementVNode"])("div",he,[Object(n["createElementVNode"])("button",{class:"table-action",onClick:t[0]||(t[0]=t=>e.editSite()),title:e.translate("General_Edit")},Se,8,pe),Object(n["withDirectives"])(Object(n["createElementVNode"])("button",{class:"table-action",onClick:t[1]||(t[1]=t=>e.getMessagesToWarnOnSiteRemoval()),title:e.translate("General_Delete")},ye,8,Oe),[[n["vShow"],e.theSite.idsite]])])])),e.editMode?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ve,[Object(n["createElementVNode"])("div",fe,[Object(n["createElementVNode"])("div",Ee,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=t=>e.theSite.name=t),maxlength:"90",placeholder:e.translate("General_Name")},null,8,xe),[[n["vModelText"],e.theSite.name]]),Object(n["createElementVNode"])("label",null,Object(n["toDisplayString"])(e.translate("General_Name")),1)]),Ne]),Object(n["createVNode"])(d,{loading:e.isLoading},null,8,["loading"]),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.measurableSettings,t=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:t.pluginName},[Object(n["createVNode"])(u,{"group-name":t.pluginName,settings:t.settings,"all-setting-values":e.settingValues,onChange:a=>e.settingValues[`${t.pluginName}.${a.name}`]=a.value},null,8,["group-name","settings","all-setting-values","onChange"])]))),128)),Object(n["createVNode"])(m,{uicontrol:"select",name:"currency",modelValue:e.theSite.currency,"onUpdate:modelValue":t[3]||(t[3]=t=>e.theSite.currency=t),title:e.translate("SitesManager_Currency"),"inline-help":e.translate("SitesManager_CurrencySymbolWillBeUsedForGoals"),options:e.currencies},null,8,["modelValue","title","inline-help","options"]),Object(n["createVNode"])(m,{uicontrol:"select",name:"timezone",modelValue:e.theSite.timezone,"onUpdate:modelValue":t[4]||(t[4]=t=>e.theSite.timezone=t),title:e.translate("SitesManager_Timezone"),"inline-help":"#timezoneHelpText-"+e.theSite.idsite,options:e.timezones},null,8,["modelValue","title","inline-help","options"]),Object(n["createElementVNode"])("div",{id:"timezoneHelpText-"+e.theSite.idsite,class:"inline-help-node"},[Object(n["createElementVNode"])("div",null,[e.timezoneSupportEnabled?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",Me,[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.translate("SitesManager_AdvancedTimezoneSupportNotFound"))+" ",1),Te])),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.utcTimeIs)+" ",1),Pe,Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("SitesManager_ChangingYourTimezoneWillOnlyAffectDataForward")),1)])],8,Ve),e.privacyManagerEnabled&&e.theSite&&e.theSite.idsite?(Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],{key:0},[Object(n["createElementVNode"])("h3",Ce,Object(n["toDisplayString"])(e.translate("PrivacyManager_TrackingDataAnonymizationSettings")),1),Object(n["createVNode"])(d,{loading:e.isLoadingPrivacy},null,8,["loading"]),e.isLoadingPrivacy?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createBlock"])(Object(n["resolveDynamicComponent"])(e.anonymizeIpComponent),Object(n["mergeProps"])({key:0,"id-site-specific":e.theSite.idsite,"trigger-save":"save"==e.triggerSavePrivacySettings},e.anonymisationSettings,{onUpdated:e.onPrivacyUpdated,onAborted:e.onPrivacyAborted,onCancel:t[5]||(t[5]=t=>e.cancelEditSite(e.site))}),null,16,["id-site-specific","trigger-save","onUpdated","onAborted"]))],64)):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",we,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{disabled:e.isSaving,type:"submit",class:"btn",value:e.translate("General_Save"),onClick:t[6]||(t[6]=t=>e.saveSite())},null,8,De),[[n["vShow"],!e.isLoading]]),Object(n["createElementVNode"])("button",{class:"btn btn-link",disabled:e.isSaving,onClick:t[7]||(t[7]=t=>e.cancelEditSite(e.site))},Object(n["toDisplayString"])(e.translate("General_Cancel","","")),9,ke)])])):Object(n["createCommentVNode"])("",!0)]),Object(n["createVNode"])(b,{modelValue:e.showRemoveDialog,"onUpdate:modelValue":t[8]||(t[8]=t=>e.showRemoveDialog=t),onConfirmed:e.deleteSite,"password-field-id":"currentUserPassword-"+e.theSite.idsite},{default:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("h2",null,Object(n["toDisplayString"])(e.removeDialogTitle),1),Object(n["createElementVNode"])("p",null,Object(n["toDisplayString"])(e.translate("SitesManager_DeleteSiteExplanation")),1),e.deleteSiteExplanation?(Object(n["openBlock"])(),Object(n["createElementBlock"])("p",{key:0,innerHTML:e.$sanitize(e.deleteSiteExplanation)},null,8,_e)):Object(n["createCommentVNode"])("",!0)]),_:1},8,["modelValue","onConfirmed","password-field-id"])],10,W)}var Le=a("a5a2");const Ae=Object(n["computed"])(()=>g.timezones.value.map(({group:e,label:t,code:a})=>({group:e,key:t,value:a})));function Ue(e){return"undefined"===typeof e.idsite}var Be=Object(n["defineComponent"])({props:{site:{type:Object,required:!0},timezoneSupportEnabled:{type:Boolean},utcTime:{type:Date,required:!0},globalSettings:{type:Object,required:!0},privacyManagerEnabled:{type:Boolean,default:!1}},data(){return{isLoading:!1,isLoadingPrivacy:!1,isSaving:!1,editMode:!1,theSite:Object.assign({},this.site),measurableSettings:[],anonymisationSettings:[],settingValues:{},showRemoveDialog:!1,deleteSiteExplanation:"",triggerSavePrivacySettings:""}},components:{PasswordConfirmation:Le["PasswordConfirmation"],Field:Le["Field"],GroupedSettings:Le["GroupedSettings"],ActivityIndicator:l["ActivityIndicator"]},emits:["delete","editSite","cancelEditSite","save"],created(){b.init(),g.init(),d.init(),this.onSiteChanged()},watch:{site(){this.onSiteChanged()},measurableSettings(e){if(!e.length)return;const t={};e.forEach(e=>{e.settings.forEach(a=>{t[`${e.pluginName}.${a.name}`]=a.value})}),this.settingValues=t}},methods:{onSiteChanged(){const e=this.site;this.theSite=Object.assign({},e);const t=Ue(e);if(t){const e=this.globalSettings;this.theSite.timezone=e.defaultTimezone,this.theSite.currency=e.defaultCurrency}const a=d.getEditSiteIdParameter();(t||a&&""+e.idsite===a)&&this.editSite()},editSite(){this.editMode=!0;const e=this.theSite.idsite;if(this.$emit("editSite",{idSite:e}),this.measurableSettings=[],this.anonymisationSettings=[],Ue(this.theSite)){if(!this.currentType)return;this.measurableSettings=this.currentType.settings||[]}else this.isLoading=!0,l["AjaxHelper"].fetch({method:"SitesManager.getSiteSettings",idSite:e}).then(e=>{this.measurableSettings=e}).finally(()=>{this.isLoading=!1}),this.privacyManagerEnabled&&e&&(this.isLoadingPrivacy=!0,l["AjaxHelper"].fetch({method:"PrivacyManager.getAnonymisationSettings",idSiteSpecific:e}).then(e=>{this.anonymisationSettings=e}).finally(()=>{this.isLoadingPrivacy=!1}))},onPrivacyUpdated(){this.triggerSavePrivacySettings="done",this.anonymisationSettings=[]},onPrivacyAborted(){this.triggerSavePrivacySettings="abort",this.isSaving=!1},saveSite(){if(this.isSaving)return;this.isSaving=!0;const e={siteName:this.theSite.name,timezone:this.theSite.timezone,currency:this.theSite.currency,type:this.theSite.type,settingValues:{}},t=Ue(this.theSite);let a="SitesManager.addSite";t||(a="SitesManager.updateSite",e.idSite=this.theSite.idsite),Object.entries(this.settingValues).forEach(([t,a])=>{const[i,r]=t.split("."),n=e.settingValues;n[i]||(n[i]=[]);let l=a;!1===a?l="0":!0===a?l="1":Array.isArray(a)&&(l=a.filter(e=>!!e)),n[i].push({name:r,value:l})});const i=()=>{const a=l["NotificationsStore"].show({message:t?Object(l["translate"])("SitesManager_WebsiteCreated"):Object(l["translate"])("SitesManager_WebsiteUpdated"),context:"success",id:"websitecreated",type:"transient"});l["NotificationsStore"].scrollToNotification(a),d.removeEditSiteIdParameterFromHash(),this.isSaving=!1,this.editMode=!1,this.$emit("save",{site:this.theSite,settingValues:e.settingValues,isNew:t})},r=()=>Promise.resolve(l["AjaxHelper"].post({method:a},e)).then(e=>{!this.theSite.idsite&&e&&e.value&&(this.theSite.idsite=""+e.value);const t=g.timezones.value.find(e=>e.code===this.theSite.timezone);this.theSite.timezone_name=(null===t||void 0===t?void 0:t.label)||this.theSite.timezone,this.theSite.currency&&(this.theSite.currency_name=b.currencies.value[this.theSite.currency])});if(t)r().then(()=>{i()});else{const e=this.getTriggerPrivacySettingsSavePromise();e.then(()=>r().then(()=>{i()}).catch(()=>{this.isSaving=!1})).catch(()=>{this.isSaving=!1})}},cancelEditSite(e){this.editMode=!1,d.removeEditSiteIdParameterFromHash(),this.$emit("cancelEditSite",{site:e,element:this.$refs.root})},deleteSite(e){l["AjaxHelper"].post({idSite:this.theSite.idsite,module:"API",format:"json",method:"SitesManager.deleteSite"},{passwordConfirmation:e}).then(()=>{this.$emit("delete",this.theSite)})},getMessagesToWarnOnSiteRemoval(){l["AjaxHelper"].post({idSite:this.theSite.idsite,module:"API",format:"json",method:"SitesManager.getMessagesToWarnOnSiteRemoval"}).then(e=>{this.deleteSiteExplanation="",e.length&&(this.deleteSiteExplanation+=e.join("<br>")),this.showRemoveDialog=!0})},getTriggerPrivacySettingsSavePromise(){return new Promise((e,t)=>{const a=this.$watch("triggerSavePrivacySettings",i=>{"done"===i&&(a(),e(!0)),"abort"===i&&(a(),t())},{immediate:!1});this.triggerSavePrivacySettings="save"})}},computed:{availableTypes(){return d.types.value},setupUrl(){const e=this.theSite;let t="",a="";return this.isInternalSetupUrl&&(t=l["MatomoUrl"].stringify({idSite:e.idsite,period:l["MatomoUrl"].parsed.value.period,date:l["MatomoUrl"].parsed.value.date,updated:"false"}),a=-1===this.howToSetupUrl.indexOf("?")?"?":"&"),`${this.howToSetupUrl}${a}${t}`},utcTimeIs(){const e=this.utcTime,t=e=>e.toString().padStart(2,"0"),a=t(e.getHours()),i=t(e.getMinutes()),r=t(e.getSeconds()),n=`${Object(l["format"])(this.utcTime)} ${a}:${i}:${r}`;return Object(l["translate"])("SitesManager_UTCTimeIs",n)},timezones(){return Ae.value},currencies(){return b.currencies.value},currentType(){const e=this.site,t=d.typesById.value[e.type];return t||{name:e.type}},howToSetupUrl(){const e=this.currentType;if(e)return e.howToSetupUrl},isInternalSetupUrl(){const{howToSetupUrl:e}=this;return!!e&&"?"===(""+e).substring(0,1)},removeDialogTitle(){return Object(l["translate"])("SitesManager_DeleteConfirm",`"${this.theSite.name}" (idSite = ${this.theSite.idsite})`)},anonymizeIpComponent(){return this.privacyManagerEnabled?Object(l["useExternalPluginComponent"])("PrivacyManager","AnonymizeIp"):""}}});Be.render=Ge;var Ie=Be;function ze(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */class He{constructor(){ze(this,"privateState",Object(n["reactive"])({isLoading:!1,globalSettings:{keepURLFragmentsGlobal:!1,defaultCurrency:"",defaultTimezone:"",excludedIpsGlobal:"",excludedQueryParametersGlobal:"",excludedUserAgentsGlobal:"",excludedReferrersGlobal:"",searchKeywordParametersGlobal:"",searchCategoryParametersGlobal:"",exclusionTypeForQueryParams:""}})),ze(this,"isLoading",Object(n["computed"])(()=>Object(n["readonly"])(this.privateState).isLoading)),ze(this,"globalSettings",Object(n["computed"])(()=>Object(n["readonly"])(this.privateState).globalSettings))}init(){return this.fetchGlobalSettings()}saveGlobalSettings(e){return this.privateState.isLoading=!0,l["AjaxHelper"].post({module:"SitesManager",format:"json",action:"setGlobalSettings"},e,{withTokenInUrl:!0}).finally(()=>{this.privateState.isLoading=!1})}fetchGlobalSettings(){this.privateState.isLoading=!0,l["AjaxHelper"].fetch({module:"SitesManager",action:"getGlobalSettings"}).then(e=>{this.privateState.globalSettings=Object.assign(Object.assign({},e),{},{excludedIpsGlobal:e.excludedIpsGlobal||"",excludedQueryParametersGlobal:e.excludedQueryParametersGlobal||"",excludedUserAgentsGlobal:e.excludedUserAgentsGlobal||"",excludedReferrersGlobal:e.excludedReferrersGlobal||"",searchKeywordParametersGlobal:e.searchKeywordParametersGlobal||"",searchCategoryParametersGlobal:e.searchCategoryParametersGlobal||"",exclusionTypeForQueryParams:e.exclusionTypeForQueryParams||""})}).finally(()=>{this.privateState.isLoading=!1})}}var Fe=new He,Qe=Object(n["defineComponent"])({props:{rollUpEnabled:Boolean,privacyManagerEnabled:Boolean},components:{ButtonBar:$,ContentBlock:l["ContentBlock"],EnrichedHeadline:l["EnrichedHeadline"],MatomoDialog:l["MatomoDialog"],MatomoLoader:l["MatomoLoader"],SiteFields:Ie},directives:{ContentIntro:l["ContentIntro"]},data(){const e=new Date,t=new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());return{pageSize:10,currentPage:0,showAddSiteDialog:!1,searchTerm:"",activeSearchTerm:"",fetchedSites:[],isLoadingInitialEntities:!1,utcTime:t,totalNumberOfSites:null,isSiteBeingEdited:!1,fetchLimitedSitesAbortController:null}},created(){g.init(),d.init(),Fe.init(),this.isLoadingInitialEntities=!0,Promise.all([d.fetchAvailableTypes(),this.fetchLimitedSitesWithAdminAccess(),this.getTotalNumberOfSites()]).then(()=>{this.triggerAddSiteIfRequested()}).finally(()=>{this.isLoadingInitialEntities=!1}),Object(n["watch"])(()=>l["MatomoUrl"].hashQuery.value,()=>{this.checkGlobalSettingsHash()})},computed:{sites(){const e=this.fetchedSites.filter(e=>!e.idsite).length;return this.fetchedSites.slice(0,this.pageSize+e)},isLoading(){return!!this.fetchLimitedSitesAbortController||this.isLoadingInitialEntities||null===this.totalNumberOfSites||d.isLoading.value||g.isLoading.value||Fe.isLoading.value},availableTypes(){return d.types.value},timezoneSupportEnabled(){return g.timezoneSupportEnabled.value},globalSettings(){return Fe.globalSettings.value},headlineText(){return Object(l["translate"])("SitesManager_XManagement",this.availableTypes.length>1?Object(l["translate"])("General_Measurables"):Object(l["translate"])("SitesManager_Sites"))},subheaderText(){const e=Object(l["translate"])("SitesManager_ChooseMeasurableTypeSubheader"),t=this.rollUpEnabled?Object(l["translate"])("SitesManager_ChooseMeasurableTypeSubheaderRollUp"):"";return`${e} ${t}`.trim()},mainDescription(){return Object(l["translate"])("SitesManager_YouCurrentlyHaveAccessToNWebsites",`<strong>${this.totalNumberOfSites}</strong>`)},hasSuperUserAccess(){return l["Matomo"].hasSuperUserAccess},superUserAccessMessage(){return Object(l["translate"])("SitesManager_SuperUserAccessCan","<a href='#globalSettings'>","</a>")},hasPrev(){return this.currentPage>=1},hasNext(){return this.fetchedSites.filter(e=>!!e.idsite).length>=this.pageSize+1},offsetStart(){return this.currentPage*this.pageSize+1},offsetEnd(){return this.offsetStart+this.sites.filter(e=>!!e.idsite).length-1}},methods:{checkGlobalSettingsHash(){const e=l["MatomoUrl"].hashQuery.value;!l["Matomo"].hasSuperUserAccess||"globalSettings"!==e&&"/globalSettings"!==e||l["MatomoUrl"].updateLocation(Object.assign(Object.assign({},l["MatomoUrl"].urlParsed.value),{},{action:"globalSettings"}))},addNewEntity(){this.availableTypes.length>1?this.showAddSiteDialog=!0:1===this.availableTypes.length&&this.addSite(this.availableTypes[0].id)},addSite(e){let t=e;const a={isAllowed:!0,measurableType:t};l["Matomo"].postEvent("SitesManager.initAddSite",a),a&&!a.isAllowed||(t||(t="website"),this.fetchedSites.unshift({type:t}),this.isSiteBeingEdited=!0)},afterCancelEdit({site:e,element:t}){this.isSiteBeingEdited=!1,e.idsite?t.scrollIntoView():this.fetchedSites=this.fetchedSites.filter(e=>!!e.idsite)},fetchLimitedSitesWithAdminAccess(e=""){this.fetchLimitedSitesAbortController&&this.fetchLimitedSitesAbortController.abort(),this.fetchLimitedSitesAbortController=new AbortController;const t=this.pageSize+1,a=this.currentPage*this.pageSize,i={method:"SitesManager.getSitesWithAdminAccess",fetchAliasUrls:1,limit:t+a,filter_offset:a,filter_limit:t};return e&&(i.pattern=e),l["AjaxHelper"].fetch(i).then(e=>{this.fetchedSites=e||[]}).then(t=>(this.activeSearchTerm=e,t)).finally(()=>{this.fetchLimitedSitesAbortController=null})},getTotalNumberOfSites(){return l["AjaxHelper"].fetch({method:"SitesManager.getSitesIdWithAdminAccess",filter_limit:"-1"}).then(e=>{this.totalNumberOfSites=e.length})},triggerAddSiteIfRequested(){const e=d.getEditSiteIdParameter(),t=l["MatomoUrl"].urlParsed.value.showaddsite;"1"===t?this.addNewEntity():e&&(this.searchTerm=e,this.fetchLimitedSitesWithAdminAccess(this.searchTerm))},previousPage(){this.currentPage=Math.max(0,this.currentPage-1),this.fetchLimitedSitesWithAdminAccess(this.activeSearchTerm)},nextPage(){this.currentPage=Math.max(0,this.currentPage+1),this.fetchLimitedSitesWithAdminAccess(this.activeSearchTerm)},searchSites(){this.currentPage=0,this.fetchLimitedSitesWithAdminAccess(this.searchTerm)},afterDelete(e){let t={showaddsite:0};if(l["MatomoUrl"].urlParsed.value.idSite===""+e.idsite){const a=this.sites.find(t=>t.idsite!==e.idsite);a&&(t=Object.assign(Object.assign({},t),{},{idSite:a.idsite}))}l["Matomo"].helper.redirect(t)},afterSave(e,t,a,i){const r=["excluded_ips","excluded_parameters","excluded_user_agents","sitesearch_keyword_parameters","sitesearch_category_parameters"],n=Object.assign({},e);Object.values(t).forEach(e=>{e.forEach(e=>{"urls"===e.name?n.alias_urls=e.value:-1!==r.indexOf(e.name)?n[e.name]=e.value.join(", "):n[e.name]=e.value})}),this.fetchedSites[a]=n,i&&null!==this.totalNumberOfSites&&(this.totalNumberOfSites+=1),this.isSiteBeingEdited=!1}}});Qe.render=k;var Re=Qe;const $e={class:"SitesManager"},We=Object(n["createElementVNode"])("a",{name:"globalSettings",id:"globalSettings"},null,-1),Ke={id:"excludedIpsGlobalHelp",class:"inline-help-node"},qe=Object(n["createElementVNode"])("br",null,null,-1),Ye=Object(n["createElementVNode"])("br",null,null,-1),Xe=["innerHTML"],Je={id:"excludedUserAgentsGlobalHelp",class:"inline-help-node"},Ze=Object(n["createElementVNode"])("br",null,null,-1),et=Object(n["createElementVNode"])("br",null,null,-1),tt={id:"excludedReferrersGlobalHelp",class:"inline-help-node"},at=Object(n["createElementVNode"])("br",null,null,-1),it=Object(n["createElementVNode"])("br",null,null,-1),rt=Object(n["createElementVNode"])("br",null,null,-1),nt=Object(n["createElementVNode"])("br",null,null,-1),lt=Object(n["createElementVNode"])("br",null,null,-1),st={id:"timezoneHelp",class:"inline-help-node"},ot={key:0},ct=Object(n["createElementVNode"])("br",null,null,-1),dt=Object(n["createElementVNode"])("br",null,null,-1),ut={id:"keepURLFragmentsHelp",class:"inline-help-node"},mt=["innerHTML"],bt={class:"alert alert-info"};function ht(e,t,a,i,r,l){const s=Object(n["resolveComponent"])("Field"),o=Object(n["resolveComponent"])("ExcludeQueryParameterSettings"),c=Object(n["resolveComponent"])("SaveButton"),d=Object(n["resolveComponent"])("ContentBlock");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",$e,[Object(n["withDirectives"])(Object(n["createVNode"])(d,{"content-title":e.translate("SitesManager_GlobalWebsitesSettings")},{default:Object(n["withCtx"])(()=>[We,Object(n["createElementVNode"])("div",Ke,[Object(n["createElementVNode"])("div",null,[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.translate("SitesManager_HelpExcludedIpAddresses","1.2.3.4/24","1.2.3.*","1.2.*.*"))+" ",1),qe,Ye,Object(n["createElementVNode"])("span",{innerHTML:e.$sanitize(e.yourCurrentIpAddressIs)},null,8,Xe)])]),Object(n["createElementVNode"])("div",Je,[Object(n["createElementVNode"])("div",null,[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.translate("SitesManager_GlobalExcludedUserAgentHelp1"))+" ",1),Ze,et,Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("SitesManager_GlobalListExcludedUserAgents_Desc"))+" "+Object(n["toDisplayString"])(e.translate("SitesManager_GlobalExcludedUserAgentHelp2"))+" "+Object(n["toDisplayString"])(e.translate("SitesManager_GlobalExcludedUserAgentHelp3","/bot|spider|crawl|scanner/i")),1)])]),Object(n["createElementVNode"])("div",tt,[Object(n["createElementVNode"])("div",null,[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.translate("SitesManager_ExcludedReferrersHelp"))+" ",1),at,it,Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("SitesManager_ExcludedReferrersHelpDetails"))+" ",1),rt,Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("SitesManager_ExcludedReferrersHelpExamples","www.example.org","http://example.org/mypath","https://www.example.org/?param=1","https://sub.example.org/"))+" ",1),nt,lt,Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("SitesManager_ExcludedReferrersHelpSubDomains",".sub.example.org","http://sub.example.org/mypath","https://new.sub.example.org/")),1)])]),Object(n["createElementVNode"])("div",st,[Object(n["createElementVNode"])("div",null,[e.timezoneSupportEnabled?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",ot,[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.translate("SitesManager_AdvancedTimezoneSupportNotFound"))+" ",1),ct])),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("SitesManager_UTCTimeIs",e.utcTimeDate))+" ",1),dt,Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("SitesManager_ChangingYourTimezoneWillOnlyAffectDataForward")),1)])]),Object(n["createElementVNode"])("div",ut,[Object(n["createElementVNode"])("div",{innerHTML:e.$sanitize(e.keepUrlFragmentHelp)},null,8,mt),Object(n["createElementVNode"])("div",null,Object(n["toDisplayString"])(e.translate("SitesManager_KeepURLFragmentsHelp2")),1)]),Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(s,{uicontrol:"textarea",name:"excludedIpsGlobal","var-type":"array",modelValue:e.excludedIpsGlobal,"onUpdate:modelValue":t[0]||(t[0]=t=>e.excludedIpsGlobal=t),title:e.translate("SitesManager_ListOfIpsToBeExcludedOnAllWebsites"),introduction:e.translate("SitesManager_GlobalListExcludedIps"),"inline-help":"#excludedIpsGlobalHelp",disabled:e.isLoading},null,8,["modelValue","title","introduction","disabled"])]),Object(n["createVNode"])(o,{exclusionTypeForQueryParams:e.exclusionTypeForQueryParams,"onUpdate:exclusionTypeForQueryParams":t[1]||(t[1]=t=>e.exclusionTypeForQueryParams=t),excludedQueryParametersGlobal:e.excludedQueryParametersGlobal,"onUpdate:excludedQueryParametersGlobal":t[2]||(t[2]=t=>e.excludedQueryParametersGlobal=t),commonSensitiveQueryParams:e.commonSensitiveQueryParams},null,8,["exclusionTypeForQueryParams","excludedQueryParametersGlobal","commonSensitiveQueryParams"]),Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(s,{uicontrol:"textarea",name:"excludedUserAgentsGlobal","var-type":"array",modelValue:e.excludedUserAgentsGlobal,"onUpdate:modelValue":t[3]||(t[3]=t=>e.excludedUserAgentsGlobal=t),title:e.translate("SitesManager_GlobalListExcludedUserAgents_Desc"),introduction:e.translate("SitesManager_GlobalListExcludedUserAgents"),"inline-help":"#excludedUserAgentsGlobalHelp",disabled:e.isLoading},null,8,["modelValue","title","introduction","disabled"])]),Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(s,{uicontrol:"textarea",name:"excludedReferrersGlobal","var-type":"array",modelValue:e.excludedReferrersGlobal,"onUpdate:modelValue":t[4]||(t[4]=t=>e.excludedReferrersGlobal=t),title:e.translate("SitesManager_GlobalListExcludedReferrersDesc"),introduction:e.translate("SitesManager_GlobalListExcludedReferrers"),"inline-help":"#excludedReferrersGlobalHelp",disabled:e.isLoading},null,8,["modelValue","title","introduction","disabled"])]),Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(s,{uicontrol:"checkbox",name:"keepURLFragmentsGlobal",modelValue:e.keepURLFragmentsGlobal,"onUpdate:modelValue":t[5]||(t[5]=t=>e.keepURLFragmentsGlobal=t),title:e.translate("SitesManager_KeepURLFragmentsLong"),introduction:e.translate("SitesManager_KeepURLFragments"),"inline-help":"#keepURLFragmentsHelp",disabled:e.isLoading},null,8,["modelValue","title","introduction","disabled"])]),Object(n["createElementVNode"])("h3",null,Object(n["toDisplayString"])(e.translate("SitesManager_TrackingSiteSearch")),1),Object(n["createElementVNode"])("p",null,Object(n["toDisplayString"])(e.translate("SitesManager_SiteSearchUse")),1),Object(n["createElementVNode"])("div",bt,Object(n["toDisplayString"])(e.translate("SitesManager_SearchParametersNote"))+" "+Object(n["toDisplayString"])(e.translate("SitesManager_SearchParametersNote2")),1),Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(s,{uicontrol:"text",name:"searchKeywordParametersGlobal","var-type":"array",modelValue:e.searchKeywordParametersGlobal,"onUpdate:modelValue":t[6]||(t[6]=t=>e.searchKeywordParametersGlobal=t),title:e.translate("SitesManager_SearchKeywordLabel"),"inline-help":e.translate("SitesManager_SearchKeywordParametersDesc"),disabled:e.isLoading},null,8,["modelValue","title","inline-help","disabled"])]),Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(s,{uicontrol:"text",name:"searchCategoryParametersGlobal","var-type":"array",modelValue:e.searchCategoryParametersGlobal,"onUpdate:modelValue":t[7]||(t[7]=t=>e.searchCategoryParametersGlobal=t),title:e.translate("SitesManager_SearchCategoryLabel"),"inline-help":e.searchCategoryParamsInlineHelp,disabled:e.isLoading},null,8,["modelValue","title","inline-help","disabled"])]),Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(s,{uicontrol:"select",name:"defaultTimezone",options:e.timezoneOptions,title:e.translate("SitesManager_SelectDefaultTimezone"),introduction:e.translate("SitesManager_DefaultTimezoneForNewWebsites"),"inline-help":"#timezoneHelp",disabled:e.isLoading,modelValue:e.defaultTimezone,"onUpdate:modelValue":t[8]||(t[8]=t=>e.defaultTimezone=t)},null,8,["options","title","introduction","disabled","modelValue"])]),Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(s,{uicontrol:"select",name:"defaultCurrency",modelValue:e.defaultCurrency,"onUpdate:modelValue":t[9]||(t[9]=t=>e.defaultCurrency=t),options:e.currencies,title:e.translate("SitesManager_SelectDefaultCurrency"),introduction:e.translate("SitesManager_DefaultCurrencyForNewWebsites"),"inline-help":e.translate("SitesManager_CurrencySymbolWillBeUsedForGoals"),disabled:e.isLoading},null,8,["modelValue","options","title","introduction","inline-help","disabled"])]),Object(n["createVNode"])(c,{saving:e.isSaving,onConfirm:t[10]||(t[10]=t=>e.saveGlobalSettings())},null,8,["saving"])]),_:1},8,["content-title"]),[[n["vShow"],e.hasSuperUserAccess]])])}const pt={class:"siteManagerGlobalExcludedUrlParameters"},gt={id:"excludedQueryParametersGlobalHelp",class:"inline-help-node"},St={id:"excludedQueryParametersGlobalExclusionTypeHelp",class:"inline-help-node"},Ot=Object(n["createElementVNode"])("span",{class:"icon-chevron-down"},null,-1),jt=Object(n["createElementVNode"])("span",{class:"icon-chevron-up"},null,-1),yt={key:0},vt=Object(n["createElementVNode"])("br",null,null,-1),ft=Object(n["createElementVNode"])("br",null,null,-1),Et=Object(n["createElementVNode"])("br",null,null,-1),xt=Object(n["createElementVNode"])("br",null,null,-1),Nt=["value"];function Vt(e,t,a,i,r,l){const s=Object(n["resolveComponent"])("Field");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",pt,[Object(n["createElementVNode"])("div",gt,[Object(n["createElementVNode"])("div",null,Object(n["toDisplayString"])(e.translate("SitesManager_ListOfQueryParametersToExclude","/^sess.*|.*[dD]ate$/")),1)]),Object(n["createElementVNode"])("div",St,[Object(n["withDirectives"])(Object(n["createElementVNode"])("div",null,Object(n["toDisplayString"])(e.translate("SitesManager_ExclusionTypeDescriptionCommonSessionParameters")),513),[[n["vShow"],"common_session_parameters"===e.localExclusionTypeForQueryParams]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",null,[Object(n["createElementVNode"])("p",null,Object(n["toDisplayString"])(e.translate("SitesManager_ExclusionTypeDescriptionMatomoRecommendedPII")),1),Object(n["createElementVNode"])("div",null,[e.showListOfCommonExclusions?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("a",{key:0,href:"javascript:;",onClick:t[0]||(t[0]=Object(n["withModifiers"])(t=>e.showListOfCommonExclusions=!0,["prevent"]))},[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.translate("SitesManager_ExclusionViewListLink"))+" ",1),Ot])),e.showListOfCommonExclusions?(Object(n["openBlock"])(),Object(n["createElementBlock"])("a",{key:1,href:"javascript:;",onClick:t[1]||(t[1]=Object(n["withModifiers"])(t=>e.showListOfCommonExclusions=!1,["prevent"]))},[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.translate("SitesManager_ExclusionViewListLink"))+" ",1),jt])):Object(n["createCommentVNode"])("",!0)]),e.showListOfCommonExclusions?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",yt,Object(n["toDisplayString"])(e.commonSensitiveQueryParams.join(", ")),1)):Object(n["createCommentVNode"])("",!0),vt,ft,Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("SitesManager_MatomoWillAutomaticallyExcludeCommonSessionParametersInAddition","phpsessid, sessionid, ...")),1)],512),[[n["vShow"],"matomo_recommended_pii"===e.localExclusionTypeForQueryParams]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",null,[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.translate("SitesManager_ExclusionTypeDescriptionCustom"))+" ",1),Et,xt,Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("SitesManager_MatomoWillAutomaticallyExcludeCommonSessionParametersInAddition","phpsessid, sessionid, ...")),1)],512),[[n["vShow"],"custom"===e.localExclusionTypeForQueryParams]])]),Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(s,{uicontrol:"radio",name:"exclusionType",introduction:e.translate("SitesManager_GlobalListExcludedQueryParameters"),options:e.exclusionTypeOptions,modelValue:e.localExclusionTypeForQueryParams,"onUpdate:modelValue":t[2]||(t[2]=t=>e.localExclusionTypeForQueryParams=t),"inline-help":"#excludedQueryParametersGlobalExclusionTypeHelp"},null,8,["introduction","options","modelValue"])]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(s,{uicontrol:"textarea",name:"excludedQueryParametersGlobal","var-type":"array",class:"limited-height-scrolling-textarea",modelValue:e.localExcludedQueryParametersGlobal,"onUpdate:modelValue":t[3]||(t[3]=t=>e.localExcludedQueryParametersGlobal=t),"model-value":e.localExcludedQueryParametersGlobal.join("\n"),onInput:t[4]||(t[4]=t=>e.onInputExcludedQueryParametersGlobal(t.target.value)),title:e.translate("SitesManager_ListOfQueryParametersToBeExcludedOnAllWebsites"),"inline-help":"#excludedQueryParametersGlobalHelp"},null,8,["modelValue","model-value","title"]),Object(n["createElementVNode"])("input",{type:"button",onClick:t[5]||(t[5]=t=>e.addCommonPIIQueryParams()),class:"btn",value:e.translate("SitesManager_AddSensibleExclusionsToMyCustomListButtonText")},null,8,Nt)],512),[[n["vShow"],"custom"===e.localExclusionTypeForQueryParams]])])}var Mt=Object(n["defineComponent"])({components:{Field:Le["Field"]},props:{exclusionTypeForQueryParams:{type:String,default:"common_session_parameters"},excludedQueryParametersGlobal:{type:Array,default:()=>[]},commonSensitiveQueryParams:{type:Array,default:()=>[]}},data(){return{localExclusionTypeForQueryParams:this.exclusionTypeForQueryParams,localExcludedQueryParametersGlobal:this.excludedQueryParametersGlobal,exclusionTypeOptions:[{value:Object(l["translate"])("SitesManager_ExclusionTypeOptionCommonSessionParameters"),key:"common_session_parameters"},{value:Object(l["translate"])("SitesManager_ExclusionTypeOptionMatomoRecommendedPII"),key:"matomo_recommended_pii"},{value:Object(l["translate"])("SitesManager_ExclusionTypeOptionCustom"),key:"custom"}],showListOfCommonExclusions:!1}},watch:{exclusionTypeForQueryParams:{handler(e){this.localExclusionTypeForQueryParams=e}},localExclusionTypeForQueryParams:{handler(e){this.updateExclusionType(e)},immediate:!0},excludedQueryParametersGlobal:{handler(e){this.localExcludedQueryParametersGlobal=e}}},methods:{updateExclusionType(e){"custom"!==e&&(this.localExcludedQueryParametersGlobal=[],this.onInputExcludedQueryParametersGlobal("")),this.$emit("update:exclusionTypeForQueryParams",e)},onInputExcludedQueryParametersGlobal(e){const t=e.split("\n");this.$emit("update:excludedQueryParametersGlobal",t)},addCommonPIIQueryParams(){let e=this.localExcludedQueryParametersGlobal.filter(e=>!this.commonSensitiveQueryParams.includes(e));e=e.concat(this.commonSensitiveQueryParams),this.localExcludedQueryParametersGlobal=e,this.$emit("update:excludedQueryParametersGlobal",e)}}});Mt.render=Vt;var Tt=Mt,Pt=Object(n["defineComponent"])({components:{ExcludeQueryParameterSettings:Tt,ContentBlock:l["ContentBlock"],Field:Le["Field"],SaveButton:Le["SaveButton"]},props:{commonSensitiveQueryParams:{type:Array,default:()=>[]}},data(){const e=new Date,t=new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()),a=Fe.globalSettings.value;return{currentIpAddress:null,utcTime:t,keepURLFragmentsGlobal:a.keepURLFragmentsGlobal,defaultTimezone:a.defaultTimezone,defaultCurrency:a.defaultCurrency,excludedIpsGlobal:(a.excludedIpsGlobal||"").split(","),excludedQueryParametersGlobal:(a.excludedQueryParametersGlobal||"").split(","),excludedUserAgentsGlobal:(a.excludedUserAgentsGlobal||"").split(","),excludedReferrersGlobal:(a.excludedReferrersGlobal||"").split(","),searchKeywordParametersGlobal:(a.searchKeywordParametersGlobal||"").split(","),searchCategoryParametersGlobal:(a.searchCategoryParametersGlobal||"").split(","),isSaving:!1,exclusionTypeForQueryParams:a.exclusionTypeForQueryParams}},created(){b.init(),g.init(),Fe.init(),Object(n["watch"])(()=>Fe.globalSettings.value,e=>{this.keepURLFragmentsGlobal=e.keepURLFragmentsGlobal,this.defaultTimezone=e.defaultTimezone,this.defaultCurrency=e.defaultCurrency,this.excludedIpsGlobal=(e.excludedIpsGlobal||"").split(","),this.excludedQueryParametersGlobal=(e.excludedQueryParametersGlobal||"").split(","),this.excludedUserAgentsGlobal=(e.excludedUserAgentsGlobal||"").split(","),this.excludedReferrersGlobal=(e.excludedReferrersGlobal||"").split(","),this.searchKeywordParametersGlobal=(e.searchKeywordParametersGlobal||"").split(","),this.searchCategoryParametersGlobal=(e.searchCategoryParametersGlobal||"").split(","),this.exclusionTypeForQueryParams=e.exclusionTypeForQueryParams}),l["AjaxHelper"].fetch({method:"API.getIpFromHeader"}).then(e=>{this.currentIpAddress=e.value})},methods:{saveGlobalSettings(){this.isSaving=!0,Fe.saveGlobalSettings({keepURLFragments:this.keepURLFragmentsGlobal,currency:this.defaultCurrency,timezone:this.defaultTimezone,excludedIps:this.excludedIpsGlobal.join(","),excludedQueryParameters:this.excludedQueryParametersGlobal.join(","),excludedUserAgents:this.excludedUserAgentsGlobal.join(","),excludedReferrers:this.excludedReferrersGlobal.join(","),searchKeywordParameters:this.searchKeywordParametersGlobal.join(","),searchCategoryParameters:this.searchCategoryParametersGlobal.join(","),exclusionTypeForQueryParams:this.exclusionTypeForQueryParams}).then(()=>{l["Matomo"].helper.redirect({showaddsite:!1})}).finally(()=>{this.isSaving=!1})}},computed:{isLoading(){return Fe.isLoading.value||g.isLoading.value||b.isLoading.value},timezones(){return g.timezones.value},timezoneOptions(){return this.timezones.map(({group:e,label:t,code:a})=>({group:e,key:t,value:a}))},currencies(){return b.currencies.value},hasSuperUserAccess(){return l["Matomo"].hasSuperUserAccess},yourCurrentIpAddressIs(){return Object(l["translate"])("SitesManager_YourCurrentIpAddressIs",`<i>${this.currentIpAddress}</i>`)},timezoneSupportEnabled(){return g.timezoneSupportEnabled.value},utcTimeDate(){const{utcTime:e}=this,t=e=>e.toString().padStart(2,"0"),a=t(e.getHours()),i=t(e.getMinutes()),r=t(e.getSeconds());return`${Object(l["format"])(this.utcTime)} ${a}:${i}:${r}`},keepUrlFragmentHelp(){return Object(l["translate"])("SitesManager_KeepURLFragmentsHelp","<em>#</em>","<em>example.org/index.html#first_section</em>","<em>example.org/index.html</em>")},searchCategoryParamsInlineHelp(){const e=[Object(l["translate"])("Goals_Optional"),Object(l["translate"])("SitesManager_SearchCategoryDesc"),Object(l["translate"])("SitesManager_SearchCategoryParametersDesc")];return e.join(" ")}}});Pt.render=ht;var Ct=Pt;const wt=Object(n["createElementVNode"])("span",{class:"icon-chevron-left"},null,-1),Dt={id:"start-tracking-data-header"},kt={key:0,class:"row",id:"start-tracking-detection"},_t=["src","alt"],Gt=["href"],Lt={class:"row",id:"start-tracking-method-list"},At=Object(n["createElementVNode"])("span",{class:"icon-search"},null,-1),Ut=["href","onClick"],Bt=["src"],It={class:"list-entry-text"},zt={id:"start-tracking-skip"},Ht=["href"],Ft=["data-method"],Qt=["src","alt"];function Rt(e,t,a,i,r,l){const s=Object(n["resolveComponent"])("VueEntryContainer"),o=Object(n["resolveComponent"])("ActivityIndicator");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",null,[e.showMethodDetails?(Object(n["openBlock"])(),Object(n["createElementBlock"])("a",{key:0,id:"start-tracking-back",onClick:t[0]||(t[0]=Object(n["withModifiers"])(t=>{e.showOverview()},["prevent"]))},[wt,Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("Mobile_NavigationBack")),1)])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("h1",Dt,Object(n["toDisplayString"])(e.headline),1),Object(n["createVNode"])(s,{id:"start-tracking-cta",html:e.ctaContent},null,8,["html"]),Object(n["createVNode"])(o,{"loading-message":e.translate("SitesManager_DetectingYourSite")+"…",loading:e.loading},null,8,["loading-message","loading"]),e.loading||e.showMethodDetails?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],{key:1},[e.recommendedMethod?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",kt,[Object(n["createElementVNode"])("img",{src:e.recommendedMethod.icon,alt:e.recommendedMethod.name+" logo"},null,8,_t),Object(n["createElementVNode"])("h2",null,Object(n["toDisplayString"])(e.recommendedMethod.recommendationTitle),1),Object(n["createElementVNode"])("p",null,Object(n["toDisplayString"])(e.recommendedMethod.recommendationText),1),Object(n["createElementVNode"])("a",{href:"#"+e.recommendedMethod.id.toLowerCase(),class:"btn",id:"showMethod",onClick:t[1]||(t[1]=Object(n["withModifiers"])(t=>e.showMethod(e.recommendedMethod.id),["prevent"]))},Object(n["toDisplayString"])(e.recommendedMethod.recommendationButton),9,Gt)])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",Lt,[At,Object(n["createElementVNode"])("h2",null,Object(n["toDisplayString"])(e.translate("SitesManager_SiteWithoutDataOtherInstallMethods")),1),Object(n["createElementVNode"])("p",null,Object(n["toDisplayString"])(e.translate("SitesManager_SiteWithoutDataOtherInstallMethodsIntro")),1),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.trackingMethods,t=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{class:"list-entry",key:t.id},[Object(n["createElementVNode"])("a",{href:"#"+t.id.toLowerCase(),onClick:Object(n["withModifiers"])(a=>e.showMethod(t.id),["prevent"])},[t.icon?(Object(n["openBlock"])(),Object(n["createElementBlock"])("img",{key:0,src:t.icon,class:"list-entry-icon"},null,8,Bt)):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("span",It,Object(n["toDisplayString"])(t.name),1)],8,Ut)]))),128))])]),Object(n["createElementVNode"])("div",zt,[Object(n["createElementVNode"])("h2",null,Object(n["toDisplayString"])(e.translate("SitesManager_SiteWithoutDataNotYetReady")),1),Object(n["createElementVNode"])("div",null,Object(n["toDisplayString"])(e.translate("SitesManager_SiteWithoutDataTemporarilyHidePage")),1),Object(n["createElementVNode"])("a",{href:e.ignoreSitesWithoutDataLink,class:"ignoreSitesWithoutData"},Object(n["toDisplayString"])(e.translate("SitesManager_SiteWithoutDataHidePageForHour")),9,Ht)])],64)),e.showMethodDetails?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:2,id:"start-tracking-details","data-method":e.showMethodDetails.id},[Object(n["createElementVNode"])("img",{src:e.showMethodDetails.icon,alt:e.showMethodDetails.name+" logo"},null,8,Qt),Object(n["createVNode"])(s,{html:e.showMethodDetails.content},null,8,["html"])],8,Ft)):Object(n["createCommentVNode"])("",!0)])}var $t=Object(n["defineComponent"])({props:{ctaContent:String},components:{ActivityIndicator:l["ActivityIndicator"],VueEntryContainer:l["VueEntryContainer"]},data(){return{loading:!0,updateCheckInterval:1e3,currentInterval:1e3,maxInterval:3e4,showMethodDetails:null,recommendedMethod:null,trackingMethods:[]}},created(){const e={module:"SitesManager",action:"getTrackingMethodsForSite"};l["AjaxHelper"].fetch(e).then(e=>{this.trackingMethods=e.trackingMethods,this.recommendedMethod=e.recommendedMethod,this.loading=!1,Object(n["watch"])(()=>l["MatomoUrl"].hashParsed.value.activeTab,e=>{this.showMethodDetails=this.findTrackingMethod(e)}),l["MatomoUrl"].hashParsed.value.activeTab&&(this.showMethodDetails=this.findTrackingMethod(l["MatomoUrl"].hashParsed.value.activeTab)),this.checkIfSiteHasData()})},methods:{findTrackingMethod(e){if(this.recommendedMethod&&e&&this.recommendedMethod.id.toLowerCase()===e.toLowerCase())return this.recommendedMethod;let t=null;return Object.entries(this.trackingMethods).forEach(([,a])=>{e&&a.id.toLowerCase()===e.toLowerCase()&&(t=a)}),t},showMethod(e){l["MatomoUrl"].updateHash(Object.assign(Object.assign({},l["MatomoUrl"].hashParsed.value),{},{activeTab:e.toLowerCase()}))},showOverview(){l["MatomoUrl"].updateHash(Object.assign(Object.assign({},l["MatomoUrl"].hashParsed.value),{},{activeTab:null}))},checkIfSiteHasData(){const e={method:"Live.getMostRecentVisitsDateTime",date:"today",period:"day",idSite:l["Matomo"].idSite},t={createErrorNotification:!1};l["AjaxHelper"].fetch(e,t).then(e=>{e&&""!==e.value?window.broadcast.propagateNewPage("date=today"):(window.setTimeout(this.checkIfSiteHasData,this.currentInterval),this.currentInterval=Math.min(this.currentInterval+this.updateCheckInterval,this.maxInterval))}).catch(()=>{})}},computed:{ignoreSitesWithoutDataLink(){return"?"+l["MatomoUrl"].stringify(Object.assign(Object.assign({},l["MatomoUrl"].urlParsed.value),{},{module:"SitesManager",action:"ignoreNoDataMessage"}))},headline(){return this.showMethodDetails&&this.showMethodDetails.name?99===this.showMethodDetails.type?this.showMethodDetails.name:Object(l["translate"])("SitesManager_SiteWithoutDataInstallWithX",this.showMethodDetails.name):Object(l["translate"])("SitesManager_SiteWithoutDataChooseTrackingMethod")}}});$t.render=Rt;var Wt=$t;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=SitesManager.umd.min.js.map