(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["TagManager"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["TagManager"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,a){return function(e){var t={};function a(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="plugins/TagManager/vue/dist/",a(a.s="fae3")}({"19dc":function(t,a){t.exports=e},"8bbf":function(e,a){e.exports=t},a5a2:function(e,t){e.exports=a},fae3:function(e,t,a){"use strict";if(a.r(t),a.d(t,"ImportVersion",(function(){return p})),a.d(t,"VariableSelect",(function(){return L})),a.d(t,"VariableSelectType",(function(){return I})),a.d(t,"FieldTextareaVariable",(function(){return J})),a.d(t,"FieldVariableTemplate",(function(){return re})),a.d(t,"FieldVariableTypeTemplate",(function(){return ce})),a.d(t,"VariableEdit",(function(){return Ke})),a.d(t,"VariableList",(function(){return Ut})),a.d(t,"VariableManage",(function(){return $t})),a.d(t,"TriggerEdit",(function(){return Ma})),a.d(t,"TriggerList",(function(){return cn})),a.d(t,"TriggerManage",(function(){return bn})),a.d(t,"TagEdit",(function(){return qi})),a.d(t,"TagList",(function(){return Lr})),a.d(t,"TagManage",(function(){return Ir})),a.d(t,"VersionEdit",(function(){return Eo})),a.d(t,"VersionList",(function(){return bl})),a.d(t,"VersionManage",(function(){return vl})),a.d(t,"ContainerEdit",(function(){return Bl})),a.d(t,"ContainerList",(function(){return ds})),a.d(t,"ContainerManage",(function(){return hs})),a.d(t,"ContainerDashboard",(function(){return sc})),a.d(t,"ContainerSelector",(function(){return Tc})),a.d(t,"ManageInstallTagCode",(function(){return Kc})),a.d(t,"TrackingCodeCommon",(function(){return fd})),a.d(t,"TrackingCodePage",(function(){return wd})),a.d(t,"TrackingSPAPage",(function(){return tg})),a.d(t,"Debugging",(function(){return jm})),a.d(t,"CopyDialog",(function(){return fm})),"undefined"!==typeof window){var n=window.document.currentScript,i=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(a.p=i[1])}var r=a("8bbf");const o={class:"tagManagerImportVersion"},l={class:"ui-confirm",id:"confirmImportContainerVersion",ref:"confirmImportContainerVersion"},s=["value"],c=["value"];function d(e,t,a,n,i,d){const g=Object(r["resolveComponent"])("ActivityIndicator"),m=Object(r["resolveComponent"])("Field"),b=Object(r["resolveComponent"])("SaveButton"),h=Object(r["resolveComponent"])("ContentBlock");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",o,[Object(r["createVNode"])(h,{"content-title":e.translate("TagManager_ImportVersion")},{default:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_VersionImportInfo")),1),Object(r["createVNode"])(g,{loading:e.isUpdating,"loading-message":e.translate("TagManager_UpdatingData")},null,8,["loading","loading-message"]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(m,{uicontrol:"text",modelValue:e.backupName,"onUpdate:modelValue":t[0]||(t[0]=t=>e.backupName=t),name:"backupName",placeholder:" ",title:e.backupNameTitle,"inline-help":e.translate("TagManager_BackupVersionNameHelp")},null,8,["modelValue","title","inline-help"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(m,{uicontrol:"textarea",modelValue:e.importContent,"onUpdate:modelValue":t[1]||(t[1]=t=>e.importContent=t),name:"importContent",placeholder:" ","full-width":!0,title:e.translate("TagManager_VersionImportContentTitle")},null,8,["modelValue","title"])]),Object(r["createVNode"])(b,{class:"importVersion",disabled:!e.importContent,onConfirm:t[2]||(t[2]=t=>e.importVersion(e.backupName,e.importContent)),value:e.translate("TagManager_VersionImportOverwriteContent")},null,8,["disabled","value"])]),_:1},8,["content-title"]),Object(r["createElementVNode"])("div",l,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_ConfirmImportContainerVersion")),1),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,s),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,c)],512)])}var g=a("19dc"),m=a("a5a2");const b="importContainerVersion";var h=Object(r["defineComponent"])({props:{idContainer:{type:String,required:!0}},components:{ContentBlock:g["ContentBlock"],ActivityIndicator:g["ActivityIndicator"],Field:m["Field"],SaveButton:m["SaveButton"]},data(){return{isUpdating:!1,backupName:"",importContent:""}},methods:{showNotification(e,t,a=null){const n=g["NotificationsStore"].show({message:e,context:t,type:null!==a?a:"toast",id:b});setTimeout(()=>{g["NotificationsStore"].scrollToNotification(n)},200)},importVersion(e,t){if(!t)return;let a;try{a=JSON.parse(t)}catch(n){return void this.showNotification(Object(g["translate"])("TagManager_ErrorInvalidContainerImportFormat"),"error")}"tags"in a&&"triggers"in a&&"variables"in a&&"idcontainer"in a&&"context"in a?g["Matomo"].helper.modalConfirm(this.$refs.confirmImportContainerVersion,{yes:()=>{this.isUpdating=!0;const e={exportedContainerVersion:t};g["AjaxHelper"].post({method:"TagManager.importContainerVersion",idContainer:this.idContainer,backupName:this.backupName},e,{createErrorNotification:!1}).then(()=>{this.showNotification(Object(g["translate"])("TagManager_VersionImportSuccess"),"success"),this.isUpdating=!1,window.location.reload()}).catch(e=>{this.showNotification(e.message,"error","transient"),this.isUpdating=!1})}}):this.showNotification(Object(g["translate"])("TagManager_ErrorContainerVersionImportIncomplete"),"error")}},computed:{backupNameTitle(){return`${Object(g["translate"])("TagManager_BackupVersionName")} (${Object(g["translate"])("General_Recommended")})`}}});h.render=d;var p=h;const u={class:"tagManagerManageSelect tagManagerVariableSelect"},O={class:"tableActionBar"},j=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),v={class:"collection with-header"},T={class:"collection-header"},V=["onClick"],C={class:"title"},y={class:"secondary-content"},f=["onClick","title"],N={class:"collection-header"},E=["onClick"],k={class:"title"},M={class:"secondary-content"},S=["title"],w={class:"tableActionBar"},_=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1);function D(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("ActivityIndicator");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",u,[Object(r["createVNode"])(l,{loading:e.isLoading},null,8,["loading"]),Object(r["createElementVNode"])("div",O,[Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createNewVariable",onClick:t[0]||(t[0]=t=>e.createVariable())},[j,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVariable")),1)],512),[[r["vShow"],!e.isLoading]])]),Object(r["createElementVNode"])("ul",v,[Object(r["createElementVNode"])("li",T,[Object(r["createElementVNode"])("h4",null,Object(r["toDisplayString"])(e.translate("TagManager_CustomVariables")),1)]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.containerVariables,(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{class:"collection-item",onClick:a=>e.selectVariable(t),key:a},[Object(r["createElementVNode"])("span",C,Object(r["toDisplayString"])(t.name)+" ("+Object(r["toDisplayString"])(e.translate("TagManager_Type"))+": "+Object(r["toDisplayString"])(t.type)+") ",1),Object(r["createElementVNode"])("span",y,[Object(r["createElementVNode"])("i",{class:"icon-edit",onClick:Object(r["withModifiers"])(a=>e.editVariable(t),["stop"]),title:e.translate("General_Edit")},null,8,f)])],8,V))),128))]),Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_PreconfiguredVariables")),1),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.preconfiguredVariables,t=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("ul",{class:"collection with-header",key:t.name},[Object(r["createElementVNode"])("li",N,[Object(r["createElementVNode"])("h4",null,Object(r["toDisplayString"])(t.name),1)]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(t.types,(t,a)=>Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{class:"collection-item",key:a,onClick:a=>e.selectVariable(t)},[Object(r["createElementVNode"])("span",k,Object(r["toDisplayString"])(t.name),1),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",M,[Object(r["createElementVNode"])("i",{class:"icon-help",title:t.description},null,8,S)],512),[[r["vShow"],!!t.description]])],8,E)),[[r["vShow"],t.is_pre_configured]])),128))]))),128)),Object(r["createElementVNode"])("div",w,[Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createNewVariable",onClick:t[1]||(t[1]=t=>e.createVariable())},[_,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVariable",e.translate("TagManager_Variable"))),1)],512),[[r["vShow"],!e.isLoading]])])])}const{tagManagerHelper:x}=window;var B=Object(r["defineComponent"])({props:{idContainer:{type:String,required:!0},idContainerVersion:Number},components:{ActivityIndicator:g["ActivityIndicator"]},data(){return{preconfiguredVariables:[],containerVariables:[],isLoading:!1,actualIdContainerVersion:this.idContainerVersion}},emits:["selectVariable"],created(){this.fetchAvailableVariables()},watch:{idContainerVersion(e){this.actualIdContainerVersion=e}},methods:{fetchAvailableVariables(){this.preconfiguredVariables=[],this.containerVariables=[],this.fetchContainer().then(e=>(this.isLoading=!0,this.actualIdContainerVersion=e.draft.idcontainerversion,g["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:this.idContainer,idContainerVersion:this.actualIdContainerVersion}).then(e=>{this.preconfiguredVariables=[],this.containerVariables=[],this.isLoading=!1,e.forEach(e=>{const t=Object.assign(Object.assign({},e),{},{types:e.types.filter(e=>e.is_pre_configured)});this.containerVariables.push(...e.types.filter(e=>!e.is_pre_configured)),t.types.length&&this.preconfiguredVariables.push(t)})}).catch(()=>{this.isLoading=!1})))},editVariable(e){this.actualIdContainerVersion&&x.editVariable(this.idContainer,this.actualIdContainerVersion,e.idvariable,()=>{this.fetchAvailableVariables()})},createVariable(){this.actualIdContainerVersion&&x.editVariable(this.idContainer,this.actualIdContainerVersion,0,()=>{this.fetchAvailableVariables()})},selectVariable(e){this.$emit("selectVariable",{variable:e})},fetchContainer(){return this.isLoading=!0,g["AjaxHelper"].fetch({method:"TagManager.getContainer",filter_limit:"-1",idContainer:this.idContainer})}}});B.render=D;var L=B;const U={class:"tagManagerManageSelect tagManagerVariableSelectType"},A=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1);function P(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("Field");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",U,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"select",name:"variableType"+e.variableType,class:"selectVariableType","model-value":e.modelValue,"onUpdate:modelValue":t[0]||(t[0]=t=>e.onChange(t)),"full-width":!0,options:e.containerVariables},null,8,["name","model-value","options"])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createNewVariable",onClick:t[1]||(t[1]=Object(r["withModifiers"])(t=>e.createVariable(),["prevent"]))},[A,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVariable")),1)],512),[[r["vShow"],!e.isLoading]])])}const{tagManagerHelper:H}=window;var F=Object(r["defineComponent"])({props:{variableTypeName:{type:String,required:!0},modelValue:String,variableType:String},components:{Field:m["Field"]},emits:["update:modelValue"],data(){return{containerVariables:[],isLoading:!1,idContainerVersion:null}},created(){this.fetchAvailableVariables()},methods:{fetchAvailableVariables(){this.containerVariables=[],this.fetchContainer().then(e=>(this.isLoading=!0,this.idContainerVersion=e.draft.idcontainerversion,g["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:g["MatomoUrl"].parsed.value.idContainer,idContainerVersion:this.idContainerVersion}).then(e=>{this.containerVariables=[],this.isLoading=!1,e.forEach(e=>{const t=e.types.filter(e=>e.type===this.variableType).map(e=>({key:`{{${e.id}}}`,value:e.name}));this.containerVariables.push(...t)}),this.modelValue||1!==this.containerVariables.length||this.onChange(this.containerVariables[0].key)}).catch(()=>{this.isLoading=!1})))},onChange(e){this.$emit("update:modelValue",e)},createVariable(){this.idContainerVersion&&H.editVariable(g["MatomoUrl"].parsed.value.idContainer,this.idContainerVersion,0,e=>{this.fetchAvailableVariables(),e&&this.onChange(`{{${e.name}}}`)},this.variableType)},fetchContainer(){return this.isLoading=!0,g["AjaxHelper"].fetch({method:"TagManager.getContainer",filter_limit:"-1",idContainer:g["MatomoUrl"].parsed.value.idContainer})}}});F.render=P;var I=F;const G={class:"fieldVariableTemplate"},R=["type","id","name","value"],z=["title"],q=["for","innerHTML"];function W(e,t,a,n,i,o){return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",G,[Object(r["createElementVNode"])("textarea",Object(r["mergeProps"])({class:`control_${e.uiControl} materialize-textarea`,type:e.uiControl,id:e.name,name:e.name,value:e.modelValue,onKeydown:t[0]||(t[0]=t=>e.onKeydown(t)),onChange:t[1]||(t[1]=t=>e.onKeydown(t)),placeholder:"",style:{width:"calc(100% - 40px)"}},e.uiControlAttributes,{ref:"textarea"}),null,16,R),Object(r["createElementVNode"])("span",{class:"icon-code",style:{"margin-top":"14px",position:"absolute"},title:e.translate("TagManager_ChooseVariable"),onClick:t[2]||(t[2]=t=>e.selectVariable())},null,8,z),Object(r["createElementVNode"])("label",{for:e.name,innerHTML:e.$sanitize(e.title)},null,8,q)])}const{tagManagerHelper:X}=window;var K=Object(r["defineComponent"])({props:{name:String,uiControlAttributes:Object,modelValue:String,title:String,uiControl:{type:String,required:!0}},inheritAttrs:!1,emits:["update:modelValue"],created(){this.onKeydown=Object(g["debounce"])(this.onKeydown.bind(this),50)},methods:{onKeydown(e){this.$emit("update:modelValue",e.target.value)},selectVariable(){X.selectVariable(e=>{X.insertTextSnippetAtElement(this.$refs.textarea,`{{${e.id}}}`)})}},watch:{modelValue(){const{Materialize:e}=window;setTimeout(()=>{e.textareaAutoResize(this.$refs.textarea),e.updateTextFields()})}},mounted(){const{Materialize:e}=window;setTimeout(()=>{e.textareaAutoResize(this.$refs.textarea),e.updateTextFields()})}});K.render=W;var J=K;const Y={class:"fieldVariableTemplate"},Z=["type","id","name","value"],Q=["title"],ee=Object(r["createElementVNode"])("br",null,null,-1),te=["for","innerHTML"];function ae(e,t,a,n,i,o){return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Y,[Object(r["createElementVNode"])("input",Object(r["mergeProps"])({class:"control_"+e.uiControl,type:e.uiControl,id:e.name,name:e.name,value:e.modelValueText,onKeydown:t[0]||(t[0]=t=>e.onKeydown(t)),onChange:t[1]||(t[1]=t=>e.onKeydown(t)),placeholder:"",style:{width:"calc(100% - 40px)"}},e.uiControlAttributes,{ref:"input"}),null,16,Z),Object(r["createElementVNode"])("span",{class:"icon-code",title:e.translate("TagManager_ChooseVariable"),onClick:t[2]||(t[2]=t=>e.selectVariable())},null,8,Q),ee,Object(r["createElementVNode"])("label",{for:e.name,innerHTML:e.$sanitize(e.title)},null,8,te)])}const{tagManagerHelper:ne}=window;var ie=Object(r["defineComponent"])({props:{uiControl:{type:String,required:!0},uiControlAttributes:Object,name:String,title:String,modelValue:null},inheritAttrs:!1,emits:["update:modelValue"],computed:{modelValueText(){return"undefined"===typeof this.modelValue||null===this.modelValue?"":this.modelValue.toString()}},created(){this.onKeydown=Object(g["debounce"])(this.onKeydown.bind(this),50)},mounted(){setTimeout(()=>{window.Materialize.updateTextFields()})},watch:{modelValue(){setTimeout(()=>{window.Materialize.updateTextFields()})}},methods:{onKeydown(e){this.$emit("update:modelValue",e.target.value)},selectVariable(){ne.selectVariable(e=>{ne.insertTextSnippetAtElement(this.$refs.input,`{{${e.id}}}`)})}}});ie.render=ae;var re=ie;const oe=["for","innerHTML"];function le(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("VariableSelectType");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",null,[Object(r["createVNode"])(l,{"model-value":e.modelValue,id:e.name,name:e.name,"variable-type-name":e.title,"variable-type":e.uiControlAttributes.variableType,"onUpdate:modelValue":t[0]||(t[0]=t=>e.$emit("update:modelValue",t))},null,8,["model-value","id","name","variable-type-name","variable-type"]),Object(r["createElementVNode"])("label",{for:e.name,style:{"font-size":"0.8rem"},innerHTML:e.$sanitize(e.title)},null,8,oe)])}var se=Object(r["defineComponent"])({props:{uiControlAttributes:{type:Object,required:!0},name:String,title:String,modelValue:String},components:{VariableSelectType:I},emits:["update:modelValue"]});se.render=le;var ce=se;const de={class:"editVariable tagManagerManageEdit",ref:"root"},ge={class:"loadingPiwik"},me=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),be={class:"loadingPiwik"},he=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),pe=["innerHTML"],ue={key:0,class:"form-group row"},Oe={class:"col s12"},je={key:1},ve={class:"form-group row"},Te={class:"col s12"},Ve={key:2},Ce={class:"innerFormField"},ye={class:"form-group row"},fe={class:"col s12 m12"},Ne={for:"lookup_table"},Ee={class:"innerFormField comparisonField"},ke={class:"innerFormField"},Me={class:"innerFormField"},Se=["onClick","title"],we=["innerHTML"],_e={class:"entityCancel"},De={id:"confirmSelectVariableType"},xe={class:"collection-header"},Be=["onClick","title"],Le=["src"],Ue={class:"title"},Ae={class:"secondary-content"},Pe=["title"],He={class:"entityCancel"};function Fe(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("Field"),s=Object(r["resolveComponent"])("GroupedSettings"),c=Object(r["resolveComponent"])("SaveButton"),d=Object(r["resolveComponent"])("ContentBlock");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",de,[Object(r["createVNode"])(d,{feature:"Tag Manager","content-title":e.editTitle},{default:Object(r["withCtx"])(()=>{var a,n,i,o,d,g;return[Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",ge,[me,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[r["vShow"],e.isLoading]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",be,[he,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("TagManager_UpdatingData")),1)])],512),[[r["vShow"],e.isUpdating]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("form",{onSubmit:t[9]||(t[9]=t=>e.edit?e.updateVariable():e.createVariable())},[Object(r["createElementVNode"])("div",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("div",{class:"alert alert-danger",innerHTML:e.$sanitize(e.getNoCustomTemplatePermissionErrorMessage())},null,8,pe),[[r["vShow"],e.isVariableDisabled]]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"text",name:"name","model-value":e.variable.name,"onUpdate:modelValue":t[0]||(t[0]=t=>{e.variable.name=t,e.setValueHasChanged()}),maxlength:255,title:e.translate("General_Name"),"inline-help":e.translate("TagManager_VariableNameHelp"),placeholder:e.translate("TagManager_VariableNamePlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"textarea",name:"description","model-value":e.variable.description,"onUpdate:modelValue":t[1]||(t[1]=t=>{e.variable.description=t,e.setValueHasChanged()}),maxlength:1e3,title:e.translate("TagManager_Description"),"inline-help":e.translate("TagManager_VariableDescriptionHelp"),placeholder:e.translate("TagManager_VariableDescriptionPlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),null!==(a=e.variable.typeMetadata)&&void 0!==a&&null!==(a=a.parameters)&&void 0!==a&&a.length?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",ue,[Object(r["createElementVNode"])("div",Oe,[Object(r["createElementVNode"])("h3",null,Object(r["toDisplayString"])(e.translate("TagManager_ConfigureThisVariable")),1)])])):Object(r["createCommentVNode"])("",!0),e.variable?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",je,[Object(r["createVNode"])(s,{settings:(null===(n=e.variable.typeMetadata)||void 0===n?void 0:n.parameters)||[],"all-setting-values":e.parameterValues,onChange:t[2]||(t[2]=t=>e.parameterValues[t.name]=t.value)},null,8,["settings","all-setting-values"])])):Object(r["createCommentVNode"])("",!0),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",ve,[Object(r["createElementVNode"])("div",Te,[Object(r["createElementVNode"])("h3",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"showAdvancedSettings",onClick:t[3]||(t[3]=Object(r["withModifiers"])(t=>e.showAdvanced=!0,["prevent"]))},Object(r["toDisplayString"])(e.translate("TagManager_ShowAdvancedSettings")),513),[[r["vShow"],!e.showAdvanced]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"hideAdvancedSettings",onClick:t[4]||(t[4]=Object(r["withModifiers"])(t=>e.showAdvanced=!1,["prevent"]))},Object(r["toDisplayString"])(e.translate("TagManager_HideAdvancedSettings")),513),[[r["vShow"],e.showAdvanced]])])])],512),[[r["vShow"],null===(i=e.variable.typeMetadata)||void 0===i?void 0:i.hasAdvancedSettings]]),e.variable&&e.variable.typeMetadata&&"MatomoConfiguration"===e.variable.typeMetadata.id?Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Ve,[Object(r["createVNode"])(s,{settings:(null===(o=e.variable.typeMetadata)||void 0===o?void 0:o.advancedParameters)||[],"all-setting-values":e.parameterValues,onChange:t[5]||(t[5]=t=>e.parameterValues[t.name]=t.value)},null,8,["settings","all-setting-values"])],512)),[[r["vShow"],e.showAdvanced&&(null===(d=e.variable.typeMetadata)||void 0===d?void 0:d.hasAdvancedSettings)]]):Object(r["createCommentVNode"])("",!0),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("div",Ce,[Object(r["createVNode"])(l,{uicontrol:"text",name:"default_value","model-value":e.variable.default_value,"onUpdate:modelValue":t[6]||(t[6]=t=>{e.variable.default_value=t,e.setValueHasChanged()}),title:e.translate("TagManager_DefaultValue"),"inline-help":e.translate("TagManager_DefaultValueHelp"),placeholder:e.translate("TagManager_DefaultValuePlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createElementVNode"])("div",ye,[Object(r["createElementVNode"])("div",fe,[Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("label",Ne,Object(r["toDisplayString"])(e.translate("TagManager_LookupTableTitle")),1),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.variable.lookup_table,(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{key:a,class:Object(r["normalizeClass"])(`lookupTable lookupTable${a} multiple valign-wrapper`)},[Object(r["createElementVNode"])("div",Ee,[Object(r["createVNode"])(l,{uicontrol:"select",name:"lookup_table_comparison","model-value":t.comparison,"onUpdate:modelValue":a=>{t.comparison=a,e.setValueHasChanged()},"full-width":!0,options:e.availableLookUpComparisons},null,8,["model-value","onUpdate:modelValue","options"])]),Object(r["createElementVNode"])("div",ke,[Object(r["createVNode"])(l,{uicontrol:"text",name:"lookup_table_matchvalue","model-value":t.match_value,"onUpdate:modelValue":a=>{t.match_value=a,e.setValueHasChanged()},"full-width":!0,placeholder:e.translate("TagManager_LookupTableMatchValue")},null,8,["model-value","onUpdate:modelValue","placeholder"])]),Object(r["createElementVNode"])("div",Me,[Object(r["createVNode"])(l,{uicontrol:"text",name:"lookup_table_outvalue","model-value":t.out_value,"onUpdate:modelValue":a=>{t.out_value=a,e.setValueHasChanged()},"full-width":!0,placeholder:e.translate("TagManager_LookupTableOutValue")},null,8,["model-value","onUpdate:modelValue","placeholder"])]),a+1!==e.variable.lookup_table.length?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:0,class:"icon-minus valign",onClick:t=>e.removeLookUpEntry(a),title:e.translate("General_Remove")},null,8,Se)):Object(r["createCommentVNode"])("",!0)],2))),128))])])])],512),[[r["vShow"],e.showAdvanced&&(null===(g=e.variable.typeMetadata)||void 0===g?void 0:g.hasAdvancedSettings)&&e.variable&&e.variable.typeMetadata&&"MatomoConfiguration"!==e.variable.typeMetadata.id]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",{class:"alert alert-danger",innerHTML:e.$sanitize(e.getNoCustomTemplatePermissionErrorMessage())},null,8,we),[[r["vShow"],e.isVariableDisabled]]),e.isVariableDisabled?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createBlock"])(c,{key:3,class:"createButton",onConfirm:t[7]||(t[7]=t=>e.edit?e.updateVariable():e.createVariable()),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.edit?e.translate("CoreUpdater_UpdateTitle"):e.translate("TagManager_CreateNewVariable")},null,8,["disabled","saving","value"])),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",_e,[Object(r["createElementVNode"])("a",{onClick:t[8]||(t[8]=Object(r["withModifiers"])(t=>e.cancel(),["prevent"]))},Object(r["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[r["vShow"],!e.isEmbedded]])])],544),[[r["vShow"],!e.chooseVariableType&&e.editTitle]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",De,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.availableVariables,(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("ul",{class:"collection with-header",key:a},[Object(r["createElementVNode"])("li",xe,[Object(r["createElementVNode"])("h4",null,Object(r["toDisplayString"])(t.name),1)]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(t.types,(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{key:a,class:Object(r["normalizeClass"])(["collection-item avatar",{disabledTemplate:this.isVariableTemplateDisabled[t.id],["templateType"+t.id]:!0}]),onClick:a=>e.createVariableType(t),title:this.isVariableTemplateDisabled[t.id]?e.translate("TagManager_UseCustomTemplateCapabilityPermissionRequiredDescription","",e.translate("TagManager_CapabilityUseCustomTemplates"),""):""},[t.icon?(Object(r["openBlock"])(),Object(r["createElementBlock"])("img",{key:0,alt:"",class:"circle",src:t.icon},null,8,Le)):Object(r["createCommentVNode"])("",!0),Object(r["createElementVNode"])("span",Ue,Object(r["toDisplayString"])(t.name),1),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(t.description),513),[[r["vShow"],t.description]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",Ae,[Object(r["createElementVNode"])("i",{class:"icon-help",title:t.help},null,8,Pe)],512),[[r["vShow"],!!t.help]])],10,Be))),128))]))),128)),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",He,[Object(r["createElementVNode"])("a",{onClick:t[10]||(t[10]=Object(r["withModifiers"])(t=>e.cancel(),["prevent"]))},Object(r["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[r["vShow"],!e.isEmbedded]])],512),[[r["vShow"],e.chooseVariableType]])]}),_:1},8,["content-title"])],512)}function Ie(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */class $e{constructor(){Ie(this,"privateState",Object(r["reactive"])({variables:[],isLoadingVars:!1,isLoadingSingle:!1,isUpdating:!1})),Ie(this,"state",Object(r["computed"])(()=>this.privateState)),Ie(this,"isLoading",Object(r["computed"])(()=>{const e=this.state.value;return e.isLoadingVars||e.isLoadingSingle})),Ie(this,"isUpdating",Object(r["computed"])(()=>this.state.value.isUpdating)),Ie(this,"variables",Object(r["computed"])(()=>this.state.value.variables)),Ie(this,"fetchPromise",null),Ie(this,"availableVariablesPromises",{})}fetchVariablesIfNotLoaded(e,t){this.fetchPromise||this.fetchVariables(e,t)}findVariable(e,t,a,n){const i=this.variables.value.find(e=>e.idvariable===a);return i&&!n?Promise.resolve(i):(this.privateState.isLoadingSingle=!0,g["AjaxHelper"].fetch({idVariable:a,idContainer:e,idContainerVersion:t,method:"TagManager.getContainerVariable",filter_limit:"-1"}).then(e=>(this.privateState.variables=[...this.privateState.variables,e],e)).finally(()=>{this.privateState.isLoadingSingle=!1}))}fetchVariables(e,t){return this.privateState.isLoadingVars=!0,this.privateState.variables=[],this.fetchPromise||(this.fetchPromise=g["AjaxHelper"].fetch({method:"TagManager.getContainerVariables",idContainer:e,idContainerVersion:t,filter_limit:"-1"})),Promise.resolve(this.fetchPromise).then(e=>(this.privateState.variables=e,this.privateState.isLoadingVars=!1,this.variables.value)).finally(()=>{this.privateState.isLoadingVars=!1})}fetchAvailableVariables(e){return this.availableVariablesPromises[e]||(this.availableVariablesPromises[e]=g["AjaxHelper"].fetch({method:"TagManager.getAvailableVariableTypesInContext",idContext:e,filter_limit:"-1"}).then(e=>e)),Promise.resolve(this.availableVariablesPromises[e])}suggestNameForType(e){for(let t=0;t<100;t+=1){let a=e;t&&(a=`${a} (${t})`);const n=!this.variables.value.some(e=>e.name===a);if(n)return a}}createOrUpdateVariable(e,t,a,n,i){this.privateState.isUpdating=!0;const r=Object.entries(i).map(([e,t])=>{let a=t;return"boolean"===typeof t&&(a=(+t).toString()),[e,a]}),o=Object.fromEntries(r),l=e.lookup_table.filter(e=>e&&e.out_value&&e.comparison);return g["AjaxHelper"].post({idVariable:e.idvariable,method:t,idContainer:a,idContainerVersion:n,type:e.type,name:e.name,description:e.description,defaultValue:e.default_value},{parameters:o,lookupTable:l},{withTokenInUrl:!0}).finally(()=>{this.privateState.isUpdating=!1})}reload(e,t){return this.privateState.variables=[],this.fetchPromise=null,this.availableVariablesPromises={},this.fetchVariables(e,t)}deleteVariable(e,t,a){return this.privateState.isUpdating=!0,this.privateState.variables=[],g["AjaxHelper"].fetch({idVariable:a,idContainerVersion:t,idContainer:e,method:"TagManager.deleteContainerVariable"},{withTokenInUrl:!0}).finally(()=>{this.privateState.isUpdating=!1})}}var Ge=new $e;function Re(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */class ze{constructor(){Re(this,"privateState",Object(r["reactive"])({comparisons:[],isLoading:!1})),Re(this,"state",Object(r["computed"])(()=>Object(r["readonly"])(this.privateState))),Re(this,"isLoading",Object(r["computed"])(()=>this.state.value.isLoading)),Re(this,"comparisons",Object(r["computed"])(()=>this.state.value.comparisons)),Re(this,"comparisonOptions",Object(r["computed"])(()=>this.comparisons.value.map(({id:e,name:t})=>({key:e,value:t})))),Re(this,"initializePromise",null)}init(){return this.initializePromise||(this.initializePromise=this.fetchAvailableComparisons()),this.initializePromise}fetchAvailableComparisons(){return this.privateState.isLoading=!0,g["AjaxHelper"].fetch({method:"TagManager.getAvailableComparisons",filter_limit:"-1"}).then(e=>{this.privateState.comparisons=e}).finally(()=>{this.privateState.isLoading=!1})}}var qe=new ze;const We="tagvariablemanagement";var Xe=Object(r["defineComponent"])({props:{idVariable:Number,idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},variableType:String,isEmbedded:{type:Boolean,default:!1}},components:{GroupedSettings:m["GroupedSettings"],ContentBlock:g["ContentBlock"],Field:m["Field"],SaveButton:m["SaveButton"]},data(){return{isDirty:!1,showAdvanced:!1,chooseVariableType:!1,canUseCustomTemplates:g["Matomo"].hasUserCapability("tagmanager_use_custom_templates"),availableVariables:[],editTitle:"",variable:{},parameterValues:{},advancedParameters:{},isUpdatingVar:!1}},emits:["changeVariable"],created(){qe.init(),Ge.fetchVariablesIfNotLoaded(this.idContainer,this.idContainerVersion),this.initIdVariable()},watch:{idVariable(e){null!==e&&this.initIdVariable()},variableParameterValues:{handler(e,t){e&&t&&(this.isDirty=!0)},deep:!0},variableLookupTable:{handler(){const e=(this.variable.lookup_table||[]).every(e=>!(null===e||void 0===e||!e.out_value));e&&this.addLookUpEntry()},deep:!0}},methods:{removeAnyVariableNotification(){g["NotificationsStore"].remove(We),g["NotificationsStore"].remove("ajaxHelper")},showNotification(e,t,a=null){const n=g["NotificationsStore"].show({message:e,context:t,id:We,type:null!==a?a:"toast"});setTimeout(()=>{g["NotificationsStore"].scrollToNotification(n)},200)},showErrorFieldNotProvidedNotification(e){const t=Object(g["translate"])("TagManager_ErrorXNotProvided",[e]);this.showNotification(t,"error")},initIdVariable(){g["Matomo"].helper.lazyScrollToContent(),this.availableVariables=[],g["AjaxHelper"].fetch({method:"TagManager.getContainer",idContainer:this.idContainer,filter_limit:"-1"}).then(e=>Ge.fetchAvailableVariables(e.context)).then(e=>{this.availableVariables=e}).then(()=>{if(this.edit&&this.idVariable)return this.editTitle=Object(g["translate"])("TagManager_EditVariable"),void Ge.findVariable(this.idContainer,this.idContainerVersion,this.idVariable,this.isEmbedded).then(e=>{var t;e&&(this.variable=Object(g["clone"])(e),this.variable.typeMetadata.parameters=e.typeMetadata.parameters.filter(e=>!Object.prototype.hasOwnProperty.call(e,"uiControlAttributes")||!Object.prototype.hasOwnProperty.call(e.uiControlAttributes,"showAdvancedSettings")),this.variable.typeMetadata.advancedParameters=e.typeMetadata.parameters.filter(e=>Object.prototype.hasOwnProperty.call(e,"uiControlAttributes")&&Object.prototype.hasOwnProperty.call(e.uiControlAttributes,"showAdvancedSettings")),this.parameterValues=Object.fromEntries(e.typeMetadata.parameters.map(e=>[e.name,e.value])),(this.variable.lookup_table&&this.variable.lookup_table.length||this.variable.default_value)&&(this.showAdvanced=!0),this.addLookUpEntryIfNoneExists(),this.isDirty=!1,null!==(t=this.variable.typeMetadata)&&void 0!==t&&t.name&&(this.editTitle+=": "+this.variable.typeMetadata.name))});if(this.create){let e=!1;this.variableType&&this.availableVariables.forEach(t=>{if(!e){const a=t.types.find(e=>(null===e||void 0===e?void 0:e.id)===this.variableType);a&&(e=!0,this.createVariableType(a))}}),e||(this.editTitle=Object(g["translate"])("TagManager_ChooseVariableToContinue"),this.chooseVariableType=!0)}})},addLookUpEntryIfNoneExists(){this.variable.lookup_table&&Array.isArray(this.variable.lookup_table)||(this.variable.lookup_table=[]),this.variable.lookup_table.length||this.variable.lookup_table.push({comparison:"equals",match_value:"",out_value:""})},addLookUpEntry(){this.variable.lookup_table.push({comparison:"equals",match_value:"",out_value:""}),this.isDirty=!0},removeLookUpEntry(e){e>-1&&(this.variable.lookup_table.splice(e,1),this.isDirty=!0)},createVariableType(e){var t;if(e&&this.isVariableTemplateDisabled[e.id])return;this.chooseVariableType=!1,this.editTitle=Object(g["translate"])("TagManager_CreateNewVariable"),this.variable={idsite:parseInt(""+g["Matomo"].idSite,10),name:Ge.suggestNameForType(e.name)||"",description:"",type:e.id,idcontainer:this.idContainer,idcontainerversion:this.idContainerVersion,default_value:"",lookup_table:[],typeMetadata:e},this.variable.typeMetadata.advancedParameters=[];const a=e.parameters.filter(e=>Object.prototype.hasOwnProperty.call(e,"uiControlAttributes")&&Object.prototype.hasOwnProperty.call(e.uiControlAttributes,"showAdvancedSettings")),n=e.parameters.filter(e=>!Object.prototype.hasOwnProperty.call(e,"uiControlAttributes")||!Object.prototype.hasOwnProperty.call(e.uiControlAttributes,"showAdvancedSettings"));this.parameterValues=Object.fromEntries(e.parameters.map(e=>[e.name,e.value])),this.variable.typeMetadata.advancedParameters=a,this.variable.typeMetadata.parameters=n,null!==(t=this.variable.typeMetadata)&&void 0!==t&&t.name&&(this.editTitle+=": "+this.variable.typeMetadata.name),this.addLookUpEntry(),this.isDirty=!0,Object(r["nextTick"])(()=>{if(!this.$refs.root)return;const e=this.$refs.root;e.scrollIntoView();const t=e.querySelector("#name");t&&t.focus()})},cancel(){const e=Object.assign({},g["MatomoUrl"].hashParsed.value);delete e.idVariable,g["MatomoUrl"].updateHash(e)},createVariable(){this.removeAnyVariableNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVar=!0,Ge.createOrUpdateVariable(Object.assign(Object.assign({},this.variable),{},{name:encodeURIComponent(this.variable.name)}),"TagManager.addContainerVariable",this.idContainer,this.idContainerVersion,this.parameterValues).then(e=>{if(!e)return;this.isDirty=!1;const t=e.value;Ge.reload(this.idContainer,this.idContainerVersion).then(()=>{if(this.isEmbedded)return this.variable.idvariable=t,void this.$emit("changeVariable",{variable:this.variable});this.cancel(),setTimeout(()=>{const e=Object(g["translate"])("TagManager_CreatedX",Object(g["translate"])("TagManager_Variable"));if(this.hasPublishCapability()){const t=Object(g["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>");this.showNotification(`${e} ${t}`,"success","transient")}else this.showNotification(e,"success")},200)})}).finally(()=>{this.isUpdatingVar=!1}))},setValueHasChanged(){this.isDirty=!0},updateVariable(){this.removeAnyVariableNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVar=!0,Ge.createOrUpdateVariable(Object.assign(Object.assign({},this.variable),{},{name:encodeURIComponent(this.variable.name)}),"TagManager.updateContainerVariable",this.idContainer,this.idContainerVersion,this.parameterValues).then(e=>{if(!e)return;if(this.isEmbedded)return void this.$emit("changeVariable",{variable:this.variable});this.isDirty=!1,Ge.reload(this.idContainer,this.idContainerVersion).then(()=>{this.initIdVariable()}),this.cancel();const t=Object(g["translate"])("TagManager_UpdatedX",Object(g["translate"])("TagManager_Variable"));if(this.hasPublishCapability()){const e=Object(g["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>");this.showNotification(`${t} ${e}`,"success","transient")}else this.showNotification(t,"success")}).finally(()=>{this.isUpdatingVar=!1}))},checkRequiredFieldsAreSet(){return!!this.variable.name||(this.showErrorFieldNotProvidedNotification(Object(g["translate"])("General_Name")),!1)},hasPublishCapability(){return g["Matomo"].hasUserCapability("tagmanager_write")&&g["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},getNoCustomTemplatePermissionErrorMessage(){return Object(g["translate"])("TagManager_UseCustomTemplateCapabilityPermissionRequiredDescription","<strong>",Object(g["translate"])("TagManager_CapabilityUseCustomTemplates"),"</strong>")}},computed:{typeInlineHelp(){var e,t;const a=(null===(e=this.variable.typeMetadata)||void 0===e?void 0:e.description)||"",n=(null===(t=this.variable.typeMetadata)||void 0===t?void 0:t.help)||"";return`${a} ${n}`},create(){return 0===this.idVariable},edit(){return!this.create},isLoading(){return Ge.isLoading.value||qe.isLoading.value},isUpdating(){return Ge.isUpdating.value||this.isUpdatingVar},availableLookUpComparisons(){return qe.comparisonOptions.value},isVariableTemplateDisabled(){const e={};return this.availableVariables.forEach(t=>{t.types.forEach(t=>{e[t.id]=!this.canUseCustomTemplates&&t.isCustomTemplate})}),e},isVariableDisabled(){var e;return!this.canUseCustomTemplates&&(null===(e=this.variable.typeMetadata)||void 0===e?void 0:e.isCustomTemplate)},variableParameterValues(){var e;return null!==(e=this.variable.typeMetadata)&&void 0!==e&&e.parameters?this.parameterValues:null},variableLookupTable(){return this.variable.lookup_table}}});Xe.render=Fe;var Ke=Xe;const Je={class:"tagManagerManageList tagManagerVariableList"},Ye={class:"variableSearchFilter"},Ze=["title"],Qe=["title"],et=["title"],tt=["title"],at=["title"],nt=["title"],it={colspan:"7"},rt={class:"loadingPiwik"},ot=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),lt={colspan:"7"},st=["id"],ct=["title"],dt=["title"],gt=["title"],mt={class:"lookupTable"},bt={class:"icon-ok"},ht=["title"],pt=["onClick","title"],ut=["onClick","title"],Ot=["onClick","title"],jt={class:"tableActionBar"},vt=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),Tt=["title"],Vt=Object(r["createElementVNode"])("span",{class:"icon-help preconfiguredVariablesHelp"},null,-1),Ct={class:"collection-header"},yt={class:"title"},ft=["textContent"],Nt={class:"secondary-content"},Et=["title"],kt={class:"ui-confirm",id:"confirmDeleteVariable",ref:"confirmDeleteVariable"},Mt=["value"],St=["value"],wt={class:"ui-confirm",id:"confirmDeleteVariableNotPossible",ref:"confirmDeleteVariableNotPossible"},_t={class:"collection"},Dt=["value"];function xt(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("Field"),s=Object(r["resolveComponent"])("ContentBlock"),c=Object(r["resolveDirective"])("content-table");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Je,[Object(r["createVNode"])(s,{feature:"Tag Manager",class:"tagManagerCustomVariablesList","content-title":e.translate("TagManager_ManageX",e.translate("TagManager_Variables")),"help-text":e.variablesHelpText},{default:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_VariableUsageBenefits")),1),Object(r["createElementVNode"])("div",Ye,[Object(r["withDirectives"])(Object(r["createVNode"])(l,{uicontrol:"text",name:"variableSearch",title:e.translate("General_Search"),modelValue:e.variableSearch,"onUpdate:modelValue":t[0]||(t[0]=t=>e.variableSearch=t)},null,8,["title","modelValue"]),[[r["vShow"],e.variables.length>0]])]),Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("table",null,[Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",{class:"name",title:e.nameTranslatedText},Object(r["toDisplayString"])(e.translate("General_Name")),9,Ze),Object(r["createElementVNode"])("th",{class:"description",title:e.descriptionTranslatedText},Object(r["toDisplayString"])(e.translate("General_Description")),9,Qe),Object(r["createElementVNode"])("th",{class:"type",title:e.typeTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_Type")),9,et),Object(r["createElementVNode"])("th",{class:"lookupTable",title:e.lookupTableTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_LookupTable")),9,tt),Object(r["createElementVNode"])("th",{class:"lastUpdated",title:e.lastUpdatedTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_LastUpdated")),9,at),Object(r["withDirectives"])(Object(r["createElementVNode"])("th",{class:"action",title:e.actionTranslatedText},Object(r["toDisplayString"])(e.translate("General_Actions")),9,nt),[[r["vShow"],e.hasWriteAccess]])])]),Object(r["createElementVNode"])("tbody",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",it,[Object(r["createElementVNode"])("span",rt,[ot,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[r["vShow"],e.isLoading||e.isUpdating]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",lt,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_NoVariablesFound"))+" ",1),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createContainerVariableNow",onClick:t[1]||(t[1]=t=>e.createVariable())},Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVariableNow")),513),[[r["vShow"],e.hasWriteAccess]])])],512),[[r["vShow"],!e.isLoading&&!e.variables.length]]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedVariables,t=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{id:"variable"+t.idvariable,class:"variables",key:t.idvariable},[Object(r["createElementVNode"])("td",{class:"name",title:t.name},Object(r["toDisplayString"])(e.truncateText(t.name,50)),9,ct),Object(r["createElementVNode"])("td",{class:"description",title:t.description},Object(r["toDisplayString"])(e.truncateText(t.description,75)),9,dt),Object(r["createElementVNode"])("td",{class:"type",title:t.typeMetadata.description},Object(r["toDisplayString"])(t.typeMetadata.name),9,gt),Object(r["createElementVNode"])("td",mt,[Object(r["withDirectives"])(Object(r["createElementVNode"])("span",bt,null,512),[[r["vShow"],t.lookup_table.length]])]),Object(r["createElementVNode"])("td",{class:"lastUpdated",title:e.translate("TagManager_CreatedOnX",t.created_date_pretty)},[Object(r["createElementVNode"])("span",null,Object(r["toDisplayString"])(t.updated_date_pretty),1)],8,ht),Object(r["withDirectives"])(Object(r["createElementVNode"])("td",{class:Object(r["normalizeClass"])(e.getActionClasses)},[Object(r["createElementVNode"])("a",{class:"table-action icon-edit",onClick:a=>e.editVariable(t.idvariable,t.type),title:e.translate("TagManager_EditVariable")},null,8,pt),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-content-copy",onClick:a=>e.openCopyDialog(t),title:e.translate("TagManager_CopyX",e.translate("TagManager_Variable"))},null,8,ut),[[r["vShow"],e.hasPublishCapability()]]),Object(r["createElementVNode"])("a",{class:"table-action icon-delete",onClick:a=>e.deleteVariable(t),title:e.translate("TagManager_DeleteX",e.translate("TagManager_Variable"))},null,8,Ot)],2),[[r["vShow"],e.hasWriteAccess]])],8,st))),128))])])),[[c]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",jt,[Object(r["createElementVNode"])("a",{class:"createNewVariable",value:"",onClick:t[2]||(t[2]=t=>e.createVariable())},[vt,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVariable")),1)])],512),[[r["vShow"],e.hasWriteAccess]])]),_:1},8,["content-title","help-text"]),Object(r["createElementVNode"])("h2",{title:e.translate("TagManager_PreConfiguredInfoTitle")},[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_PreconfiguredVariables"))+" ",1),Vt],8,Tt),Object(r["createElementVNode"])("div",null,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.containerVariables,(e,t)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("ul",{class:"collection with-header",key:t},[Object(r["createElementVNode"])("li",Ct,[Object(r["createElementVNode"])("h4",null,Object(r["toDisplayString"])(e.name),1)]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.types,e=>Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{class:"collection-item",key:e.id},[Object(r["createElementVNode"])("span",yt,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.name)+" ",1),Object(r["createElementVNode"])("span",{class:"variableId",textContent:Object(r["toDisplayString"])(`{{${e.id}}}`)},null,8,ft)]),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",Nt,[Object(r["createElementVNode"])("i",{class:"icon-help",title:e.description},null,8,Et)],512),[[r["vShow"],!!e.description]])])),[[r["vShow"],e.is_pre_configured]])),128))]))),128))]),Object(r["createElementVNode"])("div",kt,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_DeleteVariableConfirm")),1),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,Mt),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,St)],512),Object(r["createElementVNode"])("div",wt,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_VariableCannotBeDeleted")),1),Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_VariableBeingUsedBy")),1),Object(r["createElementVNode"])("ul",_t,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.variableReferences,e=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{class:"collection-item",key:`${e.referenceType}.${e.referenceId}`},Object(r["toDisplayString"])(e.referenceTypeName)+": "+Object(r["toDisplayString"])(e.referenceName),1))),128))]),Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_VariableBeingUsedNeedsRemove")),1),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_Cancel")},null,8,Dt)],512)])}const{tagManagerHelper:Bt}=window;var Lt=Object(r["defineComponent"])({props:{idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},variablesHelpText:String},components:{Field:m["Field"],ContentBlock:g["ContentBlock"]},directives:{ContentTable:g["ContentTable"]},data(){return{hasWriteAccess:g["Matomo"].hasUserCapability("tagmanager_write"),variableReferences:[],containerVariables:[],variableSearch:""}},created(){Ge.fetchVariables(this.idContainer,this.idContainerVersion),g["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion,filter_limit:"-1"}).then(e=>{this.containerVariables=e})},methods:{createVariable(){this.editVariable(0)},editVariable(e){g["MatomoUrl"].updateHash(Object.assign(Object.assign({},g["MatomoUrl"].hashParsed.value),{},{idVariable:e}))},deleteVariable(e){g["AjaxHelper"].fetch({method:"TagManager.getContainerVariableReferences",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion,idVariable:e.idvariable}).then(t=>{t&&t.length?(this.variableReferences=t,g["Matomo"].helper.modalConfirm(this.$refs.confirmDeleteVariableNotPossible,{})):(this.variableReferences=[],g["Matomo"].helper.modalConfirm(this.$refs.confirmDeleteVariable,{yes:()=>{Ge.deleteVariable(this.idContainer,this.idContainerVersion,e.idvariable).then(()=>{Ge.reload(this.idContainer,this.idContainerVersion),g["NotificationsStore"].remove("CopyDialogResultNotification")})}}))})},truncateText(e,t){return Bt.truncateText(e,t)},hasPublishCapability(){return g["Matomo"].hasUserCapability("tagmanager_write")&&g["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},openCopyDialog(e){const t=g["MatomoUrl"].stringify({module:"TagManager",action:"copyVariableDialog",idSite:e.idsite,idContainer:this.idContainer,idVariable:e.idvariable,idContainerVersion:this.idContainerVersion});window.Piwik_Popover.createPopupAndLoadUrl(t,"","mtmCopyVariable")}},computed:{isLoading(){return Ge.isLoading.value},isUpdating(){return Ge.isUpdating.value},variables(){return Ge.variables.value},sortedVariables(){const e=this.variableSearch.toLowerCase(),t=[...this.variables].filter(t=>Object.keys(t).some(a=>{const n=t;let i="";if("string"===typeof n[a])i=n[a];else if("typeMetadata"===a){const e=n.typeMetadata;i=e.name}else if("parameters"===a&&"CustomJsFunction"===n.type){const e=n.parameters;i=e.jsFunction}return-1!==i.toLowerCase().indexOf(e)}));return t.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0),t},nameTranslatedText(){return this.translate("TagManager_VariablesNameDescription")},descriptionTranslatedText(){return this.translate("TagManager_VariablesDescriptionDescription")},typeTranslatedText(){return this.translate("TagManager_VariablesTypeDescription")},lookupTableTranslatedText(){return this.translate("TagManager_VariablesLookupTableDescription")},lastUpdatedTranslatedText(){return this.translate("TagManager_VariablesLastUpdatedDescription")},actionTranslatedText(){return this.translate("TagManager_VariablesActionDescription")},getActionClasses(){const e=this.hasPublishCapability()?" hasCopyAction":"";return"action"+e}}});Lt.render=xt;var Ut=Lt;const At={class:"manageVariable"},Pt={key:0},Ht={key:1};function Ft(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("VariableList"),s=Object(r["resolveComponent"])("VariableEdit");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",At,[e.editMode?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Pt,[Object(r["createVNode"])(l,{"id-container-version":e.idContainerVersion,"id-container":e.idContainer,"variables-help-text":e.variablesHelpText},null,8,["id-container-version","id-container","variables-help-text"])])),e.editMode?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Ht,[Object(r["createVNode"])(s,{"id-container-version":e.idContainerVersion,"id-container":e.idContainer,"id-variable":e.idVariable},null,8,["id-container-version","id-container","id-variable"])])):Object(r["createCommentVNode"])("",!0)])}var It=Object(r["defineComponent"])({props:{idContainerVersion:Number,idContainer:String,variablesHelpText:String},components:{VariableList:Ut,VariableEdit:Ke},data(){return{isAddAllowed:!1}},created(){Object(r["watch"])(()=>g["MatomoUrl"].hashParsed.value.idVariable,e=>{this.onIdVariableParamChange(e)}),g["NotificationsStore"].remove("variablevariablemanagement"),this.onIdVariableParamChange(g["MatomoUrl"].hashParsed.value.idVariable)},methods:{onIdVariableParamChange(e){if("0"===e){const e={isAllowed:!0};g["Matomo"].postEvent("TagManager.initAddVariable",e),this.isAddAllowed=!!e.isAllowed}}},computed:{idVariable(){const e=g["MatomoUrl"].hashParsed.value.idVariable;return this.isAddAllowed||"0"!==e?e?parseInt(e,10):e:null},editMode(){return"number"===typeof this.idVariable}}});It.render=Ft;var $t=It;const Gt={class:"editTrigger tagManagerManageEdit",ref:"root"},Rt={class:"loadingPiwik"},zt=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),qt={class:"loadingPiwik"},Wt=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Xt=["innerHTML"],Kt={class:"form-group row"},Jt={class:"col s12"},Yt={key:0},Zt={class:"form-group row"},Qt={class:"col s12"},ea={class:"form-group row multiple"},ta={class:"col s12 input-field m6"},aa={class:"col s12 input-field m6"},na={class:"form-help"},ia=["innerHTML"],ra={class:"col s12 m12"},oa={class:"innerFormField"},la={class:"innerFormField comparisonField"},sa={class:"innerFormField"},ca=["onClick","title"],da={class:"triggerConditionNode"},ga=["innerHTML"],ma={class:"entityCancel"},ba={id:"confirmSelectTriggerType"},ha={class:"collection-header"},pa=["onClick","title"],ua=["src"],Oa={class:"title"},ja={class:"secondary-content"},va=["title"],Ta={class:"entityCancel"};function Va(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("Field"),s=Object(r["resolveComponent"])("GroupedSettings"),c=Object(r["resolveComponent"])("SaveButton"),d=Object(r["resolveComponent"])("ContentBlock");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Gt,[Object(r["createVNode"])(d,{feature:"Tag Manager","content-title":e.editTitle},{default:Object(r["withCtx"])(()=>{var a,n,i,o;return[Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",Rt,[zt,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[r["vShow"],e.isLoading]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",qt,[Wt,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("TagManager_UpdatingData")),1)])],512),[[r["vShow"],e.isUpdating]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("form",{onSubmit:t[5]||(t[5]=t=>e.edit?e.updateTrigger():e.createTrigger())},[Object(r["createElementVNode"])("div",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("div",{class:"alert alert-danger",innerHTML:e.$sanitize(e.getNoCustomTemplatePermissionErrorMessage())},null,8,Xt),[[r["vShow"],e.isTriggerDisabled]]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"text",name:"name","model-value":e.trigger.name,"onUpdate:modelValue":t[0]||(t[0]=t=>{e.trigger.name=t,e.setValueHasChanged()}),maxlength:255,title:e.translate("General_Name"),"inline-help":e.translate("TagManager_TriggerNameHelp"),placeholder:e.translate("TagManager_TriggerNamePlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"textarea",name:"description","model-value":e.trigger.description,"onUpdate:modelValue":t[1]||(t[1]=t=>{e.trigger.description=t,e.setValueHasChanged()}),maxlength:1e3,title:e.translate("TagManager_Description"),"inline-help":e.translate("TagManager_TriggerDescriptionHelp"),placeholder:e.translate("TagManager_TriggerDescriptionPlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Kt,[Object(r["createElementVNode"])("div",Jt,[Object(r["createElementVNode"])("h3",null,Object(r["toDisplayString"])(e.translate("TagManager_ConfigureThisTrigger")),1)])],512),[[r["vShow"],null===(a=e.trigger.typeMetadata)||void 0===a||null===(a=a.parameters)||void 0===a?void 0:a.length]]),e.trigger?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Yt,[Object(r["createVNode"])(s,{settings:(null===(n=e.trigger.typeMetadata)||void 0===n?void 0:n.parameters)||[],"all-setting-values":e.parameterValues,onChange:t[2]||(t[2]=t=>e.parameterValues[t.name]=t.value)},null,8,["settings","all-setting-values"])])):Object(r["createCommentVNode"])("",!0),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Zt,[Object(r["createElementVNode"])("div",Qt,[Object(r["createElementVNode"])("h3",null,Object(r["toDisplayString"])(e.translate("TagManager_OnlyTriggerWhen"))+" "+Object(r["toDisplayString"])(e.translate("Goals_Optional")),1)])],512),[[r["vShow"],null===(i=e.trigger.typeMetadata)||void 0===i?void 0:i.hasAdvancedSettings]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("div",ea,[Object(r["createElementVNode"])("div",ta,[Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_TriggerConditionsHelp")),1)]),Object(r["createElementVNode"])("div",aa,[Object(r["createElementVNode"])("div",na,[Object(r["createElementVNode"])("span",{class:"inline-help",innerHTML:e.$sanitize(e.triggerInlineHelpText)},null,8,ia)])]),Object(r["createElementVNode"])("div",ra,[Object(r["createElementVNode"])("div",null,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.trigger.conditions,(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{key:a,class:Object(r["normalizeClass"])(["condition multiple valign-wrapper","condition"+a])},[Object(r["createElementVNode"])("div",oa,[Object(r["createVNode"])(l,{uicontrol:"expandable-select",name:"condition_actual","model-value":t.actual,"onUpdate:modelValue":a=>{t.actual=a,e.setValueHasChanged()},"full-width":!0,options:e.availableVariables,title:e.variableIdToName[t.actual]||t.actual},null,8,["model-value","onUpdate:modelValue","options","title"])]),Object(r["createElementVNode"])("div",la,[Object(r["createVNode"])(l,{uicontrol:"select",name:"condition_comparison","model-value":t.comparison,"onUpdate:modelValue":a=>{t.comparison=a,e.setValueHasChanged()},"full-width":!0,options:e.availableComparisons},null,8,["model-value","onUpdate:modelValue","options"])]),Object(r["createElementVNode"])("div",sa,[Object(r["createVNode"])(l,{uicontrol:"text",name:"condition_expected","model-value":t.expected,"onUpdate:modelValue":a=>{t.expected=a,e.setValueHasChanged(),e.onConditionChange()},"full-width":!0},null,8,["model-value","onUpdate:modelValue"])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",{class:"icon-minus valign",onClick:t=>e.removeConditionEntry(a),title:e.translate("General_Remove")},null,8,ca),[[r["vShow"],!(a+1===e.trigger.conditions.length)]])],2))),128))]),Object(r["createElementVNode"])("p",da,Object(r["toDisplayString"])(e.translate("TagManager_TriggerConditionNode")),1)])])],512),[[r["vShow"],null===(o=e.trigger.typeMetadata)||void 0===o?void 0:o.hasAdvancedSettings]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",{class:"alert alert-danger",innerHTML:e.$sanitize(e.getNoCustomTemplatePermissionErrorMessage())},null,8,ga),[[r["vShow"],e.isTriggerDisabled]]),e.isTriggerDisabled?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createBlock"])(c,{key:1,class:"createButton",onConfirm:t[3]||(t[3]=t=>e.edit?e.updateTrigger():e.createTrigger()),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.saveButtonText},null,8,["disabled","saving","value"])),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",ma,[Object(r["createElementVNode"])("a",{onClick:t[4]||(t[4]=t=>e.cancel())},Object(r["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[r["vShow"],!e.isEmbedded]])])],544),[[r["vShow"],!e.chooseTriggerType&&e.editTitle]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",ba,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.availableTriggers,(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("ul",{class:"collection with-header",key:a},[Object(r["createElementVNode"])("li",ha,[Object(r["createElementVNode"])("h4",null,Object(r["toDisplayString"])(t.name),1)]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(t.types,(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{class:Object(r["normalizeClass"])(["collection-item avatar",{disabledTemplate:e.isTriggerTemplateDisabled[t.id],["templateType"+t.id]:!0}]),onClick:a=>e.createTriggerType(t),key:a,title:e.isTriggerTemplateDisabled[t.id]?e.collectionItemAvatarText:""},[t.icon?(Object(r["openBlock"])(),Object(r["createElementBlock"])("img",{key:0,alt:"",class:"circle",src:t.icon},null,8,ua)):Object(r["createCommentVNode"])("",!0),Object(r["createElementVNode"])("span",Oa,Object(r["toDisplayString"])(t.name),1),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(t.description),513),[[r["vShow"],t.description]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",ja,[Object(r["createElementVNode"])("i",{class:"icon-help",title:t.help},null,8,va)],512),[[r["vShow"],!!t.help]])],10,pa))),128))]))),128)),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Ta,[Object(r["createElementVNode"])("a",{onClick:t[6]||(t[6]=t=>e.cancel())},Object(r["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[r["vShow"],!e.isEmbedded]])],512),[[r["vShow"],e.chooseTriggerType]])]}),_:1},8,["content-title"])],512)}function Ca(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */class ya{constructor(){Ca(this,"privateState",Object(r["reactive"])({triggers:[],isLoadingTriggers:!1,isLoadingSingle:!1,isUpdating:!1})),Ca(this,"state",Object(r["computed"])(()=>Object(r["readonly"])(this.privateState))),Ca(this,"isUpdating",Object(r["computed"])(()=>this.state.value.isUpdating)),Ca(this,"isLoading",Object(r["computed"])(()=>{const e=this.state.value;return e.isLoadingTriggers||e.isLoadingSingle})),Ca(this,"triggers",Object(r["computed"])(()=>this.state.value.triggers)),Ca(this,"fetchPromise",null),Ca(this,"availableTriggersPromises",{})}fetchTriggers(e,t){return this.privateState.triggers=[],this.privateState.isLoadingTriggers=!0,this.fetchPromise||(this.fetchPromise=g["AjaxHelper"].fetch({method:"TagManager.getContainerTriggers",idContainer:e,idContainerVersion:t,filter_limit:"-1"})),Promise.resolve(this.fetchPromise).then(e=>(this.privateState.triggers=e,this.triggers.value)).finally(()=>{this.privateState.isLoadingTriggers=!1})}fetchTriggersIfNotLoaded(e,t){this.fetchPromise||this.fetchTriggers(e,t)}fetchAvailableTriggers(e){return this.availableTriggersPromises[e]||(this.availableTriggersPromises[e]=g["AjaxHelper"].fetch({method:"TagManager.getAvailableTriggerTypesInContext",idContext:e,filter_limit:"-1"})),Promise.resolve(this.availableTriggersPromises[e])}findTrigger(e,t,a){const n=this.triggers.value.find(e=>e.idtrigger===a);return n?Promise.resolve(n):(this.privateState.isLoadingSingle=!0,g["AjaxHelper"].fetch({idTrigger:a,idContainer:e,idContainerVersion:t,method:"TagManager.getContainerTrigger",filter_limit:"-1"}).then(e=>(this.privateState.triggers=[...this.privateState.triggers,e],Object(r["readonly"])(e))).finally(()=>{this.privateState.isLoadingSingle=!1}))}suggestNameForType(e){for(let t=0;t<100;t+=1){let a=e;t&&(a=`${a} (${t})`);const n=!this.triggers.value.some(e=>e.name===a);if(n)return a}}createOrUpdateTrigger(e,t,a,n,i){const r=Object.entries(i).map(([e,t])=>{let a=t;return"boolean"===typeof t&&(a=(+t).toString()),[e,a]}),o=Object.fromEntries(r),l=e.conditions.filter(e=>e&&e.actual&&e.comparison&&e.expected);return this.privateState.isUpdating=!0,g["AjaxHelper"].post({idTrigger:e.idtrigger,method:t,idContainer:a,idContainerVersion:n,type:e.type,name:e.name,description:e.description},{parameters:o,conditions:l},{withTokenInUrl:!0}).finally(()=>{this.privateState.isUpdating=!1})}reload(e,t){return this.privateState.triggers=[],this.fetchPromise=null,this.availableTriggersPromises={},this.fetchTriggers(e,t)}deleteTrigger(e,t,a){return this.privateState.isUpdating=!0,this.privateState.triggers=[],g["AjaxHelper"].fetch({idTrigger:a,idContainerVersion:t,idContainer:e,method:"TagManager.deleteContainerTrigger"},{withTokenInUrl:!0}).finally(()=>{this.privateState.isUpdating=!1})}}var fa=new ya;const Na="tagvariablemanagement",Ea={AllElementsClick:"ClickId",AllLinksClick:"ClickId",DownloadClick:"ClickId",ElementVisibility:"VisibleElementClasses",FormSubmit:"FormId",JavaScriptError:"ErrorMessage"};var ka=Object(r["defineComponent"])({props:{idTrigger:Number,idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},newTriggerType:String,isEmbedded:{type:Boolean,default:!1}},components:{ContentBlock:g["ContentBlock"],Field:m["Field"],GroupedSettings:m["GroupedSettings"],SaveButton:m["SaveButton"]},data(){return{isDirty:!1,chooseTriggerType:!1,availableTriggers:[],availableVariables:[],variableIdToName:{},editTitle:"",trigger:{},parameterValues:{},isUpdatingTrigger:!1}},emits:["changeTrigger"],created(){qe.init(),g["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion}).then(e=>{e.forEach(e=>{e.types.forEach(t=>{this.variableIdToName[t.id]=t.name,this.availableVariables.push({key:t.id,value:t.name,group:e.name,tooltip:t.description})})})}),fa.fetchTriggersIfNotLoaded(this.idContainer,this.idContainerVersion),this.initIdTrigger()},watch:{idTrigger(e){null!==e&&this.initIdTrigger()},triggerParameterValues:{handler(e,t){e&&t&&(this.isDirty=!0)},deep:!0}},methods:{checkRequiredFieldsAreSet(){return!!this.trigger.name||(this.showErrorFieldNotProvidedNotification(Object(g["translate"])("General_Name")),!1)},removeAnyTriggerNotification(){g["NotificationsStore"].remove(Na),g["NotificationsStore"].remove("ajaxHelper")},showNotification(e,t,a=null){const n=g["NotificationsStore"].show({message:e,context:t,id:Na,type:null!==a?a:"toast"});setTimeout(()=>{g["NotificationsStore"].scrollToNotification(n)},200)},showErrorFieldNotProvidedNotification(e){const t=Object(g["translate"])("TagManager_ErrorXNotProvided",[e]);this.showNotification(t,"error")},initIdTrigger(){this.trigger={},this.chooseTriggerType=!1,this.editTitle="",g["Matomo"].helper.lazyScrollToContent(),this.availableTriggers=[],g["AjaxHelper"].fetch({method:"TagManager.getContainer",idContainer:this.idContainer,filter_limit:"-1"}).then(e=>fa.fetchAvailableTriggers(e.context)).then(e=>{this.availableTriggers=e}).then(()=>{if(this.edit&&this.idTrigger)return this.editTitle=Object(g["translate"])("TagManager_EditTrigger"),void fa.findTrigger(this.idContainer,this.idContainerVersion,this.idTrigger).then(e=>{var t;e&&(this.trigger=Object(g["clone"])(e),this.parameterValues=Object.fromEntries(e.typeMetadata.parameters.map(e=>[e.name,e.value])),this.addConditionEntryIfNoneExists(),this.onConditionChange(),this.isDirty=!1,null!==(t=this.trigger.typeMetadata)&&void 0!==t&&t.name&&(this.editTitle+=": "+this.trigger.typeMetadata.name))});this.create&&(this.editTitle=Object(g["translate"])("TagManager_ChooseTriggerToContinue"),this.chooseTriggerType=!0)})},onConditionChange(){const e=(this.trigger.conditions||[]).every(e=>!(null===e||void 0===e||!e.expected));e&&this.addConditionEntry()},addConditionEntryIfNoneExists(){this.trigger.conditions&&Array.isArray(this.trigger.conditions)||(this.trigger.conditions=[]),this.trigger.conditions.length||this.trigger.conditions.push(this.makeDefaultCondition())},addConditionEntry(){this.trigger.conditions.push(this.makeDefaultCondition()),this.isDirty=!0},removeConditionEntry(e){if(e>-1){const t=this.trigger.conditions.length-1;t===e?this.trigger.conditions[e]=this.makeDefaultCondition():this.trigger.conditions.splice(e,1),this.isDirty=!0}},createTriggerType(e){var t;e&&this.isTriggerTemplateDisabled[e.id]||(this.chooseTriggerType=!1,this.editTitle=Object(g["translate"])("TagManager_CreateNewTrigger"),this.trigger={idsite:parseInt(""+g["Matomo"].idSite,10),name:fa.suggestNameForType(e.name)||"",description:"",type:e.id,idcontainerversion:this.idContainerVersion,conditions:[],typeMetadata:e},null!==(t=this.trigger.typeMetadata)&&void 0!==t&&t.name&&(this.editTitle+=": "+this.trigger.typeMetadata.name),this.parameterValues=Object.fromEntries(e.parameters.map(e=>[e.name,e.value])),this.addConditionEntry(),this.isDirty=!0,Object(r["nextTick"])(()=>{if(!this.$refs.root)return;const e=this.$refs.root;e.scrollIntoView();const t=e.querySelector("#name");t&&t.focus()}))},cancel(){const e=Object.assign({},g["MatomoUrl"].hashParsed.value);delete e.idTrigger,g["MatomoUrl"].updateHash(e)},createTrigger(){this.removeAnyTriggerNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingTrigger=!0,fa.createOrUpdateTrigger(this.trigger,"TagManager.addContainerTrigger",this.idContainer,this.idContainerVersion,this.parameterValues).then(e=>{const t=e.value;this.isDirty=!1,fa.reload(this.idContainer,this.idContainerVersion).then(()=>{if(this.isEmbedded)return this.trigger.idtrigger=t,void this.$emit("changeTrigger",{trigger:this.trigger});this.cancel(),setTimeout(()=>{const e=Object(g["translate"])("TagManager_CreatedX",Object(g["translate"])("TagManager_Trigger"));if(this.hasPublishCapability()){const t=Object(g["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>");this.showNotification(`${e} ${t}`,"success","transient")}else this.showNotification(e,"success")},200)})}).finally(()=>{this.isUpdatingTrigger=!1}))},setValueHasChanged(){this.isDirty=!0},updateTrigger(){this.removeAnyTriggerNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingTrigger=!0,fa.createOrUpdateTrigger(this.trigger,"TagManager.updateContainerTrigger",this.idContainer,this.idContainerVersion,this.parameterValues).then(e=>{if(!e)return;if(this.isEmbedded)return this.$emit("changeTrigger",{trigger:this.trigger}),void fa.reload(this.idContainer,this.idContainerVersion);this.isDirty=!1,fa.reload(this.idContainer,this.idContainerVersion).then(()=>{this.initIdTrigger()}),this.cancel();const t=Object(g["translate"])("TagManager_UpdatedX",Object(g["translate"])("TagManager_Trigger"));if(this.hasPublishCapability()){const e=Object(g["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>");this.showNotification(`${t} ${e}`,"success","transient")}else this.showNotification(t,"success")}).finally(()=>{this.isUpdatingTrigger=!1}))},makeDefaultCondition(){var e;let t="PageUrl";if(null!==(e=this.trigger)&&void 0!==e&&e.typeMetadata){const e=this.trigger.typeMetadata.id;Ea[e]&&(t=Ea[e])}return{comparison:"equals",actual:t,expected:""}},hasPublishCapability(){return g["Matomo"].hasUserCapability("tagmanager_write")&&g["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},getNoCustomTemplatePermissionErrorMessage(){return Object(g["translate"])("TagManager_UseCustomTemplateCapabilityPermissionRequiredDescription","<strong>",Object(g["translate"])("TagManager_CapabilityUseCustomTemplates"),"</strong>")}},computed:{isLoading(){return fa.isLoading.value||qe.isLoading.value},isUpdating(){return fa.isUpdating.value||this.isUpdatingTrigger},create(){return 0===this.idTrigger},edit(){return!this.create},canUseCustomTemplates(){return g["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},isTriggerDisabled(){var e;return!this.canUseCustomTemplates&&(null===(e=this.trigger.typeMetadata)||void 0===e?void 0:e.isCustomTemplate)},saveButtonText(){return this.edit?Object(g["translate"])("CoreUpdater_UpdateTitle"):Object(g["translate"])("TagManager_CreateNewTrigger")},collectionItemAvatarText(){return Object(g["translate"])("TagManager_UseCustomTemplateCapabilityPermissionRequiredDescription","",Object(g["translate"])("TagManager_CapabilityUseCustomTemplates"),"")},triggerInlineHelpText(){return Object(g["translate"])("TagManager_TriggerConditionsHelpText",Object(g["externalLink"])("https://matomo.org/faq/tag-manager/create-a-trigger-to-track-interactions-on-all-nested-elements/"),"</a>")},availableComparisons(){return qe.comparisonOptions.value},isTriggerTemplateDisabled(){const e={};return this.availableTriggers.forEach(t=>{t.types.forEach(t=>{e[t.id]=!this.canUseCustomTemplates&&t.isCustomTemplate})}),e},triggerParameterValues(){var e;return null!==(e=this.trigger.typeMetadata)&&void 0!==e&&e.parameters?this.parameterValues:null}}});ka.render=Va;var Ma=ka;const Sa={class:"tagManagerManageList tagManagerTriggerList"},wa={class:"triggerSearchFilter"},_a=["title"],Da=["title"],xa=["title"],Ba=["title"],La=["title"],Ua=["title"],Aa={colspan:"7"},Pa={class:"loadingPiwik"},Ha=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Fa={colspan:"7"},Ia=["id"],$a=["title"],Ga=["title"],Ra=["title"],za={class:"conditions"},qa={class:"icon-ok"},Wa=["title"],Xa=["onClick","title"],Ka=["onClick","title"],Ja=["onClick","title"],Ya={class:"tableActionBar"},Za=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),Qa={class:"ui-confirm",id:"confirmDeleteTrigger",ref:"confirmDeleteTrigger"},en=["value"],tn=["value"],an={class:"ui-confirm",id:"confirmDeleteTriggerNotPossible",ref:"confirmDeleteTriggerNotPossible"},nn={class:"collection"},rn=["value"];function on(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("Field"),s=Object(r["resolveComponent"])("ContentBlock"),c=Object(r["resolveDirective"])("content-table");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Sa,[Object(r["createVNode"])(s,{feature:"Tag Manager","content-title":e.translate("TagManager_ManageX",e.translate("TagManager_Triggers")),"help-text":e.triggersHelpText},{default:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_TriggerUsageBenefits")),1),Object(r["createElementVNode"])("div",wa,[Object(r["withDirectives"])(Object(r["createVNode"])(l,{uicontrol:"text",name:"triggerSearch",title:e.translate("General_Search"),modelValue:e.triggerSearch,"onUpdate:modelValue":t[0]||(t[0]=t=>e.triggerSearch=t)},null,8,["title","modelValue"]),[[r["vShow"],e.triggers.length>0]])]),Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("table",null,[Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",{class:"name",title:e.nameTranslatedText},Object(r["toDisplayString"])(e.translate("General_Name")),9,_a),Object(r["createElementVNode"])("th",{class:"description",title:e.descriptionTranslatedText},Object(r["toDisplayString"])(e.translate("General_Description")),9,Da),Object(r["createElementVNode"])("th",{class:"type",title:e.typeTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_Type")),9,xa),Object(r["createElementVNode"])("th",{class:"conditions",title:e.filterTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_Filter")),9,Ba),Object(r["createElementVNode"])("th",{class:"lastUpdated",title:e.lastUpdatedTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_LastUpdated")),9,La),Object(r["withDirectives"])(Object(r["createElementVNode"])("th",{class:"action",title:e.actionTranslatedText},Object(r["toDisplayString"])(e.translate("General_Actions")),9,Ua),[[r["vShow"],e.hasWriteAccess]])])]),Object(r["createElementVNode"])("tbody",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",Aa,[Object(r["createElementVNode"])("span",Pa,[Ha,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[r["vShow"],e.isLoading||e.isUpdating]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",Fa,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_NoTriggersFound"))+" ",1),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createContainerTriggerNow",onClick:t[1]||(t[1]=t=>e.createTrigger())},Object(r["toDisplayString"])(e.translate("TagManager_CreateNewTriggerNow")),513),[[r["vShow"],e.hasWriteAccess]])])],512),[[r["vShow"],!e.isLoading&&0===e.triggers.length]]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedTriggers,t=>{var a;return Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{id:"trigger"+t.idtrigger,class:"triggers",key:t.idtrigger},[Object(r["createElementVNode"])("td",{class:"name",title:t.name},Object(r["toDisplayString"])(e.truncateText(t.name,50)),9,$a),Object(r["createElementVNode"])("td",{class:"description",title:t.description},Object(r["toDisplayString"])(e.truncateText(t.description,75)),9,Ga),Object(r["createElementVNode"])("td",{class:"type",title:t.typeMetadata.description},Object(r["toDisplayString"])(t.typeMetadata.name),9,Ra),Object(r["createElementVNode"])("td",za,[Object(r["withDirectives"])(Object(r["createElementVNode"])("span",qa,null,512),[[r["vShow"],null===(a=t.conditions)||void 0===a?void 0:a.length]])]),Object(r["createElementVNode"])("td",{class:"lastUpdated",title:e.translate("TagManager_CreatedOnX",t.created_date_pretty)},[Object(r["createElementVNode"])("span",null,Object(r["toDisplayString"])(t.updated_date_pretty),1)],8,Wa),Object(r["withDirectives"])(Object(r["createElementVNode"])("td",{class:Object(r["normalizeClass"])(e.getActionClasses)},[Object(r["createElementVNode"])("a",{class:"table-action icon-edit",onClick:a=>e.editTrigger(t.idtrigger,t.type),title:e.translate("TagManager_EditTrigger")},null,8,Xa),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-content-copy",onClick:a=>e.openCopyDialog(t),title:e.translate("TagManager_CopyX",e.translate("TagManager_Trigger"))},null,8,Ka),[[r["vShow"],e.hasPublishCapability()]]),Object(r["createElementVNode"])("a",{class:"table-action icon-delete",onClick:a=>e.deleteTrigger(t),title:e.translate("TagManager_DeleteX",e.translate("TagManager_Trigger"))},null,8,Ja)],2),[[r["vShow"],e.hasWriteAccess]])],8,Ia)}),128))])])),[[c]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Ya,[Object(r["createElementVNode"])("a",{class:"createNewTrigger",value:"",onClick:t[2]||(t[2]=t=>e.createTrigger())},[Za,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewTrigger")),1)])],512),[[r["vShow"],e.hasWriteAccess]])]),_:1},8,["content-title","help-text"]),Object(r["createElementVNode"])("div",Qa,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_DeleteTriggerConfirm")),1),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,en),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,tn)],512),Object(r["createElementVNode"])("div",an,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_TriggerCannotBeDeleted")),1),Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_TriggerBeingUsedBy")),1),Object(r["createElementVNode"])("ul",nn,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.triggerReferences,e=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{class:"collection-item",key:e.referenceId},Object(r["toDisplayString"])(e.referenceTypeName)+": "+Object(r["toDisplayString"])(e.referenceName),1))),128))]),Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_TriggerBeingUsedNeedsRemove")),1),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_Cancel")},null,8,rn)],512)])}const{tagManagerHelper:ln}=window;var sn=Object(r["defineComponent"])({props:{idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},triggersHelpText:String},components:{Field:m["Field"],ContentBlock:g["ContentBlock"]},directives:{ContentTable:g["ContentTable"]},data(){return{hasWriteAccess:g["Matomo"].hasUserCapability("tagmanager_write"),triggerReferences:[],triggerSearch:""}},created(){fa.fetchTriggers(this.idContainer,this.idContainerVersion)},methods:{createTrigger(){this.editTrigger(0)},editTrigger(e){g["MatomoUrl"].updateHash(Object.assign(Object.assign({},g["MatomoUrl"].hashParsed.value),{},{idTrigger:e}))},deleteTrigger(e){g["AjaxHelper"].fetch({method:"TagManager.getContainerTriggerReferences",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion,idTrigger:e.idtrigger}).then(t=>{if(t&&t.length)this.triggerReferences=t,g["Matomo"].helper.modalConfirm(this.$refs.confirmDeleteTriggerNotPossible,{});else{this.triggerReferences=[];const t=()=>{fa.deleteTrigger(this.idContainer,this.idContainerVersion,e.idtrigger).then(()=>{fa.reload(this.idContainer,this.idContainerVersion),g["NotificationsStore"].remove("CopyDialogResultNotification")})};g["Matomo"].helper.modalConfirm(this.$refs.confirmDeleteTrigger,{yes:t})}})},truncateText(e,t){return ln.truncateText(e,t)},hasPublishCapability(){return g["Matomo"].hasUserCapability("tagmanager_write")&&g["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},openCopyDialog(e){const t=g["MatomoUrl"].stringify({module:"TagManager",action:"copyTriggerDialog",idSite:e.idsite,idContainer:this.idContainer,idTrigger:e.idtrigger,idContainerVersion:this.idContainerVersion});window.Piwik_Popover.createPopupAndLoadUrl(t,"","mtmCopyTrigger")}},computed:{isLoading(){return fa.isLoading.value},isUpdating(){return fa.isUpdating.value},triggers(){return fa.triggers.value},sortedTriggers(){const e=this.triggerSearch.toLowerCase(),t=[...this.triggers].filter(t=>Object.keys(t).some(a=>{const n=t;let i="";if("string"===typeof n[a])i=n[a];else if("typeMetadata"===a){const e=n.typeMetadata;i=e.name}else if("parameters"===a&&"CustomEvent"===n.type){const e=n.parameters;i=e.eventName}return-1!==i.toLowerCase().indexOf(e)}));return t.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0),t},nameTranslatedText(){return this.translate("TagManager_TriggersNameDescription")},descriptionTranslatedText(){return this.translate("TagManager_TriggersDescriptionDescription")},typeTranslatedText(){return this.translate("TagManager_TriggersTypeDescription")},filterTranslatedText(){return this.translate("TagManager_TriggersFilterDescription")},lastUpdatedTranslatedText(){return this.translate("TagManager_TriggersLastUpdatedDescription")},actionTranslatedText(){return this.translate("TagManager_TriggersActionDescription")},getActionClasses(){const e=this.hasPublishCapability()?" hasCopyAction":"";return"action"+e}}});sn.render=on;var cn=sn;const dn={class:"manageTrigger"};function gn(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("TriggerList"),s=Object(r["resolveComponent"])("TriggerEdit");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",dn,[Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{"id-container":e.idContainer,"id-container-version":e.idContainerVersion,"triggers-help-text":e.triggersHelpText},null,8,["id-container","id-container-version","triggers-help-text"])])],512),[[r["vShow"],!e.editMode]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(s,{"id-container":e.idContainer,"id-container-version":e.idContainerVersion,"id-trigger":e.idTrigger},null,8,["id-container","id-container-version","id-trigger"])])],512),[[r["vShow"],e.editMode]])])}var mn=Object(r["defineComponent"])({props:{idContainerVersion:Number,idContainer:String,triggersHelpText:String},components:{TriggerList:cn,TriggerEdit:Ma},data(){return{isAddAllowed:!1}},created(){Object(r["watch"])(()=>g["MatomoUrl"].hashParsed.value.idTrigger,e=>{this.onIdTriggerParamChange(e)}),g["NotificationsStore"].remove("triggertriggermanagement"),this.onIdTriggerParamChange(g["MatomoUrl"].hashParsed.value.idTrigger)},methods:{onIdTriggerParamChange(e){if("0"===e){const e={isAllowed:!0};g["Matomo"].postEvent("TagManager.initAddTrigger",e),this.isAddAllowed=!!e.isAllowed}}},computed:{idTrigger(){const e=g["MatomoUrl"].hashParsed.value.idTrigger;return this.isAddAllowed||"0"!==e?e?parseInt(e,10):e:null},editMode(){return"number"===typeof this.idTrigger}}});mn.render=gn;var bn=mn;const hn={class:"editTag tagManagerManageEdit",ref:"root"},pn={class:"loadingPiwik"},un=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),On={class:"loadingPiwik"},jn=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),vn=["innerHTML"],Tn={class:"form-group row"},Vn={class:"col s12"},Cn={key:0},yn={class:"form-group row"},fn={class:"col s12"},Nn={class:"form-group row"},En={class:"col s12"},kn={class:"form-group row tagStartDate"},Mn={class:"col s12 m6"},Sn={class:"row"},wn={class:"col s12"},_n={for:"start_date_date",class:"active"},Dn={class:"tagStartDate"},xn={class:"col s12 m6"},Bn={class:"form-help"},Ln={class:"inline-help"},Un=["innerHTML"],An=Object(r["createElementVNode"])("br",null,null,-1),Pn=["innerHTML"],Hn={class:"form-group row tagEndDate"},Fn={class:"col s12 m6"},In={class:"row"},$n={class:"col s12"},Gn={for:"end_date_date",class:"active"},Rn={class:"tagEndDate"},zn={class:"col s12 m6"},qn={class:"form-help"},Wn={class:"inline-help"},Xn=["innerHTML"],Kn=Object(r["createElementVNode"])("br",null,null,-1),Jn=["innerHTML"],Yn=["innerHTML"],Zn={class:"entityCancel"},Qn={id:"confirmSelectTagType"},ei={class:"collection-header"},ti=["onClick","title"],ai=["src"],ni={class:"title"},ii={class:"secondary-content"},ri=["title"],oi={class:"entityCancel"};function li(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("Field"),s=Object(r["resolveComponent"])("GroupedSettings"),c=Object(r["resolveComponent"])("TagTriggerArray"),d=Object(r["resolveComponent"])("TagDateInput"),g=Object(r["resolveComponent"])("SaveButton"),m=Object(r["resolveComponent"])("ContentBlock");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",hn,[Object(r["createVNode"])(m,{feature:"Tag Manager","content-title":e.editTitle},{default:Object(r["withCtx"])(()=>{var a,n,i,o,m;return[Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",pn,[un,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[r["vShow"],e.isLoading]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",On,[jn,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("TagManager_UpdatingData")),1)])],512),[[r["vShow"],e.isUpdating]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("form",{onSubmit:t[18]||(t[18]=t=>e.edit?e.updateTag():e.createTag())},[Object(r["createElementVNode"])("div",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("div",{class:"alert alert-danger",innerHTML:e.$sanitize(e.getNoCustomTemplatePermissionErrorMessage())},null,8,vn),[[r["vShow"],e.isTagDisabled]]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"text",name:"name","model-value":e.tag.name,"onUpdate:modelValue":t[0]||(t[0]=t=>{e.tag.name=t,e.setValueHasChanged()}),maxlength:255,title:e.translate("General_Name"),"inline-help":e.tagNameHelpText,placeholder:e.translate("TagManager_TagNamePlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"textarea",name:"description","model-value":e.tag.description,"onUpdate:modelValue":t[1]||(t[1]=t=>{e.tag.description=t,e.setValueHasChanged()}),maxlength:1e3,title:e.translate("TagManager_Description"),placeholder:e.translate("TagManager_TagDescriptionPlaceholder")},null,8,["model-value","title","placeholder"])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Tn,[Object(r["createElementVNode"])("div",Vn,[Object(r["createElementVNode"])("h3",null,Object(r["toDisplayString"])(e.translate("TagManager_ConfigureWhatTagDoes")),1)])],512),[[r["vShow"],null===(a=e.tag.typeMetadata)||void 0===a?void 0:a.parameters.length]]),e.tag?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Cn,[Object(r["createVNode"])(s,{settings:(null===(n=e.tag.typeMetadata)||void 0===n?void 0:n.parameters)||[],"all-setting-values":e.parameterValues,onChange:t[2]||(t[2]=t=>{e.parameterValues[t.name]=t.value,e.setValueHasChanged()})},null,8,["settings","all-setting-values"])])):Object(r["createCommentVNode"])("",!0),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",yn,[Object(r["createElementVNode"])("div",fn,[Object(r["createElementVNode"])("h3",null,Object(r["toDisplayString"])(e.translate("TagManager_ConfigureWhenTagDoes")),1)])],512),[[r["vShow"],null===(i=e.tag.typeMetadata)||void 0===i?void 0:i.parameters.length]]),Object(r["createVNode"])(c,{"container-triggers":e.containerTriggers,type:"fire",title:e.translate("TagManager_FireTriggerTitle"),help:e.translate("TagManager_FireTriggerHelp",e.translate("TagManager_FireLimit")),"model-value":e.fireTriggers,"onUpdate:modelValue":t[3]||(t[3]=t=>{e.fireTriggers=t,e.setValueHasChanged(),e.onFireTriggerChange()}),onCreate:t[4]||(t[4]=t=>e.onCreateNewFireTrigger()),onEdit:t[5]||(t[5]=t=>e.editTrigger(t))},null,8,["container-triggers","title","help","model-value"]),Object(r["createVNode"])(c,{"container-triggers":e.containerTriggers,type:"block",title:e.translate("TagManager_BlockTriggerTitle"),help:e.translate("TagManager_BlockTriggerHelp"),"model-value":e.blockTriggers,"onUpdate:modelValue":t[6]||(t[6]=t=>{e.blockTriggers=t,e.setValueHasChanged(),e.onBlockTriggerChange()}),onCreate:t[7]||(t[7]=t=>e.onCreateNewBlockTrigger()),onEdit:t[8]||(t[8]=t=>e.editTrigger(t))},null,8,["container-triggers","title","help","model-value"]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Nn,[Object(r["createElementVNode"])("div",En,[Object(r["createElementVNode"])("h3",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{href:"",class:"showAdvancedSettings",onClick:t[9]||(t[9]=Object(r["withModifiers"])(t=>e.showAdvanced=!0,["prevent"]))},Object(r["toDisplayString"])(e.translate("TagManager_ShowAdvancedSettings")),513),[[r["vShow"],!e.showAdvanced]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{href:"",class:"hideAdvancedSettings",onClick:t[10]||(t[10]=Object(r["withModifiers"])(t=>e.showAdvanced=!1,["prevent"]))},Object(r["toDisplayString"])(e.translate("TagManager_HideAdvancedSettings")),513),[[r["vShow"],e.showAdvanced]])])])],512),[[r["vShow"],null===(o=e.tag.typeMetadata)||void 0===o?void 0:o.hasAdvancedSettings]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"radio",name:"fire_limit","model-value":e.tag.fire_limit,"onUpdate:modelValue":t[11]||(t[11]=t=>{e.tag.fire_limit=t,e.setValueHasChanged()}),options:e.availableFireLimits,title:e.translate("TagManager_FireLimit"),"inline-help":e.fireLimitHelp},null,8,["model-value","options","title","inline-help"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"text",name:"fire_delay","model-value":e.tag.fire_delay,"onUpdate:modelValue":t[12]||(t[12]=t=>{e.tag.fire_delay=t,e.setValueHasChanged()}),maxlength:8,title:e.translate("TagManager_FireDelay"),"inline-help":e.translate("TagManager_FireDelayHelp"),placeholder:e.translate("TagManager_PlaceholderZero")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"text",name:"priority","model-value":e.tag.priority,"onUpdate:modelValue":t[13]||(t[13]=t=>{e.tag.priority=t,e.setValueHasChanged()}),maxlength:4,title:e.translate("TagManager_Priority"),"inline-help":e.translate("TagManager_PriorityHelp"),placeholder:e.translate("TagManager_PriorityPlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createElementVNode"])("div",kn,[Object(r["createElementVNode"])("div",Mn,[Object(r["createElementVNode"])("div",Sn,[Object(r["createElementVNode"])("div",wn,[Object(r["createElementVNode"])("label",_n,Object(r["toDisplayString"])(e.translate("TagManager_StartDate"))+":",1)]),Object(r["createElementVNode"])("div",Dn,[Object(r["createVNode"])(d,{name:"start_date","model-value":e.tag.start_date,"onUpdate:modelValue":t[14]||(t[14]=t=>{e.tag.start_date=t,e.setValueHasChanged()}),"default-time":"00:00:00"},null,8,["model-value"])])])]),Object(r["createElementVNode"])("div",xn,[Object(r["createElementVNode"])("div",Bn,[Object(r["createElementVNode"])("span",Ln,[Object(r["createElementVNode"])("span",null,[Object(r["createElementVNode"])("span",{innerHTML:e.$sanitize(e.translate("TagManager_TagStartDateHelp","<strong>","</strong>"))},null,8,Un),An,Object(r["createElementVNode"])("span",{class:"currentLocalTime",innerHTML:e.$sanitize(e.translate("TagManager_CurrentTimeInLocalTimezone","<strong>",e.currentTime,"</strong>"))},null,8,Pn)])])])])]),Object(r["createElementVNode"])("div",Hn,[Object(r["createElementVNode"])("div",Fn,[Object(r["createElementVNode"])("div",In,[Object(r["createElementVNode"])("div",$n,[Object(r["createElementVNode"])("label",Gn,Object(r["toDisplayString"])(e.translate("TagManager_EndDate"))+":",1)]),Object(r["createElementVNode"])("div",Rn,[Object(r["createVNode"])(d,{name:"end_date","model-value":e.tag.end_date,"onUpdate:modelValue":t[15]||(t[15]=t=>{e.tag.end_date=t,e.setValueHasChanged()}),"default-time":"23:59:59"},null,8,["model-value"])])])]),Object(r["createElementVNode"])("div",zn,[Object(r["createElementVNode"])("div",qn,[Object(r["createElementVNode"])("span",Wn,[Object(r["createElementVNode"])("span",null,[Object(r["createElementVNode"])("span",{innerHTML:e.$sanitize(e.translate("TagManager_TagEndDateHelp","<strong>","</strong>"))},null,8,Xn),Kn,Object(r["createElementVNode"])("span",{class:"currentLocalTime",innerHTML:e.$sanitize(e.translate("TagManager_CurrentTimeInLocalTimezone","<strong>",e.currentTime,"</strong>"))},null,8,Jn)])])])])])],512),[[r["vShow"],e.showAdvanced&&(null===(m=e.tag.typeMetadata)||void 0===m?void 0:m.hasAdvancedSettings)]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",{class:"alert alert-danger",innerHTML:e.$sanitize(e.getNoCustomTemplatePermissionErrorMessage())},null,8,Yn),[[r["vShow"],e.isTagDisabled]]),e.isTagDisabled?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createBlock"])(g,{key:1,class:"createButton",onConfirm:t[16]||(t[16]=t=>e.edit?e.updateTag():e.createTag()),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.edit?e.translate("CoreUpdater_UpdateTitle"):e.translate("TagManager_CreateNewTag")},null,8,["disabled","saving","value"])),Object(r["createElementVNode"])("div",Zn,[Object(r["createElementVNode"])("a",{onClick:t[17]||(t[17]=t=>e.cancel())},Object(r["toDisplayString"])(e.translate("General_Cancel")),1)])])],544),[[r["vShow"],!e.chooseTagType&&e.editTitle]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Qn,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.availableTags,t=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("ul",{class:"collection with-header",key:t.name},[Object(r["createElementVNode"])("li",ei,[Object(r["createElementVNode"])("h4",null,Object(r["toDisplayString"])(t.name),1)]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(t.types,(t,a)=>Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{key:a,class:Object(r["normalizeClass"])(["collection-item avatar",{disabledTemplate:e.isTagTemplateDisabled[t.id],["templateType"+t.id]:!0}]),onClick:a=>e.createTagType(t),title:e.isTagTemplateDisabled[t.id]?e.collectionItemAvatarText:""},[t.icon?(Object(r["openBlock"])(),Object(r["createElementBlock"])("img",{key:0,alt:"",class:"circle",src:t.icon},null,8,ai)):Object(r["createCommentVNode"])("",!0),Object(r["createElementVNode"])("span",ni,Object(r["toDisplayString"])(t.name),1),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(t.description),513),[[r["vShow"],t.description]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",ii,[Object(r["createElementVNode"])("i",{class:"icon-help",title:t.help},null,8,ri)],512),[[r["vShow"],!!t.help]])],10,ti)),[[r["vShow"],e.isTagVisible(t.id)]])),128))]))),128)),Object(r["createElementVNode"])("div",oi,[Object(r["createElementVNode"])("a",{onClick:t[19]||(t[19]=t=>e.cancel())},Object(r["toDisplayString"])(e.translate("General_Cancel")),1)])],512),[[r["vShow"],e.chooseTagType]])]}),_:1},8,["content-title"])],512)}function si(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */class ci{constructor(){si(this,"privateState",Object(r["reactive"])({fireLimits:[],isLoading:!1})),si(this,"state",Object(r["computed"])(()=>Object(r["readonly"])(this.privateState))),si(this,"isLoading",Object(r["computed"])(()=>this.state.value.isLoading)),si(this,"fireLimits",Object(r["computed"])(()=>this.state.value.fireLimits)),si(this,"fireLimitsOptions",Object(r["computed"])(()=>this.fireLimits.value.map(({id:e,name:t})=>({key:e,value:t})))),si(this,"initializePromise",null)}init(){return this.initializePromise||(this.initializePromise=this.fetchAvailableFireLimits()),this.initializePromise}fetchAvailableFireLimits(){return this.privateState.isLoading=!0,g["AjaxHelper"].fetch({method:"TagManager.getAvailableTagFireLimits",filter_limit:"-1"}).then(e=>{let t;t=Array.isArray(e)?e:Object.values(e),this.privateState.fireLimits=t}).finally(()=>{this.privateState.isLoading=!1})}}var di=new ci;const gi={class:"col s12 m6"},mi=["for"],bi=Object(r["createElementVNode"])("br",null,null,-1),hi=["name"],pi=["onClick","title"],ui=["onClick","title"],Oi={class:"col s12 m6"},ji={class:"form-help"},vi={class:"inline-help"},Ti=Object(r["createElementVNode"])("br",null,null,-1),Vi=Object(r["createElementVNode"])("br",null,null,-1);function Ci(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("Field");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{class:Object(r["normalizeClass"])(["form-group row",e.type+"Triggers"])},[Object(r["createElementVNode"])("div",gi,[Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("label",{for:e.type+"_triggers"},Object(r["toDisplayString"])(e.title),9,mi),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[bi,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("TagManager_NoTriggersFound"))+". ",1),Object(r["createElementVNode"])("a",{class:"createNewTrigger",onClick:t[0]||(t[0]=t=>e.$emit("create"))},Object(r["toDisplayString"])(e.translate("TagManager_CreateNewTriggerNow")),1)],512),[[r["vShow"],0===e.containerTriggers.length]]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.modelValue,(t,a)=>Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{class:Object(r["normalizeClass"])(["multiple valign-wrapper",`${e.type}Trigger ${e.type}Trigger${a}`]),key:a},[Object(r["createElementVNode"])("div",{class:"innerFormField",name:e.type+"_triggers"},[Object(r["createVNode"])(l,{uicontrol:"select",name:e.type+"_triggers","model-value":t,"onUpdate:modelValue":t=>e.onChangeTrigger(t,a),"full-width":!0,options:e.containerTriggers},null,8,["name","model-value","onUpdate:modelValue","options"])],8,hi),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",{class:"icon-edit valign",onClick:a=>e.$emit("edit",t),title:e.translate("General_Edit")},null,8,pi),[[r["vShow"],t]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",{class:"icon-minus valign",onClick:t=>e.removeTrigger(a),title:e.translate("General_Remove")},null,8,ui),[[r["vShow"],a+1!==e.modelValue.length]])],2)),[[r["vShow"],e.containerTriggers.length]])),128))])]),Object(r["createElementVNode"])("div",Oi,[Object(r["createElementVNode"])("div",ji,[Object(r["createElementVNode"])("span",vi,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.help)+" ",1),Ti,Vi,Object(r["createElementVNode"])("a",{class:"createTriggerInHelp",onClick:t[1]||(t[1]=t=>e.$emit("create"))},Object(r["toDisplayString"])(e.translate("TagManager_CreateNewTriggerNow")),1)])])])],2)}var yi=Object(r["defineComponent"])({props:{type:{type:String,required:!0},help:{type:String,required:!0},title:{type:String,required:!0},containerTriggers:{type:Array,required:!0},modelValue:{type:Array,required:!0}},components:{Field:m["Field"]},emits:["update:modelValue","create","edit"],methods:{onChangeTrigger(e,t){const a=[...this.modelValue];a[t]=parseInt(e,10),this.$emit("update:modelValue",a)},removeTrigger(e){const t=[...this.modelValue];t.splice(e,1),this.$emit("update:modelValue",t)}}});yi.render=Ci;var fi=yi;const Ni={class:"col s12 m6 input-field"},Ei=["name","id","value"],ki={class:"col s12 m6 input-field"},Mi=["name","id","value"];function Si(e,t,a,n,i,o){return Object(r["openBlock"])(),Object(r["createElementBlock"])(r["Fragment"],null,[Object(r["createElementVNode"])("div",Ni,[Object(r["createElementVNode"])("input",{ref:"dateInput",type:"text",name:e.name+"_date",id:e.name+"_date",class:"dateInput",value:e.dateText,onKeydown:t[0]||(t[0]=t=>e.onDateKeydown(t)),onChange:t[1]||(t[1]=t=>e.onDateKeydown(t))},null,40,Ei)]),Object(r["createElementVNode"])("div",ki,[Object(r["createElementVNode"])("input",{ref:"timeInput",type:"text",name:e.name+"_time",id:e.name+"_time",class:"timeInput",value:e.timeText,onKeydown:t[2]||(t[2]=t=>e.onTimeKeydown(t))},null,40,Mi)])],64)}function wi(e){let t=String(e);return 1===t.length&&(t="0"+t),t}function _i(e){if(!e)return;let t=e;if(t){t=(""+t).replace(/-/g,"/");try{return new Date(t+" UTC")}catch(a){try{return new Date(Date.parse(t+" UTC"))}catch(n){const e=t.substr(0,10),a=t.substr(11),i=e.split("/"),r=a.split(":");if(3===i.length&&3===r.length){const e=new Date(parseInt(i[0],10),parseInt(i[1],10)-1,parseInt(i[2],10),parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)),t=e.getTime()+6e4*e.getTimezoneOffset();return new Date(t)}}}}}function Di(e){const t=_i(e);if(t){const e=wi(t.getMonth()+1),a=wi(t.getDate());return`${t.getFullYear()}-${e}-${a}`}const a=e.split(" ");return a[0]}function xi(e){const t=_i(e);if(t){const e=wi(t.getHours()),a=wi(t.getMinutes()),n=wi(t.getSeconds());return`${e}:${a}:${n}`}const a=e.split(" ");return a[1]}function Bi(e){let t=e;t&&(t=t.replace(/-/g,"/"));try{const e=new Date(t),a=wi(e.getUTCMonth()+1),n=wi(e.getUTCDate()),i=wi(e.getUTCHours()),r=wi(e.getUTCMinutes()),o=wi(e.getUTCSeconds());let l="";return l+=`${e.getUTCFullYear()}-${a}-${n}`,l+=" ",l+=`${i}:${r}:${o}`,l}catch(a){return t}}const{$:Li}=window;var Ui=Object(r["defineComponent"])({props:{name:{type:String,required:!0},defaultTime:{type:String,required:!0},modelValue:String},mounted(){const e=Object.assign(Object.assign({},g["Matomo"].getBaseDatePickerOptions(null)),{},{minDate:new Date});delete e.maxDate,Li(this.$refs.dateInput).datepicker(Object.assign({},e)),Li(this.$refs.timeInput).timepicker({timeFormat:"H:i:s"}).on("change",e=>{this.onTimeKeydown(e)})},computed:{dateText(){return this.modelValue?Di(this.modelValue):""},timeText(){return this.modelValue?xi(this.modelValue):""}},methods:{onDateKeydown(e){setTimeout(()=>{const{value:t}=e.target;this.dateText!==t&&this.onChange(t,this.timeText)})},onTimeKeydown(e){setTimeout(()=>{const{value:t}=e.target;this.timeText!==t&&this.onChange(this.dateText,t)})},onChange(e,t){if(!e)return void this.$emit("update:model-value",null);const a=t||this.defaultTime,n=Bi(`${e} ${a}`);this.$emit("update:model-value",n)}}});Ui.render=Si;var Ai=Ui;function Pi(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */class Hi{constructor(){Pi(this,"privateState",Object(r["reactive"])({tags:[],isLoadingTags:!1,isLoadingSingle:!1,isUpdating:!1})),Pi(this,"state",Object(r["computed"])(()=>Object(r["readonly"])(this.privateState))),Pi(this,"isLoading",Object(r["computed"])(()=>{const e=this.state.value;return e.isLoadingTags||e.isLoadingSingle})),Pi(this,"isUpdating",Object(r["computed"])(()=>this.state.value.isUpdating)),Pi(this,"tags",Object(r["computed"])(()=>this.state.value.tags)),Pi(this,"fetchPromise",null),Pi(this,"availableTagsPromises",{})}fetchTags(e,t){return this.privateState.isLoadingTags=!0,this.privateState.tags=[],this.fetchPromise||(this.fetchPromise=g["AjaxHelper"].fetch({method:"TagManager.getContainerTags",idContainer:e,idContainerVersion:t,filter_limit:"-1"})),Promise.resolve(this.fetchPromise).then(e=>(this.privateState.tags=e,this.privateState.isLoadingTags=!1,this.tags.value)).finally(()=>{this.privateState.isLoadingTags=!1})}reload(e,t){return this.privateState.tags=[],this.fetchPromise=null,this.availableTagsPromises={},this.fetchTags(e,t)}findTag(e,t,a){const n=this.tags.value.find(e=>e.idtag===a);return n?Promise.resolve(n):(this.privateState.isLoadingSingle=!0,g["AjaxHelper"].fetch({idTag:a,idContainer:e,idContainerVersion:t,method:"TagManager.getContainerTag",filter_limit:"-1"}).then(e=>(this.privateState.tags=[...this.privateState.tags,e],Object(r["readonly"])(e))).finally(()=>{this.privateState.isLoadingSingle=!1}))}fetchAvailableTags(e){return this.availableTagsPromises[e]||(this.availableTagsPromises[e]=g["AjaxHelper"].fetch({method:"TagManager.getAvailableTagTypesInContext",idContext:e,filter_limit:"-1"}).then(e=>Object(r["readonly"])(e))),Promise.resolve(this.availableTagsPromises[e])}createOrUpdateTag(e,t,a,n,i,r,o){this.privateState.isUpdating=!0;const l=Object.entries(i).map(([e,t])=>{let a=t;return"boolean"===typeof t&&(a=(+t).toString()),[e,a]}),s=Object.fromEntries(l);return g["AjaxHelper"].post({idTag:e.idtag,method:t,idContainer:a,idContainerVersion:n,type:e.type,name:e.name,description:e.description,startDate:e.start_date,endDate:e.end_date,fireLimit:e.fire_limit,fireDelay:e.fire_delay,priority:e.priority},{parameters:s,fireTriggerIds:r,blockTriggerIds:o},{withTokenInUrl:!0}).finally(()=>{this.privateState.isUpdating=!1})}deleteTag(e,t,a){return this.privateState.isUpdating=!0,this.privateState.tags=[],g["AjaxHelper"].fetch({idTag:a,idContainerVersion:t,idContainer:e,method:"TagManager.deleteContainerTag"},{withTokenInUrl:!0}).finally(()=>{this.privateState.isUpdating=!1})}pauseTag(e,t,a){return this.privateState.isUpdating=!0,this.privateState.tags=[],g["AjaxHelper"].fetch({idTag:a,idContainerVersion:t,idContainer:e,method:"TagManager.pauseContainerTag"},{withTokenInUrl:!0}).finally(()=>{this.privateState.isUpdating=!1})}resumeTag(e,t,a){return this.privateState.isUpdating=!0,this.privateState.tags=[],g["AjaxHelper"].fetch({idTag:a,idContainerVersion:t,idContainer:e,method:"TagManager.resumeContainerTag"},{withTokenInUrl:!0}).finally(()=>{this.privateState.isUpdating=!1})}suggestNameForType(e){for(let t=0;t<100;t+=1){let a=e;t&&(a=`${a} (${t})`);const n=!this.tags.value.some(e=>e.name===a);if(n)return a}}}var Fi=new Hi;function Ii(){const e=new Date;return e&&e.toString?e.toString():null}const{$:$i,tagManagerHelper:Gi}=window,Ri="tagtagmanagement";var zi=Object(r["defineComponent"])({props:{idTag:Number,idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},newTagType:null},components:{TagDateInput:Ai,ContentBlock:g["ContentBlock"],Field:m["Field"],SaveButton:m["SaveButton"],GroupedSettings:m["GroupedSettings"],TagTriggerArray:fi},data(){return{isDirty:!1,showAdvanced:!1,chooseTagType:!1,availableTags:[],containerTriggers:[],currentTime:null,tag:{},editTitle:"",parameterValues:{},isUpdatingTag:!1,fireTriggers:[],blockTriggers:[],currentTimeTimeout:null}},created(){di.init(),this.updateAvailableTriggers(),this.setCurrentTime(),Fi.reload(this.idContainer,this.idContainerVersion).then(()=>{this.initIdTag()})},unmounted(){this.currentTimeTimeout&&clearTimeout(this.currentTimeTimeout)},watch:{idTag(e){null!==e&&this.initIdTag()}},methods:{setCurrentTime(){this.currentTime=Ii(),this.currentTimeTimeout=setTimeout(this.setCurrentTime.bind(this),1e4)},updateAvailableTriggers(){g["AjaxHelper"].fetch({method:"TagManager.getContainerTriggers",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion,filter_limit:"-1"}).then(e=>{this.containerTriggers=e.map(e=>({key:e.idtrigger,value:e.name}))})},removeAnyTagNotification(){g["NotificationsStore"].remove(Ri),g["NotificationsStore"].remove("ajaxHelper")},showNotification(e,t,a=null){const n=g["NotificationsStore"].show({message:e,context:t,id:Ri,type:null!==a?a:"toast"});setTimeout(()=>{g["NotificationsStore"].scrollToNotification(n)},200)},showErrorFieldNotProvidedNotification(e){const t=Object(g["translate"])("TagManager_ErrorXNotProvided",[e]);this.showNotification(t,"error")},initIdTag(){this.tag={},this.chooseTagType=!1,this.editTitle="",g["Matomo"].helper.lazyScrollToContent(),this.availableTags=[],g["AjaxHelper"].fetch({method:"TagManager.getContainer",idContainer:this.idContainer,filter_limit:"-1"}).then(e=>Fi.fetchAvailableTags(e.context)).then(e=>{this.availableTags=e}).then(()=>{if(this.edit&&this.idTag)return this.editTitle=Object(g["translate"])("TagManager_EditTag"),void Fi.findTag(this.idContainer,this.idContainerVersion,this.idTag).then(e=>{var t;e&&(this.tag=Object(g["clone"])(e),this.parameterValues=Object.fromEntries(e.typeMetadata.parameters.map(e=>[e.name,e.value])),this.blockTriggers=[...this.tag.block_trigger_ids||[]],this.blockTriggers.length||this.blockTriggers.push(null),this.fireTriggers=[...this.tag.fire_trigger_ids||[]],this.fireTriggers.length||this.fireTriggers.push(null),this.onFireTriggerChange(),this.onBlockTriggerChange(),this.isDirty=!1,this.editTitle=Object(g["translate"])("TagManager_EditTag"),null!==(t=this.tag.typeMetadata)&&void 0!==t&&t.name&&(this.editTitle+=": "+this.tag.typeMetadata.name))});this.create&&(this.editTitle=Object(g["translate"])("TagManager_ChooseTagToContinue"),this.chooseTagType=!0)})},onCreateNewBlockTrigger(){this.openEditTrigger(e=>{const t=this.blockTriggers.length-1;this.blockTriggers[t]?this.blockTriggers.push(e.idtrigger):this.blockTriggers[t]=e.idtrigger,this.onBlockTriggerChange()},0)},onCreateNewFireTrigger(){this.openEditTrigger(e=>{const t=this.fireTriggers.length-1;this.fireTriggers[t]?this.fireTriggers.push(e.idtrigger):this.fireTriggers[t]=e.idtrigger,this.onFireTriggerChange()},0)},editTrigger(e){this.openEditTrigger(()=>null,e)},openEditTrigger(e,t){Gi.editTrigger(this.idContainer,this.idContainerVersion,t,t=>{this.updateAvailableTriggers(),e(t)})},onBlockTriggerChange(){const e=this.blockTriggers.every(e=>!!e);e&&this.addBlockTrigger()},addBlockTrigger(){this.blockTriggers.push(null),this.isDirty=!0},removeBlockTrigger(e){if(e>-1){const t=this.blockTriggers.length-1;t===e?this.blockTriggers[e]=null:this.blockTriggers.splice(e,1),this.isDirty=!0}},onFireTriggerChange(){const e=this.fireTriggers.every(e=>!!e);e&&this.addFireTrigger()},addFireTrigger(){this.fireTriggers.push(null),this.isDirty=!0},removeFireTrigger(e){if(e>-1){const t=this.fireTriggers.length-1;t===e?this.fireTriggers[e]=null:this.fireTriggers.splice(e,1),this.isDirty=!0}},createTagType(e){var t;e&&this.isTagTemplateDisabled[e.id]||(this.chooseTagType=!1,this.tag={idsite:parseInt(""+g["Matomo"].idSite,10),name:Fi.suggestNameForType(e.name)||"",type:e.id,fire_limit:"unlimited",priority:"GoogleTag"===e.id||"GoogleAnalytics4"===e.id?1:999,fire_delay:0,typeMetadata:e},this.editTitle=Object(g["translate"])("TagManager_CreateNewTag"),null!==(t=this.tag.typeMetadata)&&void 0!==t&&t.name&&(this.editTitle+=": "+this.tag.typeMetadata.name),this.blockTriggers=[null],this.fireTriggers=[null],this.parameterValues=Object.fromEntries(e.parameters.map(e=>[e.name,e.value])),this.isDirty=!1,setTimeout(()=>{const e=$i(this.$refs.root);e.length&&e[0]&&e[0].scrollIntoView(),e.find("#name").focus()},1))},cancel(){const e=Object.assign({},g["MatomoUrl"].hashParsed.value);delete e.idTag,g["MatomoUrl"].updateHash(e)},createTag(){this.removeAnyTagNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingTag=!0,Fi.createOrUpdateTag(this.tag,"TagManager.addContainerTag",this.idContainer,this.idContainerVersion,this.parameterValues,this.fireTriggers.filter(e=>!!e),this.blockTriggers.filter(e=>!!e)).then(e=>{e&&(this.isDirty=!1,Fi.reload(this.idContainer,this.idContainerVersion).then(()=>{this.cancel(),setTimeout(()=>{const e=Object(g["translate"])("TagManager_CreatedX",Object(g["translate"])("TagManager_Tag"));if(this.hasPublishCapability()){const t=Object(g["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>");this.showNotification(`${e} ${t}`,"success","transient")}else this.showNotification(e,"success")},200)}))}).finally(()=>{this.isUpdatingTag=!1}))},setValueHasChanged(){this.isDirty=!0},updateTag(){this.removeAnyTagNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingTag=!0,Fi.createOrUpdateTag(this.tag,"TagManager.updateContainerTag",this.idContainer,this.idContainerVersion,this.parameterValues,this.fireTriggers.filter(e=>!!e),this.blockTriggers.filter(e=>!!e)).then(e=>{if(!e)return;this.isDirty=!1,Fi.reload(this.idContainer,this.idContainerVersion).then(()=>{this.initIdTag()}),this.cancel();const t=Object(g["translate"])("TagManager_UpdatedX",Object(g["translate"])("TagManager_Tag"));if(this.hasPublishCapability()){const e=Object(g["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>");this.showNotification(`${t} ${e}`,"success","transient")}else this.showNotification(t,"success")}).finally(()=>{this.isUpdatingTag=!1}))},checkRequiredFieldsAreSet(){if(!this.tag.name){const e=Object(g["translate"])("General_Name");return this.showErrorFieldNotProvidedNotification(e),!1}return!(!this.fireTriggers||!this.fireTriggers.length)||(this.showNotification(Object(g["translate"])("TagManager_TagFireTriggerRequirement"),"error"),!1)},hasPublishCapability(){return g["Matomo"].hasUserCapability("tagmanager_write")&&g["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},isTagVisible(e){return!this.create||"GoogleAnalytics4"!==e},getNoCustomTemplatePermissionErrorMessage(){return Object(g["translate"])("TagManager_UseCustomTemplateCapabilityPermissionRequiredDescription","<strong>",Object(g["translate"])("TagManager_CapabilityUseCustomTemplates"),"</strong>")}},computed:{availableFireLimits(){return di.fireLimitsOptions.value},isLoading(){return fa.isLoading.value||di.isLoading.value},isUpdating(){return fa.isUpdating.value||this.isUpdatingTag},create(){return 0===this.idTag},edit(){return!this.create},canUseCustomTemplates(){return g["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},isTagDisabled(){var e;return!this.canUseCustomTemplates&&(null===(e=this.tag.typeMetadata)||void 0===e?void 0:e.isCustomTemplate)},isTagTemplateDisabled(){const e={};return this.availableTags.forEach(t=>{t.types.forEach(t=>{e[t.id]=!this.canUseCustomTemplates&&t.isCustomTemplate})}),e},collectionItemAvatarText(){return Object(g["translate"])("TagManager_UseCustomTemplateCapabilityPermissionRequiredDescription","",Object(g["translate"])("TagManager_CapabilityUseCustomTemplates"),"")},fireLimitHelp(){return Object(g["translate"])("TagManager_FireLimitHelp",Object(g["translate"])("TagManager_Unlimited"),Object(g["translate"])("TagManager_OncePage"),Object(g["translate"])("TagManager_Once24Hours"),Object(g["translate"])("TagManager_OnceLifetime"))},tagNameHelpText(){let e="";return"CustomHtml"===this.tag.type&&(e=Object(g["translate"])("TagManager_CustomHTMLTagNameInlineHelpText","<br><br><strong>","</strong>",Object(g["externalLink"])("https://matomo.org/faq/tag-manager/how-to-add-google-ads-remarketing-tags-in-matomo-tag-manager/"),"</a>")),Object(g["translate"])("TagManager_TagNameHelpV2")+e}}});zi.render=li;var qi=zi;const Wi={class:"tagManagerManageList tagManagerTagList"},Xi={class:"tagSearchFilter"},Ki=["title"],Ji=["title"],Yi=["title"],Zi=["title"],Qi=["title"],er=["title"],tr={colspan:"6"},ar={class:"loadingPiwik"},nr=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),ir={colspan:"6"},rr=["id"],or=["title"],lr=["title"],sr=["title"],cr={class:"triggers"},dr=["onClick","title"],gr=["title"],mr=["onClick","title"],br=["title"],hr=["title"],pr=["onClick","title"],ur=["onClick","title"],Or=["onClick","title"],jr=["onClick","title"],vr=["onClick","title"],Tr={class:"tableActionBar"},Vr=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),Cr={class:"ui-confirm",id:"confirmDeleteTag",ref:"confirmDeleteTag"},yr=["value"],fr=["value"],Nr={class:"ui-confirm",id:"confirmPauseTag",ref:"confirmPauseTag"},Er=["value"],kr=["value"],Mr={class:"ui-confirm",id:"confirmResumeTag",ref:"confirmResumeTag"},Sr=["value"],wr=["value"];function _r(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("Field"),s=Object(r["resolveComponent"])("ContentBlock"),c=Object(r["resolveDirective"])("content-table");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Wi,[Object(r["createVNode"])(s,{feature:"Tag Manager","content-title":e.translate("TagManager_ManageX",e.translate("TagManager_Tags")),"help-text":e.tagsHelpText},{default:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_TagUsageBenefits")),1),Object(r["createElementVNode"])("div",Xi,[Object(r["withDirectives"])(Object(r["createVNode"])(l,{uicontrol:"text",name:"tagSearch",title:e.translate("General_Search"),modelValue:e.tagSearch,"onUpdate:modelValue":t[0]||(t[0]=t=>e.tagSearch=t)},null,8,["title","modelValue"]),[[r["vShow"],e.tags.length>0]])]),Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("table",null,[Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",{class:"name",title:e.nameTranslatedText},Object(r["toDisplayString"])(e.translate("General_Name")),9,Ki),Object(r["createElementVNode"])("th",{class:"description",title:e.descriptionTranslatedText},Object(r["toDisplayString"])(e.translate("General_Description")),9,Ji),Object(r["createElementVNode"])("th",{class:"type",title:e.typeTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_Type")),9,Yi),Object(r["createElementVNode"])("th",{class:"triggers",title:e.triggersTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_Triggers")),9,Zi),Object(r["createElementVNode"])("th",{class:"lastUpdated",title:e.lastUpdatedTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_LastUpdated")),9,Qi),Object(r["withDirectives"])(Object(r["createElementVNode"])("th",{class:"action",title:e.actionTranslatedText},Object(r["toDisplayString"])(e.translate("General_Actions")),9,er),[[r["vShow"],e.hasWriteAccess]])])]),Object(r["createElementVNode"])("tbody",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",tr,[Object(r["createElementVNode"])("span",ar,[nr,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[r["vShow"],e.isLoading||e.isUpdating]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",ir,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_NoTagsFound"))+" ",1),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createContainerTagNow",onClick:t[1]||(t[1]=t=>e.createTag())},Object(r["toDisplayString"])(e.translate("TagManager_CreateNewTagNow")),513),[[r["vShow"],e.hasWriteAccess]])])],512),[[r["vShow"],!e.isLoading&&0===e.tags.length]]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedTags,t=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{class:"tags",key:t.idtag,id:"tag"+t.idtag},[Object(r["createElementVNode"])("td",{class:"name",title:t.name},Object(r["toDisplayString"])(e.truncateText(t.name,50)),9,or),Object(r["createElementVNode"])("td",{class:"description",title:t.description},Object(r["toDisplayString"])(e.truncateText(t.description,75)),9,lr),Object(r["createElementVNode"])("td",{class:"type",title:t.typeMetadata.description},Object(r["toDisplayString"])(t.typeMetadata.name),9,sr),Object(r["createElementVNode"])("td",cr,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(t.fire_trigger_ids,(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:a,style:{"margin-right":"3.5px"}},[e.hasWriteAccess?(Object(r["openBlock"])(),Object(r["createElementBlock"])("a",{key:0,style:{display:"inline-block","vertical-align":"top !important"},class:"chip",href:"",onClick:Object(r["withModifiers"])(a=>e.editTrigger(t),["prevent"]),title:this.triggers[t]},Object(r["toDisplayString"])(e.truncateText(this.triggers[t],e.triggerTruncateLength)),9,dr)):Object(r["createCommentVNode"])("",!0),e.hasWriteAccess?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:1,class:"chip",title:this.triggers[t]},Object(r["toDisplayString"])(e.truncateText(this.triggers[t],e.triggerTruncateLength)),9,gr))]))),128)),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",null,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_Except"))+": ",1),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(t.block_trigger_ids,(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:a,style:{"margin-right":"3.5px"}},[Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"chip",href:"",onClick:Object(r["withModifiers"])(a=>e.editTrigger(t),["prevent"]),title:this.triggers[t]},Object(r["toDisplayString"])(e.truncateText(this.triggers[t],e.triggerTruncateLength)),9,mr),[[r["vShow"],e.hasWriteAccess]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",{class:"chip",title:this.triggers[t]},Object(r["toDisplayString"])(e.truncateText(this.triggers[t],e.triggerTruncateLength)),9,br),[[r["vShow"],!e.hasWriteAccess]])]))),128))],512),[[r["vShow"],t.block_trigger_ids.length]])]),Object(r["createElementVNode"])("td",{class:"lastUpdated",title:e.translate("TagManager_CreatedOnX",t.created_date_pretty)},[Object(r["createElementVNode"])("span",null,Object(r["toDisplayString"])(t.updated_date_pretty),1)],8,hr),Object(r["withDirectives"])(Object(r["createElementVNode"])("td",{class:Object(r["normalizeClass"])(e.getActionClasses)},[Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-pause",onClick:a=>e.pauseTag(t),title:e.translate("TagManager_PauseX",e.translate("TagManager_Tag"))},null,8,pr),[[r["vShow"],"active"===t.status]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-play",onClick:a=>e.resumeTag(t),title:e.translate("TagManager_ResumeX",e.translate("TagManager_Tag"))},null,8,ur),[[r["vShow"],"paused"===t.status]]),Object(r["createElementVNode"])("a",{class:"table-action icon-edit",onClick:a=>e.editTag(t.idtag,t.type),title:e.translate("TagManager_EditTag")},null,8,Or),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-content-copy",onClick:a=>e.openCopyDialog(t),title:e.translate("TagManager_CopyX",e.translate("TagManager_Tag"))},null,8,jr),[[r["vShow"],e.hasPublishCapability()]]),Object(r["createElementVNode"])("a",{class:"table-action icon-delete",onClick:a=>e.deleteTag(t),title:e.translate("TagManager_DeleteX",e.translate("TagManager_Tag"))},null,8,vr)],2),[[r["vShow"],e.hasWriteAccess]])],8,rr))),128))])])),[[c]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Tr,[Object(r["createElementVNode"])("a",{class:"createNewTag",value:"",onClick:t[2]||(t[2]=t=>e.createTag())},[Vr,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewTag")),1)])],512),[[r["vShow"],e.hasWriteAccess]])]),_:1},8,["content-title","help-text"]),Object(r["createElementVNode"])("div",Cr,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_DeleteTagConfirm")),1),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,yr),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,fr)],512),Object(r["createElementVNode"])("div",Nr,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_PauseTagConfirm")),1),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,Er),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,kr)],512),Object(r["createElementVNode"])("div",Mr,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_ResumeTagConfirm")),1),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,Sr),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,wr)],512)])}const{tagManagerHelper:Dr}=window,xr="tagtagmanagementlist";var Br=Object(r["defineComponent"])({props:{idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},tagsHelpText:String},components:{ContentBlock:g["ContentBlock"],Field:m["Field"]},directives:{ContentTable:g["ContentTable"]},data(){return{hasWriteAccess:g["Matomo"].hasUserCapability("tagmanager_write"),triggerTruncateLength:40,tagSearch:""}},created(){Object(r["watch"])(()=>Fi.tags.value,()=>{this.reloadTriggers()}),this.reloadTriggers(),Fi.fetchTags(this.idContainer,this.idContainerVersion)},methods:{reloadTriggers(){fa.reload(this.idContainer,this.idContainerVersion)},createTag(){this.editTag(0)},editTrigger(e){Dr.editTrigger(this.idContainer,this.idContainerVersion,e,()=>{this.reloadTriggers()})},editTag(e){g["MatomoUrl"].updateHash(Object.assign(Object.assign({},g["MatomoUrl"].hashParsed.value),{},{idTag:e}))},pauseTag(e){const t=()=>{Fi.pauseTag(this.idContainer,this.idContainerVersion,e.idtag).then(()=>{Fi.reload(this.idContainer,this.idContainerVersion).then(()=>{setTimeout(()=>{this.showDeployNotification("pause")},200)})})};g["Matomo"].helper.modalConfirm("#confirmPauseTag",{yes:t})},resumeTag(e){const t=()=>{Fi.resumeTag(this.idContainer,this.idContainerVersion,e.idtag).then(()=>{Fi.reload(this.idContainer,this.idContainerVersion).then(()=>{setTimeout(()=>{this.showDeployNotification("resume")},200)})})};g["Matomo"].helper.modalConfirm("#confirmResumeTag",{yes:t})},deleteTag(e){const t=()=>{Fi.deleteTag(this.idContainer,this.idContainerVersion,e.idtag).then(()=>{Fi.reload(this.idContainer,this.idContainerVersion),g["NotificationsStore"].remove("CopyDialogResultNotification")})};g["Matomo"].helper.modalConfirm("#confirmDeleteTag",{yes:t})},truncateText(e,t){return Dr.truncateText(e,t)},hasPublishCapability(){return g["Matomo"].hasUserCapability("tagmanager_write")&&g["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},showDeployNotification(e){const t="pause"===e?"TagManager_PausedTag":"TagManager_ResumedTag",a=Object(g["translate"])(t,Object(g["translate"])("TagManager_Tag"));if(this.hasPublishCapability()){const e=Object(g["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>");this.showNotification(`${a} ${e}`,"success","transient")}else this.showNotification(a,"success")},showNotification(e,t,a=null){const n=g["NotificationsStore"].show({message:e,context:t,id:xr,type:null!==a?a:"toast"});setTimeout(()=>{g["NotificationsStore"].scrollToNotification(n)},200)},openCopyDialog(e){const t=g["MatomoUrl"].stringify({module:"TagManager",action:"copyTagDialog",idSite:e.idsite,idContainer:this.idContainer,idTag:e.idtag,idContainerVersion:this.idContainerVersion});window.Piwik_Popover.createPopupAndLoadUrl(t,"","mtmCopyTag")}},computed:{triggers(){const e={};return fa.triggers.value.forEach(t=>{e[""+t.idtrigger]=t.name}),e},isLoading(){return Fi.isLoading.value},isUpdating(){return Fi.isUpdating.value},tags(){return Fi.tags.value},sortedTags(){const e=this.tagSearch.toLowerCase(),t=[...this.tags].filter(t=>Object.keys(t).some(a=>{const n=t;let i="";if("string"===typeof n[a])i=n[a];else if("typeMetadata"===a){const e=n.typeMetadata;i=e.name}else if("fire_trigger_ids"===a)this.triggers&&n.fire_trigger_ids&&Object.values(n.fire_trigger_ids).forEach(e=>{this.triggers[e]&&(i+=this.triggers[e]+" ")});else if("parameters"===a&&"CustomHtml"===n.type){const e=n.parameters;i=e.customHtml}return-1!==i.toLowerCase().indexOf(e)}));return t.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0),t},nameTranslatedText(){return this.translate("TagManager_TagsNameDescription")},descriptionTranslatedText(){return this.translate("TagManager_TagsDescriptionDescription")},typeTranslatedText(){return this.translate("TagManager_TagsTypeDescription")},triggersTranslatedText(){return this.translate("TagManager_TagsTriggersDescription")},lastUpdatedTranslatedText(){return this.translate("TagManager_TagsLastUpdatedDescription")},actionTranslatedText(){return this.translate("TagManager_TagsActionDescription")},getActionClasses(){const e=this.hasPublishCapability()?" hasCopyAction":"";return"action"+e}}});Br.render=_r;var Lr=Br;const Ur={class:"manageTag"},Ar={key:0},Pr={key:1};function Hr(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("TagList"),s=Object(r["resolveComponent"])("TagEdit");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Ur,[e.editMode?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Ar,[Object(r["createVNode"])(l,{"id-container":e.idContainer,"id-container-version":e.idContainerVersion,"tags-help-text":e.tagsHelpText},null,8,["id-container","id-container-version","tags-help-text"])])),e.editMode?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Pr,[Object(r["createVNode"])(s,{"id-container":e.idContainer,"id-container-version":e.idContainerVersion,"id-tag":e.idTag},null,8,["id-container","id-container-version","id-tag"])])):Object(r["createCommentVNode"])("",!0)])}var Fr=Object(r["defineComponent"])({props:{idContainerVersion:Number,idContainer:String,tagsHelpText:String},components:{TagList:Lr,TagEdit:qi},data(){return{isAddAllowed:!1}},created(){Object(r["watch"])(()=>g["MatomoUrl"].hashParsed.value.idTag,e=>{this.onIdTagParamChange(e)}),g["NotificationsStore"].remove("tagtagmanagement"),this.onIdTagParamChange(g["MatomoUrl"].hashParsed.value.idTag)},methods:{onIdTagParamChange(e){if("0"===e){const e={isAllowed:!0};g["Matomo"].postEvent("TagManager.initAddTag",e),this.isAddAllowed=!!e.isAllowed}}},computed:{idTag(){const e=g["MatomoUrl"].hashParsed.value.idTag;return this.isAddAllowed||"0"!==e?e?parseInt(e,10):e:null},editMode(){return"number"===typeof this.idTag}}});Fr.render=Hr;var Ir=Fr;const $r={class:"editVersion tagManagerManageEdit"},Gr={class:"loadingPiwik"},Rr=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),zr={class:"loadingPiwik"},qr=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Wr={key:0},Xr={key:0},Kr={key:1},Jr=["innerHTML"],Yr={key:2,class:"versionChanges"},Zr={key:0},Qr={colspan:"4"},eo={key:1},to={colspan:"4"},ao={class:"lastUpdated"},no={class:"entityCancel"};function io(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("Field"),s=Object(r["resolveComponent"])("SaveButton"),c=Object(r["resolveComponent"])("ActivityIndicator"),d=Object(r["resolveComponent"])("ContentBlock"),g=Object(r["resolveDirective"])("content-table");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",$r,[Object(r["createVNode"])(d,{feature:"Tag Manager","content-title":e.editTitle},{default:Object(r["withCtx"])(()=>{var a;return[Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",Gr,[Rr,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[r["vShow"],e.isLoading]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",zr,[qr,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("TagManager_UpdatingData")),1)])],512),[[r["vShow"],e.isUpdating]]),Object(r["createElementVNode"])("form",{onSubmit:t[6]||(t[6]=t=>e.edit?e.updateVersion():e.createVersion())},[Object(r["createElementVNode"])("div",null,[e.hasPublishCapability()||e.hasWriteCapability()&&e.hasPublishToLiveCapability()?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Wr,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"text",name:"name","inline-help":e.versionNameHelpText,"inline-help-bind":{lastVersion:e.lastVersion},"model-value":e.version.name,"onUpdate:modelValue":t[0]||(t[0]=t=>{e.version.name=t,e.setValueHasChanged()}),maxlength:50,title:e.translate("TagManager_VersionName"),placeholder:e.translate("TagManager_VersionNamePlaceholder")},null,8,["inline-help","inline-help-bind","model-value","title","placeholder"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"textarea",name:"description","model-value":e.version.description,"onUpdate:modelValue":t[1]||(t[1]=t=>{e.version.description=t,e.setValueHasChanged()}),title:e.translate("TagManager_VersionDescriptionOptional"),"inline-help":e.translate("TagManager_VersionDescriptionHelp"),placeholder:e.translate("TagManager_VersionDescriptionPlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createVNode"])(s,{class:"createButton no-publish",onConfirm:t[2]||(t[2]=t=>e.edit?e.updateVersion():e.createVersion()),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.edit?e.translate("CoreUpdater_UpdateTitle"):e.translate("TagManager_CreateVersionWithoutPublishing")},null,8,["disabled","saving","value"]),e.create&&e.environments.length?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Xr,[Object(r["createVNode"])(l,{uicontrol:"select",name:"environment","inline-help":e.selectTagManagerEnvironmentHelp,"inline-help-bind":{canPublishToLive:e.canPublishToLive},"model-value":null===(a=e.version.environments)||void 0===a?void 0:a[0],"onUpdate:modelValue":t[3]||(t[3]=t=>{e.version.environments[0]=t,e.setValueHasChanged()}),options:e.environments,introduction:e.translate("TagManager_OrCreateAndPublishVersion"),title:e.translate("TagManager_Environment")},null,8,["inline-help","inline-help-bind","model-value","options","introduction","title"])])):Object(r["createCommentVNode"])("",!0),e.create&&e.environments.length?(Object(r["openBlock"])(),Object(r["createBlock"])(s,{key:1,class:"publishButton",onConfirm:t[4]||(t[4]=t=>e.createVersionAndPublish()),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.translate("TagManager_CreateVersionAndPublishRelease")},null,8,["disabled","saving","value"])):Object(r["createCommentVNode"])("",!0)])):(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Kr,[Object(r["createElementVNode"])("div",{class:"alert alert-warning",innerHTML:e.$sanitize(e.showNoAccessErrorMessage)},null,8,Jr)])),e.lastVersion?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Yr,[Object(r["createElementVNode"])("h3",null,Object(r["toDisplayString"])(e.translate("TagManager_ChangesSinceLastVersion"))+":",1),Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("table",null,[Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",null,Object(r["toDisplayString"])(e.translate("SitesManager_Type")),1),Object(r["createElementVNode"])("th",null,Object(r["toDisplayString"])(e.translate("General_Name")),1),Object(r["createElementVNode"])("th",null,Object(r["toDisplayString"])(e.translate("TagManager_Change")),1),Object(r["createElementVNode"])("th",null,Object(r["toDisplayString"])(e.translate("TagManager_LastUpdated")),1)])]),Object(r["createElementVNode"])("tbody",null,[e.isLoadingVersionChanges?(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",Zr,[Object(r["createElementVNode"])("td",Qr,[Object(r["createVNode"])(c,{"loading-message":e.translate("TagManager_DetectingChanges"),loading:!0},null,8,["loading-message"])])])):Object(r["createCommentVNode"])("",!0),e.versionChanges.length||e.isLoadingVersionChanges?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",eo,[Object(r["createElementVNode"])("td",to,Object(r["toDisplayString"])(e.translate("UserCountryMap_None")),1)])),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.versionChanges,(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{key:a},[Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.translate(t.entityType)),1),Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(t.name),1),Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.translate(t.type)),1),Object(r["createElementVNode"])("td",ao,[Object(r["createElementVNode"])("span",null,Object(r["toDisplayString"])(t.lastChanged),1)])]))),128))])])),[[g]])])):Object(r["createCommentVNode"])("",!0),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",no,[Object(r["createElementVNode"])("a",{onClick:t[5]||(t[5]=t=>e.cancel())},Object(r["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[r["vShow"],!e.isEmbedded]])])],32)]}),_:1},8,["content-title"])])}function ro(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */class oo{constructor(){ro(this,"privateState",Object(r["reactive"])({environmentsWithPublish:[],isLoading:!1})),ro(this,"state",Object(r["computed"])(()=>Object(r["readonly"])(this.privateState))),ro(this,"isLoading",Object(r["computed"])(()=>this.state.value.isLoading)),ro(this,"environmentsWithPublish",Object(r["computed"])(()=>this.state.value.environmentsWithPublish)),ro(this,"environmentsWithPublishOptions",Object(r["computed"])(()=>this.environmentsWithPublish.value.map(({id:e,name:t,disabled:a})=>({key:e,value:t,disabled:!1})))),ro(this,"initializePromise",null)}init(){return this.initializePromise||(this.initializePromise=this.fetchEnvironments()),this.initializePromise}fetchEnvironments(){return this.privateState.isLoading=!0,g["AjaxHelper"].fetch({method:"TagManager.getAvailableEnvironmentsWithPublishCapability",filter_limit:"-1"}).then(e=>{let t;t=Array.isArray(e)?e:Object.values(e),this.privateState.environmentsWithPublish=t}).finally(()=>{this.privateState.isLoading=!1})}}var lo=new oo;
/**
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function so(e,t,a){function n(e,t){return e.find(e=>e.name===t)}function i(e,t,a,i){const r=[];return t.forEach(t=>{const o=n(a,t.name);o?i.some(a=>JSON.stringify(t[a])!==JSON.stringify(o[a])&&(r.push({entityType:e,type:"status"===a&&"paused"===t[a]?"TagManager_DiffPaused":"TagManager_DiffModified",name:t.name,lastChanged:t.updated_date_pretty}),!0)):"paused"===t.status?r.push({entityType:e,type:"TagManager_DiffAddedPaused",name:t.name,lastChanged:t.updated_date_pretty}):r.push({entityType:e,type:"TagManager_DiffAdded",name:t.name,lastChanged:t.updated_date_pretty})}),a.forEach(a=>{n(t,a.name)||r.push({entityType:e,type:"TagManager_DiffDeleted",name:a.name,lastChanged:a.updated_date_pretty})}),r}function r(e,t){e.forEach(e=>{e.fire_triggers=[],e.block_triggers=[],e.fire_trigger_ids.forEach(a=>{const n=t.find(e=>e.idtrigger===a);n&&e.fire_triggers.push(n.name)}),e.block_trigger_ids.forEach(a=>{const n=t.find(e=>e.idtrigger===a);n&&e.block_triggers.push(n.name)})})}const o={module:"API",method:"TagManager.exportContainerVersion",format:"json",idContainer:e,filter_limit:-1};t&&(o.idContainerVersion=t);const l={module:"API",method:"TagManager.exportContainerVersion",format:"json",idContainer:e,idContainerVersion:a,filter_limit:-1};return g["AjaxHelper"].fetch([o,l]).then(([e,t])=>{r(e.tags,e.triggers),r(t.tags,t.triggers);const a=i("TagManager_Tag",e.tags,t.tags,["name","type","fire_limit","priority","fire_delay","fire_triggers","block_triggers","parameters","status"]),n=i("TagManager_Trigger",e.triggers,t.triggers,["name","type","conditions","parameters"]),o=i("TagManager_Variable",e.variables,t.variables,["name","type","lookup_table","default_value","parameters"]);return[...a,...n,...o]})}function co(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */class go{constructor(){co(this,"privateState",Object(r["reactive"])({versions:[],isLoadingVersions:!1,isLoadingSingle:!1,isUpdating:!1})),co(this,"state",Object(r["computed"])(()=>Object(r["readonly"])(this.privateState))),co(this,"isLoading",Object(r["computed"])(()=>{const e=this.state.value;return e.isLoadingVersions||e.isLoadingSingle})),co(this,"isUpdating",Object(r["computed"])(()=>this.state.value.isUpdating)),co(this,"versions",Object(r["computed"])(()=>this.state.value.versions)),co(this,"fetchPromise",null)}reload(e){return this.privateState.versions=[],this.fetchPromise=null,this.fetchVersions(e)}fetchVersions(e){return this.privateState.isLoadingVersions=!0,this.privateState.versions=[],this.fetchPromise||(this.fetchPromise=g["AjaxHelper"].fetch({method:"TagManager.getContainerVersions",idContainer:e,filter_limit:"-1"})),Promise.resolve(this.fetchPromise).then(e=>(this.privateState.versions=e,this.privateState.isLoadingVersions=!1,this.versions.value)).finally(()=>{this.privateState.isLoadingVersions=!1})}findVersion(e,t){const a=this.versions.value.find(e=>e.idcontainerversion===t);return a?Promise.resolve(a):(this.privateState.isLoadingSingle=!0,g["AjaxHelper"].fetch({idContainerVersion:t,idContainer:e,method:"TagManager.getContainerVersion",filter_limit:"-1"}).then(e=>(this.privateState.versions=[...this.privateState.versions,e],Object(r["readonly"])(e))).finally(()=>{this.privateState.isLoadingSingle=!1}))}deleteVersion(e,t){return this.privateState.isUpdating=!0,this.privateState.versions=[],g["AjaxHelper"].fetch({idContainerVersion:t,idContainer:e,method:"TagManager.deleteContainerVersion"},{withTokenInUrl:!0}).finally(()=>{this.privateState.isUpdating=!1})}publishVersion(e,t,a){return this.privateState.isUpdating=!0,g["AjaxHelper"].fetch({idContainer:e,idContainerVersion:t,environment:a,method:"TagManager.publishContainerVersion"}).finally(()=>{this.privateState.isUpdating=!1})}createOrUpdateVersion(e,t,a){return this.privateState.isUpdating=!0,g["AjaxHelper"].post({method:t,idContainer:a,idContainerVersion:e.idcontainerversion},{name:e.name,description:e.description},{withTokenInUrl:!0}).finally(()=>{this.privateState.isUpdating=!1})}}var mo=new go;const bo={id:"versionNameHelpText",class:"inline-help-node"},ho=Object(r["createElementVNode"])("br",null,null,-1),po=Object(r["createElementVNode"])("br",null,null,-1),uo=["innerHTML"];function Oo(e,t,a,n,i,o){return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",bo,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_VersionNameHelp"))+" ",1),ho,po,Object(r["withDirectives"])(Object(r["createElementVNode"])("span",{innerHTML:e.$sanitize(e.translate("TagManager_NameOfLatestVersion",`<strong>${e.lastVersion}</strong>`))},null,8,uo),[[r["vShow"],e.lastVersion]])])}var jo=Object(r["defineComponent"])({props:{lastVersion:String}});jo.render=Oo;var vo=jo;const To={id:"selectTagManagerEnvironmentHelp",class:"inline-help-node"};function Vo(e,t,a,n,i,o){return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",To,[Object(r["createElementVNode"])("div",null,Object(r["toDisplayString"])(e.translate("TagManager_VersionEnvironmentHelp")),1),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",{class:"alert alert-info",style:{"margin-bottom":"0","padding-bottom":"0"}},Object(r["toDisplayString"])(e.translate("TagManager_PublishLiveEnvironmentCapabilityRequired",e.translate("TagManager_CapabilityPublishLiveContainer"))),513),[[r["vShow"],!e.canPublishToLive]])])}var Co=Object(r["defineComponent"])({props:{canPublishToLive:Boolean}});Co.render=Vo;var yo=Co;const fo="versiontagmanagement";var No=Object(r["defineComponent"])({props:{idContainerVersion:{type:Number,required:!0},idContainer:{type:String,required:!0},isEmbedded:{type:Boolean,default:!1}},components:{ContentBlock:g["ContentBlock"],Field:m["Field"],SaveButton:m["SaveButton"],ActivityIndicator:g["ActivityIndicator"]},directives:{ContentTable:g["ContentTable"]},data(){return{isDirty:!1,lastVersion:null,versionChanges:[],isLoadingVersionChanges:!1,isUpdatingVersion:!1,version:{}}},emits:["changeVersion"],created(){qe.init(),lo.init(),this.initIdContainerVersion()},watch:{idContainerVersion(e){null!==e&&this.initIdContainerVersion()}},methods:{removeAnyVersionNotification(){g["NotificationsStore"].remove(fo),g["NotificationsStore"].remove("ajaxHelper")},showNotification(e,t,a=null){const n=g["NotificationsStore"].show({message:e,context:t,id:fo,type:null!==a?a:"toast"});setTimeout(()=>{g["NotificationsStore"].scrollToNotification(n)},200)},showErrorFieldNotProvidedNotification(e){const t=Object(g["translate"])("TagManager_ErrorXNotProvided",[e]);this.showNotification(t,"error")},initIdContainerVersion(){if(this.version={},this.lastVersion=null,this.versionChanges=[],this.isLoadingVersionChanges=!0,mo.fetchVersions(this.idContainer).then(()=>{var e;this.isLoadingVersionChanges=!1,this.lastVersion=null;const t=[...mo.versions.value];if(null===t||void 0===t||!t.length)return;t.sort((e,t)=>e.revision<t.revision?1:0);let a=null;this.create&&null!==(e=t[0])&&void 0!==e&&e.name?(this.lastVersion=g["Matomo"].helper.htmlEntities(t[0].name),a=t[0].idcontainerversion):this.edit&&t.forEach((e,n)=>{n>=t.length-1||e.idcontainerversion===this.idContainerVersion&&t[n+1]&&(this.lastVersion=g["Matomo"].helper.htmlEntities(t[n+1].name),a=t[n+1].idcontainerversion)}),this.lastVersion&&(this.isLoadingVersionChanges=!0,so(this.idContainer,this.idContainerVersion,a).then(e=>{e.sort((e,t)=>new Date(t.lastChanged).valueOf()-new Date(e.lastChanged).valueOf()),this.versionChanges=e,this.isLoadingVersionChanges=!1}),this.create&&!this.version.name&&/^\d+$/.test(this.lastVersion)&&(this.version.name=""+(parseInt(this.lastVersion,10)+1),this.isDirty=!0))}),g["Matomo"].helper.lazyScrollToContent(),this.edit&&this.idContainerVersion)mo.findVersion(this.idContainer,this.idContainerVersion).then(e=>{e&&(this.version=Object(g["clone"])(e),this.isDirty=!1)});else if(this.create){if(this.version={idSite:g["Matomo"].idSite,idcontainer:this.idContainer,name:"",description:""},this.canPublishToLive)this.version.environments=["live"];else{const e=this.environments.find(e=>"live"!==e.key);this.version.environments=e?[e.key]:[]}this.isDirty=!1}},cancel(){const e=Object.assign({},g["MatomoUrl"].hashParsed.value);delete e.idContainerVersion,g["MatomoUrl"].updateHash(e)},createVersion(){this.removeAnyVersionNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVersion=!0,mo.createOrUpdateVersion(this.version,"TagManager.createContainerVersion",this.idContainer).then(e=>{if(!e)return;this.isDirty=!1;const t=e.value;this.isEmbedded&&(this.version.idcontainerversion=t,this.$emit("changeVersion",{version:this.version})),mo.reload(this.idContainer).then(()=>{this.isEmbedded?g["MatomoUrl"].updateHash(Object.assign({},g["MatomoUrl"].hashParsed.value)):g["MatomoUrl"].updateHash(Object.assign(Object.assign({},g["MatomoUrl"].hashParsed.value),{},{idContainerVersion:t})),setTimeout(()=>{const e=Object(g["translate"])("TagManager_CreatedX",Object(g["translate"])("TagManager_Version"));if(this.hasPublishCapability()){const t=Object(g["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>");this.showNotification(`${e} ${t}`,"success","transient")}else this.showNotification(e,"success")},200)})}).finally(()=>{this.isUpdatingVersion=!1}))},createVersionAndPublish(){this.removeAnyVersionNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVersion=!0,mo.createOrUpdateVersion(this.version,"TagManager.createContainerVersion",this.idContainer).then(e=>{if(!e)return null;const t=e.value;return this.version.idcontainerversion=t,mo.publishVersion(this.idContainer,t,this.version.environments[0]).then(()=>{this.isDirty=!1,this.isEmbedded&&this.$emit("changeVersion",{version:this.version}),mo.reload(this.idContainer).then(()=>{this.isEmbedded?g["MatomoUrl"].updateHash(Object.assign({},g["MatomoUrl"].hashParsed.value)):g["MatomoUrl"].updateHash(Object.assign(Object.assign({},g["MatomoUrl"].hashParsed.value),{},{idContainerVersion:t})),setTimeout(()=>{this.showNotification(Object(g["translate"])("TagManager_VersionPublishSuccess"),"success")},200)})})}).finally(()=>{this.isUpdatingVersion=!1}))},setValueHasChanged(){this.isDirty=!0},updateVersion(){this.removeAnyVersionNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVersion=!0,mo.createOrUpdateVersion(this.version,"TagManager.updateContainerVersion",this.idContainer).then(e=>{e&&(this.isEmbedded?this.$emit("changeVersion",{version:this.version}):(this.isDirty=!1,this.version={},mo.reload(this.idContainer).then(()=>{this.initIdContainerVersion()}),this.showNotification(Object(g["translate"])("TagManager_UpdatedX",Object(g["translate"])("TagManager_Version")),"success")))}).finally(()=>{this.isUpdatingVersion=!1}))},checkRequiredFieldsAreSet(){if(!this.version.name){const e=Object(g["translate"])("General_Name");return this.showErrorFieldNotProvidedNotification(e),!1}return!0},hasPublishCapability(){return this.hasWriteCapability()&&g["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},hasWriteCapability(){return g["Matomo"].hasUserCapability("tagmanager_write")},hasPublishToLiveCapability(){return g["Matomo"].hasUserCapability("tagmanager_publish_live_container")}},computed:{create(){return 0===this.idContainerVersion},edit(){return!this.create},isLoading(){return Ge.isLoading.value||qe.isLoading.value},isUpdating(){return Ge.isUpdating.value||this.isUpdatingVersion},environments(){const e=lo.environmentsWithPublishOptions.value;if(!this.canPublishToLive){const t=e.findIndex(e=>"live"===e.key);t>-1&&(e[t].disabled=!0)}return e},canPublishToLive(){return g["Matomo"].hasUserCapability("tagmanager_publish_live_container")},versionNameHelpText(){return Object(r["markRaw"])(vo)},selectTagManagerEnvironmentHelp(){return Object(r["markRaw"])(yo)},editTitle(){return this.create?Object(g["translate"])("TagManager_CreateNewVersion"):Object(g["translate"])("TagManager_EditVersion")},showNoAccessErrorMessage(){return Object(g["translate"])("TagManager_VersionEditWithNoAccessMessage",Object(g["externalLink"])("https://matomo.org/faq/tag-manager/faq_26547/"),"</a>")}}});No.render=io;var Eo=No;const ko={class:"tagManagerManageList tagManagerVersionList"},Mo={class:"versionSearchFilter"},So=["title"],wo=["title"],_o=["title"],Do=["title"],xo=["title"],Bo=["title"],Lo={colspan:"7"},Uo={class:"loadingPiwik"},Ao=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Po={colspan:"7"},Ho=["id"],Fo={class:"index"},Io=["title"],$o=["title"],Go={class:"environments"},Ro=["title"],zo={class:"created"},qo={class:"action"},Wo=["onClick","title"],Xo=["onClick","title"],Ko=["onClick","href","title"],Jo=["onClick","title"],Yo=["onClick","title"],Zo={class:"tableActionBar"},Qo=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),el=["href"],tl=Object(r["createElementVNode"])("span",{class:"icon-export"}," ",-1),al=Object(r["createElementVNode"])("span",{class:"icon-upload"}," ",-1),nl={class:"ui-confirm",id:"confirmDeleteVersion",ref:"confirmDeleteVersion"},il=["value"],rl=["value"],ol={class:"ui-confirm",id:"confirmPublishVersion",ref:"confirmPublishVersion"},ll={key:0,class:"alert alert-info",style:{"margin-top":"16px"}},sl=["value"],cl=["value"];function dl(e,t,a,n,i,o){var l;const s=Object(r["resolveComponent"])("Field"),c=Object(r["resolveComponent"])("ContentBlock"),d=Object(r["resolveDirective"])("content-table");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",ko,[Object(r["createVNode"])(c,{feature:"Tag Manager","content-title":e.translate("TagManager_ManageX",e.translate("TagManager_Versions")),"help-text":e.versionsHelpText},{default:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_VersionUsageBenefits"))+" "+Object(r["toDisplayString"])(e.translate("TagManager_ConfigureEnvironmentsSuperUser")),1),Object(r["createElementVNode"])("div",Mo,[Object(r["withDirectives"])(Object(r["createVNode"])(s,{uicontrol:"text",name:"versionSearch",title:e.translate("General_Search"),modelValue:e.versionSearch,"onUpdate:modelValue":t[0]||(t[0]=t=>e.versionSearch=t)},null,8,["title","modelValue"]),[[r["vShow"],e.versions.length>0]])]),Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("table",null,[Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",{class:"index",title:e.revisionTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_Revision")),9,So),Object(r["createElementVNode"])("th",{class:"name",title:e.nameTranslatedText},Object(r["toDisplayString"])(e.translate("General_Name")),9,wo),Object(r["createElementVNode"])("th",{class:"description",title:e.descriptionTranslatedText},Object(r["toDisplayString"])(e.translate("General_Description")),9,_o),Object(r["createElementVNode"])("th",{class:"environments",title:e.environmentTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_Environments")),9,Do),Object(r["createElementVNode"])("th",{class:"created",title:e.createdTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_Created")),9,xo),Object(r["createElementVNode"])("th",{class:"action",title:e.actionTranslatedText},Object(r["toDisplayString"])(e.translate("General_Actions")),9,Bo)])]),Object(r["createElementVNode"])("tbody",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",Lo,[Object(r["createElementVNode"])("span",Uo,[Ao,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[r["vShow"],e.isLoading||e.isUpdating]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",Po,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_NoVersionsFound"))+" ",1),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createContainerVersionNow",onClick:t[1]||(t[1]=t=>e.createVersion())},Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVersionNow")),513),[[r["vShow"],e.hasWriteAccess&&e.hasCustomTemplatesCapability]])])],512),[[r["vShow"],!e.isLoading&&0===e.versions.length]]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedVersions,t=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{id:"version"+t.idcontainerversion,class:"versions",key:t.revision},[Object(r["createElementVNode"])("td",Fo,Object(r["toDisplayString"])(t.revision),1),Object(r["createElementVNode"])("td",{class:"name",title:t.name},Object(r["toDisplayString"])(e.truncateText(t.name,50)),9,Io),Object(r["createElementVNode"])("td",{class:"description",title:t.description},Object(r["toDisplayString"])(e.truncateText(t.description,75)),9,$o),Object(r["createElementVNode"])("td",Go,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(t.releases,(a,n)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:n,title:e.translate("TagManager_ReleaseInfo",a.release_login,a.release_date_pretty)},[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.ucfirst(a.environment)),1),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",null,", ",512),[[r["vShow"],n!==t.releases.length-1]])],8,Ro))),128))]),Object(r["createElementVNode"])("td",zo,[Object(r["createElementVNode"])("span",null,Object(r["toDisplayString"])(t.created_date_pretty),1)]),Object(r["createElementVNode"])("td",qo,[Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-rocket",onClick:a=>e.publishVersion(t),title:e.translate("TagManager_PublishVersion",t.name)},null,8,Wo),[[r["vShow"],e.hasWriteAccess&&(e.hasCustomTemplatesCapability||e.canPublishToLive)]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-bug",onClick:a=>e.enableDebugMode(t.idcontainerversion),title:e.translate("TagManager_EnablePreviewDebug")},null,8,Xo),[[r["vShow"],e.hasWriteAccess]]),Object(r["createElementVNode"])("a",{target:"_blank",class:"table-action icon-export",onClick:Object(r["withModifiers"])(a=>{e.exportVersion(t.idcontainerversion,t.name)},["prevent"]),href:e.getExportUrl(t),title:e.translate("TagManager_ExportX",e.translate("TagManager_Version"))},null,8,Ko),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-edit",onClick:a=>e.editVersion(t.idcontainerversion),title:e.translate("TagManager_EditX",e.translate("TagManager_Version"))},null,8,Jo),[[r["vShow"],e.hasWriteAccess]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-delete",onClick:a=>e.deleteVersion(t),title:e.translate("TagManager_DeleteX",e.translate("TagManager_Version"))},null,8,Yo),[[r["vShow"],0===t.releases.length&&e.hasWriteAccess&&e.hasCustomTemplatesCapability]])])],8,Ho))),128))])])),[[d]]),Object(r["createElementVNode"])("div",Zo,[Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createNewVersion",onClick:t[2]||(t[2]=t=>e.createVersion())},[Qo,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVersion")),1)],512),[[r["vShow"],e.hasWriteAccess&&e.hasCustomTemplatesCapability]]),Object(r["createElementVNode"])("a",{class:"exportDraft",target:"_blank",onClick:t[3]||(t[3]=t=>{e.exportVersion(null,"draft"),t.preventDefault()}),href:e.getExportDraftUrl()},[tl,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_ExportDraft")),1)],8,el),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"importVersion",onClick:t[4]||(t[4]=t=>e.importVersion())},[al,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_Import")),1)],512),[[r["vShow"],e.hasWriteAccess&&e.hasCustomTemplatesCapability]])])]),_:1},8,["content-title","help-text"]),Object(r["createElementVNode"])("div",nl,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_DeleteVersionConfirm")),1),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,il),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,rl)],512),Object(r["createElementVNode"])("div",ol,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_PublishVersion",null===(l=e.versionToBePublished)||void 0===l?void 0:l.name)),1),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(s,{uicontrol:"select",name:"environment",modelValue:e.availableEnvironmentsToPublish.deployEnvironment,"onUpdate:modelValue":t[5]||(t[5]=t=>e.availableEnvironmentsToPublish.deployEnvironment=t),options:e.availableEnvironmentsToPublish.environnments,"full-width":!0,title:e.translate("TagManager_Environment")},null,8,["modelValue","options","title"])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",{style:{"margin-bottom":"0"},class:"alert alert-info"},Object(r["toDisplayString"])(e.translate("TagManager_PublishLiveEnvironmentCapabilityRequired",e.translate("TagManager_CapabilityPublishLiveContainer"))),513),[[r["vShow"],!e.canPublishToLive]])],512),[[r["vShow"],e.availableEnvironmentsToPublish.environnments.length]]),e.availableEnvironmentsToPublish.environnments.length?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",ll,Object(r["toDisplayString"])(e.translate("TagManager_VersionAlreadyPublishedToAllEnvironments")),1)),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("TagManager_PublishRelease")},null,8,sl),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_Cancel")},null,8,cl)],512)])}const{tagManagerHelper:gl}=window;var ml=Object(r["defineComponent"])({props:{idContainer:{type:String,required:!0},versionsHelpText:String},components:{ContentBlock:g["ContentBlock"],Field:m["Field"]},directives:{ContentTable:g["ContentTable"]},data(){return{versionToBePublished:null,versionSearch:""}},created(){lo.init(),mo.fetchVersions(this.idContainer)},methods:{createVersion(){this.editVersion(0)},truncateText(e,t){return gl.truncateText(e,t)},publishVersion(e){this.versionToBePublished=e,g["Matomo"].helper.modalConfirm(this.$refs.confirmPublishVersion,{yes:()=>{const{deployEnvironment:t}=this.availableEnvironmentsToPublish;t&&mo.publishVersion(e.idcontainer,e.idcontainerversion,t).then(()=>{mo.reload(this.idContainer)})}})},enableDebugMode(e){gl.enablePreviewMode(this.idContainer,e)},exportVersion(e,t){const a={module:"API",method:"TagManager.exportContainerVersion",format:"json",idContainer:this.idContainer,filter_limit:-1};e&&(a.idContainerVersion=e);let n="container_"+this.idContainer;t&&(n+="_"+t),g["AjaxHelper"].fetch(a).then(e=>{g["Matomo"].helper.sendContentAsDownload(n+".json",JSON.stringify(e))})},editVersion(e){g["MatomoUrl"].updateHash(Object.assign(Object.assign({},g["MatomoUrl"].hashParsed.value),{},{idContainerVersion:e}))},importVersion(){gl.importVersion(this.idContainer)},deleteVersion(e){const t=()=>{mo.deleteVersion(this.idContainer,e.idcontainerversion).then(()=>{mo.reload(this.idContainer)})};g["Matomo"].helper.modalConfirm(this.$refs.confirmDeleteVersion,{yes:t})},ucfirst(e){return`${e.substring(0,1).toUpperCase()}${e.substring(1)}`},getExportUrl(e){return"?module=TagManager&action=exportContainerVersion&idContainer="+this.idContainer+`&idContainerVersion=${e.idcontainerversion}&idSite=${e.idsite}&period=day&date=yesterday`},getExportDraftUrl(){return"?module=TagManager&action=exportContainerVersion&idContainer="+this.idContainer+`&idSite=${this.idSite}&period=day&date=yesterday`}},computed:{environments(){return lo.environmentsWithPublishOptions.value},availableEnvironmentsToPublish(){let e="";const t=this.environments.filter(t=>{var a,n;if(null===(a=this.versionToBePublished)||void 0===a||!a.releases)return!0;const i=null===(n=this.versionToBePublished)||void 0===n?void 0:n.releases.some(e=>e.environment===(null===t||void 0===t?void 0:t.key));return i||e||(e=t.key),!i});return{deployEnvironment:e,environnments:t}},idSite(){return g["Matomo"].idSite},isLoading(){return mo.isLoading.value},isUpdating(){return mo.isUpdating.value},versions(){return mo.versions.value},sortedVersions(){const e=this.versionSearch.toLowerCase(),t=[...this.versions].filter(t=>Object.keys(t).some(a=>{const n=t;let i="";return"string"===typeof n[a]?i=n[a]:"releases"===a&&Object.values(n.releases).forEach(e=>{e.environment&&(i+=e.environment+" ")}),-1!==i.toLowerCase().indexOf(e)}));return t.sort((e,t)=>e.revision<t.revision?1:e.revision>t.revision?0:1),t},hasWriteAccess(){return g["Matomo"].hasUserCapability("tagmanager_write")},hasCustomTemplatesCapability(){return g["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},canPublishToLive(){return g["Matomo"].hasUserCapability("tagmanager_publish_live_container")},revisionTranslatedText(){return this.translate("TagManager_VersionsRevisionDescription")},nameTranslatedText(){return this.translate("TagManager_VersionsNameDescription")},descriptionTranslatedText(){return this.translate("TagManager_VersionsDescriptionDescription")},environmentTranslatedText(){return this.translate("TagManager_VersionsEnvironmentsDescription")},createdTranslatedText(){return this.translate("TagManager_VersionsCreatedDescription")},actionTranslatedText(){return this.translate("TagManager_VersionsActionDescription")}}});ml.render=dl;var bl=ml;const hl={class:"manageVersion"},pl={key:0},ul={key:1};function Ol(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("VersionList"),s=Object(r["resolveComponent"])("VersionEdit");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",hl,[e.editMode?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",pl,[Object(r["createVNode"])(l,{"id-container":e.idContainer,"versions-help-text":e.versionsHelpText},null,8,["id-container","versions-help-text"])])),e.editMode?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",ul,[Object(r["createVNode"])(s,{"id-container":e.idContainer,"id-container-version":e.idContainerVersion},null,8,["id-container","id-container-version"])])):Object(r["createCommentVNode"])("",!0)])}var jl=Object(r["defineComponent"])({props:{idContainer:String,versionsHelpText:String},components:{VersionList:bl,VersionEdit:Eo},data(){return{isAddAllowed:!1}},created(){Object(r["watch"])(()=>g["MatomoUrl"].hashParsed.value.idContainerVersion,e=>{this.onIdContainerVersionParamChange(e)}),g["NotificationsStore"].remove("versiontagmanagement"),this.onIdContainerVersionParamChange(g["MatomoUrl"].hashParsed.value.idContainerVersion)},methods:{onIdContainerVersionParamChange(e){if("0"===e){const e={isAllowed:!0};g["Matomo"].postEvent("TagManager.initAddVersion",e),this.isAddAllowed=!!e.isAllowed}}},computed:{idContainerVersion(){const e=g["MatomoUrl"].hashParsed.value.idContainerVersion;return this.isAddAllowed||"0"!==e?e?parseInt(e,10):e:null},editMode(){return"number"===typeof this.idContainerVersion}}});jl.render=Ol;var vl=jl;const Tl={class:"loadingPiwik"},Vl=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Cl={class:"loadingPiwik"},yl=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),fl={class:"entityCancel"};function Nl(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("Field"),s=Object(r["resolveComponent"])("SaveButton"),c=Object(r["resolveComponent"])("ContentBlock");return Object(r["openBlock"])(),Object(r["createBlock"])(c,{class:"editContainer tagManagerManageEdit",feature:"Tag Manager","content-title":e.editTitle},{default:Object(r["withCtx"])(()=>[Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",Tl,[Vl,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[r["vShow"],e.isLoading]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",Cl,[yl,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("TagManager_UpdatingData")),1)])],512),[[r["vShow"],e.isUpdating]]),Object(r["createElementVNode"])("form",{onSubmit:t[8]||(t[8]=t=>e.edit?e.updateContainer():e.createContainer())},[Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("div",null,[Object(r["withDirectives"])(Object(r["createVNode"])(l,{uicontrol:"text",name:"idcontainer","model-value":e.container.idcontainer,disabled:!0,title:e.translate("General_Id")},null,8,["model-value","title"]),[[r["vShow"],e.edit]])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"select",name:"context","model-value":e.container.context,"onUpdate:modelValue":t[0]||(t[0]=t=>{e.container.context=t,e.setValueHasChanged()}),disabled:!0,options:e.contexts,title:e.translate("TagManager_Context"),"inline-help":e.translate("TagManager_ContainerContextHelp")},null,8,["model-value","options","title","inline-help"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"text",name:"name","model-value":e.container.name,"onUpdate:modelValue":t[1]||(t[1]=t=>{e.container.name=t,e.setValueHasChanged()}),maxlength:255,title:e.translate("General_Name"),"inline-help":e.translate("TagManager_ContainerNameHelp"),placeholder:e.translate("TagManager_ContainerNamePlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"textarea",name:"description","model-value":e.container.description,"onUpdate:modelValue":t[2]||(t[2]=t=>{e.container.description=t,e.setValueHasChanged()}),title:e.translate("TagManager_Description"),"inline-help":e.translate("TagManager_ContainerDescriptionHelp"),placeholder:e.translate("TagManager_ContainerDescriptionPlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"checkbox",name:"ignoreGtmDataLayer","model-value":e.container.ignoreGtmDataLayer,"onUpdate:modelValue":t[3]||(t[3]=t=>{e.container.ignoreGtmDataLayer=t,e.setValueHasChanged()}),title:e.translate("TagManager_IgnoreGtmDataLaterTitle"),"inline-help":e.translate("TagManager_IgnoreGtmDataLaterDescription")},null,8,["model-value","title","inline-help"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"checkbox",name:"activelySyncGtmDataLayer","model-value":e.container.activelySyncGtmDataLayer,"onUpdate:modelValue":t[4]||(t[4]=t=>{e.container.activelySyncGtmDataLayer=t,e.setValueHasChanged()}),title:e.translate("TagManager_ActivelySyncGtmDataLayerTitle"),"inline-help":e.translate("TagManager_ActivelySyncGtmDataLayerDescription")},null,8,["model-value","title","inline-help"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"checkbox",name:"isTagFireLimitAllowedInPreviewMode","model-value":e.container.isTagFireLimitAllowedInPreviewMode,"onUpdate:modelValue":t[5]||(t[5]=t=>{e.container.isTagFireLimitAllowedInPreviewMode=t,e.setValueHasChanged()}),title:e.translate("TagManager_TagFireLimitAllowedInPreviewModeTitle"),"inline-help":e.translate("TagManager_TagFireLimitAllowedInPreviewModeDescription")},null,8,["model-value","title","inline-help"])]),Object(r["createVNode"])(s,{class:"createButton",onConfirm:t[6]||(t[6]=t=>e.edit?e.updateContainer():e.createContainer()),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.edit?e.translate("CoreUpdater_UpdateTitle"):e.translate("TagManager_CreateNewContainer")},null,8,["disabled","saving","value"]),Object(r["createElementVNode"])("div",fl,[Object(r["createElementVNode"])("a",{onClick:t[7]||(t[7]=t=>e.cancel())},Object(r["toDisplayString"])(e.translate("General_Cancel")),1)])])],32)]),_:1},8,["content-title"])}function El(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */class kl{constructor(){El(this,"privateState",Object(r["reactive"])({contexts:[],isLoading:!1})),El(this,"state",Object(r["computed"])(()=>Object(r["readonly"])(this.privateState))),El(this,"isLoading",Object(r["computed"])(()=>this.state.value.isLoading)),El(this,"contexts",Object(r["computed"])(()=>this.state.value.contexts)),El(this,"contextsOptions",Object(r["computed"])(()=>this.contexts.value.map(({id:e,name:t})=>({key:e,value:t})))),El(this,"initializePromise",null)}init(){return this.initializePromise||(this.initializePromise=this.fetchAvailableContexts()),this.initializePromise}fetchAvailableContexts(){return this.privateState.isLoading=!0,g["AjaxHelper"].fetch({method:"TagManager.getAvailableContexts",filter_limit:"-1"}).then(e=>{let t;t=Array.isArray(e)?e:Object.values(e),this.privateState.contexts=t}).finally(()=>{this.privateState.isLoading=!1})}}var Ml=new kl;function Sl(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */class wl{constructor(){Sl(this,"privateState",Object(r["reactive"])({containers:[],isLoadingContainers:!1,isLoadingSingle:!1,isUpdating:!1})),Sl(this,"state",Object(r["computed"])(()=>Object(r["readonly"])(this.privateState))),Sl(this,"isLoading",Object(r["computed"])(()=>{const e=this.state.value;return e.isLoadingContainers||e.isLoadingSingle})),Sl(this,"isUpdating",Object(r["computed"])(()=>this.state.value.isUpdating)),Sl(this,"containers",Object(r["computed"])(()=>this.state.value.containers)),Sl(this,"fetchPromise",null)}reload(){return this.privateState.containers=[],this.fetchPromise=null,this.fetchContainers()}fetchContainers(){return this.privateState.isLoadingContainers=!0,this.privateState.containers=[],this.fetchPromise||(this.fetchPromise=g["AjaxHelper"].fetch({method:"TagManager.getContainers",filter_limit:"-1"})),Promise.resolve(this.fetchPromise).then(e=>(this.privateState.containers=e,this.privateState.isLoadingContainers=!1,this.containers.value)).finally(()=>{this.privateState.isLoadingContainers=!1})}findContainer(e){const t=this.containers.value.find(t=>t.idcontainer===e);return t?Promise.resolve(t):(this.privateState.isLoadingSingle=!0,g["AjaxHelper"].fetch({idContainer:e,method:"TagManager.getContainer",filter_limit:"-1"}).then(e=>(this.privateState.containers=[...this.privateState.containers,e],Object(r["readonly"])(e))).finally(()=>{this.privateState.isLoadingSingle=!1}))}deleteContainer(e){return this.privateState.isUpdating=!0,this.privateState.containers=[],g["AjaxHelper"].fetch({idContainer:e,method:"TagManager.deleteContainer"},{withTokenInUrl:!0}).finally(()=>{this.privateState.isUpdating=!1})}createOrUpdateContainer(e,t){return this.privateState.isUpdating=!0,g["AjaxHelper"].post({method:t,idContainer:e.idcontainer},{name:e.name,description:e.description,ignoreGtmDataLayer:e.ignoreGtmDataLayer,activelySyncGtmDataLayer:e.activelySyncGtmDataLayer,isTagFireLimitAllowedInPreviewMode:e.isTagFireLimitAllowedInPreviewMode,context:e.context},{withTokenInUrl:!0}).finally(()=>{this.privateState.isUpdating=!1})}}var _l=new wl;const Dl="containertagmanagement";var xl=Object(r["defineComponent"])({props:{idContainer:String},components:{ContentBlock:g["ContentBlock"],Field:m["Field"],SaveButton:m["SaveButton"]},data(){return{isDirty:!1,editTitle:"",isUpdatingVersion:!1,container:{}}},created(){Ml.init(),qe.init(),this.initIdContainer()},watch:{idContainer(e){null!==e&&this.initIdContainer()}},methods:{removeAnyContainerNotification(){g["NotificationsStore"].remove(Dl),g["NotificationsStore"].remove("ajaxHelper")},showNotification(e,t){const a=g["NotificationsStore"].show({message:e,context:t,id:Dl,type:"toast"});setTimeout(()=>{g["NotificationsStore"].scrollToNotification(a)},200)},showErrorFieldNotProvidedNotification(e){const t=Object(g["translate"])("TagManager_ErrorXNotProvided",[e]);this.showNotification(t,"error")},initIdContainer(){this.container={},g["Matomo"].helper.lazyScrollToContent(),this.edit&&this.idContainer?(this.editTitle=Object(g["translate"])("TagManager_EditContainer"),_l.findContainer(this.idContainer).then(e=>{e&&(this.container=Object(g["clone"])(e),this.isDirty=!1)})):this.create&&(this.editTitle=Object(g["translate"])("TagManager_CreateNewContainer"),this.container={idSite:g["Matomo"].idSite,name:"",context:"web",description:"",activelySyncGtmDataLayer:!0},this.isDirty=!1)},cancel(){const e=Object.assign({},g["MatomoUrl"].hashParsed.value);delete e.idContainer,g["MatomoUrl"].updateHash(e)},createContainer(){this.removeAnyContainerNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVersion=!0,_l.createOrUpdateContainer(this.container,"TagManager.addContainer").then(e=>{if(this.isUpdatingVersion=!1,!e)return;this.isDirty=!1;const t=e.value;this.showNotification(Object(g["translate"])("TagManager_CreatedX",Object(g["translate"])("TagManager_Container")),"success"),g["MatomoUrl"].updateUrl(Object.assign(Object.assign({},g["MatomoUrl"].urlParsed.value),{},{module:"TagManager",action:"dashboard",idContainer:t}))}).finally(()=>{this.isUpdatingVersion=!1}))},setValueHasChanged(){this.isDirty=!0},updateContainer(){this.removeAnyContainerNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdating=!0,_l.createOrUpdateContainer(this.container,"TagManager.updateContainer").then(e=>{e&&(this.isDirty=!1,this.container={},_l.reload().then(()=>{this.initIdContainer()}),this.showNotification(Object(g["translate"])("TagManager_UpdatedX",Object(g["translate"])("TagManager_Container")),"success"))}))},checkRequiredFieldsAreSet(){if(!this.container.name){const e=Object(g["translate"])("General_Name");return this.showErrorFieldNotProvidedNotification(e),!1}return!0}},computed:{contexts(){return Ml.contextsOptions.value},create(){return"0"===this.idContainer},edit(){return!this.create},isLoading(){return Ge.isLoading.value||qe.isLoading.value},isUpdating(){return Ge.isUpdating.value||this.isUpdatingVersion}}});xl.render=Nl;var Bl=xl;const Ll={class:"tagManagerManageList tagManagerContainerList"},Ul=["innerHTML"],Al={class:"index"},Pl={class:"name"},Hl={class:"description"},Fl={class:"created"},Il={class:"action"},$l={colspan:"5"},Gl={class:"loadingPiwik"},Rl=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),zl={colspan:"5"},ql=["id"],Wl=["title"],Xl=["title"],Kl=["title"],Jl={class:"created"},Yl=["href","title"],Zl=["onClick","title"],Ql=["onClick","title"],es=["onClick","title"],ts=["onClick","title"],as={class:"tableActionBar"},ns=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),is={class:"ui-confirm",id:"confirmDeleteContainer",ref:"confirmDeleteContainer"},rs=["value"],os=["value"];function ls(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("ContentBlock"),s=Object(r["resolveDirective"])("content-table");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Ll,[Object(r["createVNode"])(l,{feature:"Tag Manager","content-title":e.translate("TagManager_ManageX",e.translate("TagManager_Containers"))},{default:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("p",{innerHTML:e.$sanitize(e.getManageContainersIntro)},null,8,Ul),Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("table",null,[Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",Al,Object(r["toDisplayString"])(e.translate("General_Id")),1),Object(r["createElementVNode"])("th",Pl,Object(r["toDisplayString"])(e.translate("General_Name")),1),Object(r["createElementVNode"])("th",Hl,Object(r["toDisplayString"])(e.translate("General_Description")),1),Object(r["createElementVNode"])("th",Fl,Object(r["toDisplayString"])(e.translate("TagManager_CreatedDate")),1),Object(r["createElementVNode"])("th",Il,Object(r["toDisplayString"])(e.translate("General_Actions")),1)])]),Object(r["createElementVNode"])("tbody",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",$l,[Object(r["createElementVNode"])("span",Gl,[Rl,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[r["vShow"],e.isLoading||e.isUpdating]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",zl,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_NoContainersFound"))+" ",1),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createContainerNow",onClick:t[0]||(t[0]=t=>e.createContainer())},Object(r["toDisplayString"])(e.translate("TagManager_CreateNewContainerNow")),513),[[r["vShow"],e.hasWriteAccess]])])],512),[[r["vShow"],!e.isLoading&&0===e.containers.length]]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedContainers,t=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{id:"container"+t.idcontainer,class:"containers",key:t.idcontainer},[Object(r["createElementVNode"])("td",{class:"index",title:e.translate("TagManager_Context")+": "+e.contexts[t.context]},Object(r["toDisplayString"])(t.idcontainer),9,Wl),Object(r["createElementVNode"])("td",{class:"name",title:t.name},Object(r["toDisplayString"])(e.truncateText(t.name,50)),9,Xl),Object(r["createElementVNode"])("td",{class:"description",title:t.description},Object(r["toDisplayString"])(e.truncateText(t.description,75)),9,Kl),Object(r["createElementVNode"])("td",Jl,[Object(r["createElementVNode"])("span",null,Object(r["toDisplayString"])(t.created_date_pretty),1)]),Object(r["createElementVNode"])("td",{class:Object(r["normalizeClass"])(e.getActionClasses)},[Object(r["createElementVNode"])("a",{class:"table-action icon-configure",href:"?module=TagManager&action="+e.containerDefaultAction+"&idContainer="+t.idcontainer+"&idSite="+t.idsite+"&period=day&date=yesterday",title:e.translate("TagManager_ConfigureX",e.translate("TagManager_Container"))},null,8,Yl),Object(r["createElementVNode"])("a",{class:"table-action installCode icon-embed",onClick:a=>e.installCode(t.idcontainer),title:e.translate("TagManager_InstallCode")},null,8,Zl),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-edit",onClick:a=>e.editContainer(t.idcontainer),title:e.translate("TagManager_EditX",e.translate("TagManager_Container"))},null,8,Ql),[[r["vShow"],e.hasWriteAccess]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-content-copy",onClick:a=>e.openCopyDialog(t),title:e.translate("TagManager_CopyX",e.translate("TagManager_Container"))},null,8,es),[[r["vShow"],e.canCopyContainer]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-delete",onClick:a=>e.deleteContainer(t),title:e.translate("TagManager_DeleteX",e.translate("TagManager_Container"))},null,8,ts),[[r["vShow"],e.hasWriteAccess]])],2)],8,ql))),128))])])),[[s]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",as,[Object(r["createElementVNode"])("a",{class:"createNewContainer",value:"",onClick:t[1]||(t[1]=t=>e.createContainer())},[ns,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewContainer")),1)])],512),[[r["vShow"],e.hasWriteAccess]])]),_:1},8,["content-title"]),Object(r["createElementVNode"])("div",is,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_DeleteContainerConfirm")),1),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,rs),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,os)],512)])}const{tagManagerHelper:ss}=window;var cs=Object(r["defineComponent"])({props:{isSuperUser:{type:Boolean,required:!0}},components:{ContentBlock:g["ContentBlock"]},directives:{ContentTable:g["ContentTable"]},created(){Ml.init(),_l.fetchContainers()},computed:{contexts(){const e={};return Ml.contexts.value.forEach(({id:t,name:a})=>{e[t]=a}),e},hasWriteAccess(){return g["Matomo"].hasUserCapability("tagmanager_write")},containerDefaultAction(){return this.hasWriteAccess?"dashboard":"manageTags"},isLoading(){return mo.isLoading.value},isUpdating(){return mo.isUpdating.value},containers(){return _l.containers.value},sortedContainers(){const e=[...this.containers];return e.sort((e,t)=>e.created_date<t.created_date?1:e.created_date>t.created_date?-1:0),e},getManageContainersIntro(){const e=Object(g["externalLink"])("https://matomo.org/guide/tag-manager/getting-started-with-tag-manager/");return Object(g["translate"])("TagManager_ManageContainersIntro",e,"</a>")},canCopyContainer(){return g["Matomo"].hasUserCapability("tagmanager_write")&&g["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},getActionClasses(){const e=this.canCopyContainer?" hasCopyAction":"";return"action"+e}},methods:{createContainer(){this.editContainer("0")},editContainer(e){g["MatomoUrl"].updateHash(Object.assign(Object.assign({},g["MatomoUrl"].hashParsed.value),{},{idContainer:e}))},installCode(e){ss.showInstallCode(e)},deleteContainer(e){function t(){_l.deleteContainer(e.idcontainer).then(()=>{_l.reload(),g["NotificationsStore"].remove("CopyDialogResultNotification")})}g["Matomo"].helper.modalConfirm(this.$refs.confirmDeleteContainer,{yes:t})},truncateText(e,t){return e.length>t?e.substr(0,t-3)+"...":e},openCopyDialog(e){const t=g["MatomoUrl"].stringify({module:"TagManager",action:"copyContainerDialog",idSite:e.idsite,idContainer:e.idcontainer});window.Piwik_Popover.createPopupAndLoadUrl(t,"","mtmCopyContainer")}}});cs.render=ls;var ds=cs;const gs={class:"manageContainer"};function ms(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("ContainerList"),s=Object(r["resolveComponent"])("ContainerEdit");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",gs,[Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{"is-super-user":e.isSuperUser},null,8,["is-super-user"])],512),[[r["vShow"],!e.editMode]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(s,{"id-container":e.idContainer},null,8,["id-container"])],512),[[r["vShow"],e.editMode]])])}var bs=Object(r["defineComponent"])({props:{isSuperUser:{type:Boolean,required:!0}},components:{ContainerList:ds,ContainerEdit:Bl},data(){return{isAddAllowed:!1}},created(){Object(r["watch"])(()=>g["MatomoUrl"].hashParsed.value.idContainer,e=>{this.onIdContainerParamChange(e)}),g["NotificationsStore"].remove("containertagmanagement"),this.onIdContainerParamChange(g["MatomoUrl"].hashParsed.value.idContainer)},computed:{idContainer(){const e=g["MatomoUrl"].hashParsed.value.idContainer;return this.isAddAllowed||""!==e?e:null},editMode(){return!!this.idContainer}},methods:{onIdContainerParamChange(e){if("0"===e){const e={isAllowed:!0};g["Matomo"].postEvent("TagManager.initAddVersion",e),this.isAddAllowed=!!e.isAllowed}}}});bs.render=ms;var hs=bs;const ps={class:"containerDashboard"},us={key:0},Os={class:"dashboardCreationDate"},js={key:0},vs=Object(r["createElementVNode"])("br",null,null,-1),Ts=["innerHTML"],Vs={class:"row",style:{"margin-left":"-0.75rem"}},Cs={class:"col m6 s12"},ys={key:0},fs=["href","title"],Ns={key:0},Es=Object(r["createElementVNode"])("hr",null,null,-1),ks=["href"],Ms=Object(r["createElementVNode"])("span",{class:"icon-edit"}," ",-1),Ss=["href"],ws=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),_s={class:"col m6 s12"},Ds={key:0},xs=["href","title"],Bs=Object(r["createElementVNode"])("hr",null,null,-1),Ls=["href"],Us=Object(r["createElementVNode"])("span",{class:"icon-edit"}," ",-1),As=["href"],Ps=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),Hs={class:"row",style:{"margin-left":"-0.75rem"}},Fs={class:"col m6 s12"},Is=["href","title"],$s={key:0},Gs=Object(r["createElementVNode"])("hr",null,null,-1),Rs=["href"],zs=Object(r["createElementVNode"])("span",{class:"icon-edit"}," ",-1),qs=["href"],Ws=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),Xs={class:"col m6 s12"},Ks=["title","href"],Js={key:0},Ys=Object(r["createElementVNode"])("br",null,null,-1),Zs=["title"],Qs={key:0},ec=Object(r["createElementVNode"])("hr",null,null,-1),tc=["href"],ac=Object(r["createElementVNode"])("span",{class:"icon-edit"}," ",-1),nc=["href"],ic=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1);function rc(e,t,a,n,i,o){var l,s;const c=Object(r["resolveComponent"])("ActivityIndicator"),d=Object(r["resolveComponent"])("EnrichedHeadline"),g=Object(r["resolveComponent"])("ContentBlock"),m=Object(r["resolveDirective"])("content-intro");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",ps,[Object(r["createVNode"])(c,{loading:e.isLoading},null,8,["loading"]),e.isLoading?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",us,[Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("div",null,[Object(r["createElementVNode"])("h2",null,[Object(r["createVNode"])(d,{"feature-name":"Tag Manager","inline-help":e.dashboardHelpText},{default:Object(r["withCtx"])(()=>{var t;return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_ContainerX",null===(t=e.container)||void 0===t?void 0:t.name)),1)]}),_:1},8,["inline-help"])]),Object(r["createElementVNode"])("p",Os,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.containerMetaInformation)+" ",1),null!==(l=e.containerVersion)&&void 0!==l&&l.description?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",js,[vs,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_Description"))+": "+Object(r["toDisplayString"])(null===(s=e.containerVersion)||void 0===s?void 0:s.description),1)])):Object(r["createCommentVNode"])("",!0)]),Object(r["createElementVNode"])("p",{innerHTML:e.$sanitize(e.containerDashboardDescription)},null,8,Ts)])),[[m]]),Object(r["createElementVNode"])("div",Vs,[Object(r["createElementVNode"])("div",Cs,[Object(r["createVNode"])(g,{feature:e.translate("TagManager_Tags"),"content-title":`${e.tagCount} ${e.translate("TagManager_Tags")}`,"help-text":e.tagsHelpText,"edit-url":e.linkTo("manageTags")},{default:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("p",null,[e.tagCount?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",ys,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_Names"))+": ",1),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedContainerVersionTags,(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:a},[Object(r["createElementVNode"])("a",{href:e.linkTo("manageTags",{idTag:t.idtag}),title:e.translate("TagManager_EntityDateTypeMetaInformation",t.created_date_pretty,t.updated_date_pretty,t.type)},Object(r["toDisplayString"])(t.name),9,fs),a!==e.sortedContainerVersionTags.length-1?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",Ns,", ")):Object(r["createCommentVNode"])("",!0)]))),128))])):Object(r["createCommentVNode"])("",!0)]),Es,Object(r["createElementVNode"])("a",{class:"btn-flat",href:e.linkTo("manageTags")},[Ms,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_EditTags")),1)],8,ks),Object(r["createElementVNode"])("a",{class:"btn-flat",href:e.linkTo("manageTags",{idTag:0})},[ws,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewTag")),1)],8,Ss)]),_:1},8,["feature","content-title","help-text","edit-url"])]),Object(r["createElementVNode"])("div",_s,[Object(r["createVNode"])(g,{feature:e.translate("TagManager_Triggers"),"content-title":`${e.triggerCount} ${e.translate("TagManager_Triggers")}`,"help-text":e.triggersHelpText,"edit-url":e.linkTo("manageTriggers")},{default:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("p",null,[e.triggerCount?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",Ds,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_Names"))+": ",1),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedTriggers,(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:a},[Object(r["createElementVNode"])("a",{href:e.linkTo("manageTriggers",{idTrigger:t.idtrigger}),title:e.translate("TagManager_EntityDateTypeMetaInformation",t.created_date_pretty,t.updated_date_pretty,t.type)},Object(r["toDisplayString"])(t.name),9,xs),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",null,", ",512),[[r["vShow"],a!==e.sortedTriggers.length-1]])]))),128))])):Object(r["createCommentVNode"])("",!0)]),Bs,Object(r["createElementVNode"])("a",{class:"btn-flat",href:e.linkTo("manageTriggers")},[Us,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_EditTriggers")),1)],8,Ls),Object(r["createElementVNode"])("a",{class:"btn-flat",href:e.linkTo("manageTriggers",{idTrigger:0})},[Ps,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewTrigger")),1)],8,As)]),_:1},8,["feature","content-title","help-text","edit-url"])])]),Object(r["createElementVNode"])("div",Hs,[Object(r["createElementVNode"])("div",Fs,[Object(r["createVNode"])(g,{feature:e.translate("TagManager_Variables"),"content-title":`${e.variableCount} ${e.translate("TagManager_Variables")}`,"help-text":e.variablesHelpText,"edit-url":e.linkTo("manageVariables")},{default:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("p",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("span",null,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_Names"))+": ",1),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedVariables,(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:a},[Object(r["createElementVNode"])("a",{href:e.linkTo("manageVariables",{idVariable:t.idvariable}),title:e.translate("TagManager_EntityDateTypeMetaInformation",t.created_date_pretty,t.updated_date_pretty,t.type)},Object(r["toDisplayString"])(t.name),9,Is),a!==e.sortedVariables.length-1?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",$s,", ")):Object(r["createCommentVNode"])("",!0)]))),128))],512),[[r["vShow"],e.variableCount]])]),Gs,Object(r["createElementVNode"])("a",{class:"btn-flat",href:e.linkTo("manageVariables")},[zs,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_EditVariables")),1)],8,Rs),Object(r["createElementVNode"])("a",{class:"btn-flat",href:e.linkTo("manageVariables",{idVariable:0})},[Ws,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVariable")),1)],8,qs)]),_:1},8,["feature","content-title","help-text","edit-url"])]),Object(r["createElementVNode"])("div",Xs,[Object(r["createVNode"])(g,{feature:e.translate("TagManager_Versions"),"content-title":`${e.versionCount} ${e.translate("TagManager_Versions")}`,"help-text":e.versionsHelpText,"edit-url":e.linkTo("manageVersions")},{default:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("p",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("span",null,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_LastVersions"))+": ",1),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.lastVersions,(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:a},[Object(r["createElementVNode"])("a",{title:e.lastVersionLinkTitle(t),href:e.linkTo("manageVersions",{idContainerVersion:t.idcontainerversion})},Object(r["toDisplayString"])(t.name),9,Ks),a!==e.lastVersions.length-1?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",Js,", ")):Object(r["createCommentVNode"])("",!0)]))),128))],512),[[r["vShow"],e.lastVersions.length]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",null,[Ys,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("TagManager_Environments"))+": ",1),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.container.releases,(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:a},[Object(r["createElementVNode"])("span",{title:e.releaseTooltip(t)},Object(r["toDisplayString"])(e.ucfirst(t.environment)),9,Zs),a!==e.container.releases.length-1?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",Qs,", ")):Object(r["createCommentVNode"])("",!0)]))),128))],512),[[r["vShow"],e.container.releases.length]])]),ec,Object(r["createElementVNode"])("a",{class:"btn-flat",href:e.linkTo("manageVersions")},[ac,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_EditVersions")),1)],8,tc),Object(r["createElementVNode"])("a",{class:"btn-flat",href:e.linkTo("manageVersions",{idContainerVersion:0})},[ic,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVersion")),1)],8,nc)]),_:1},8,["feature","content-title","help-text","edit-url"])])])]))])}function oc(e){e.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0)}var lc=Object(r["defineComponent"])({props:{idContainer:String,dashboardHelpText:String,tagsHelpText:String,triggersHelpText:String,variablesHelpText:String,versionsHelpText:String},components:{ActivityIndicator:g["ActivityIndicator"],EnrichedHeadline:g["EnrichedHeadline"],ContentBlock:g["ContentBlock"]},directives:{ContentIntro:g["ContentIntro"]},data(){return{container:null,containerVersion:null,isLoading:!1}},created(){Ml.init(),this.isLoading=!0;const e=g["AjaxHelper"].fetch({method:"TagManager.getContainer",idContainer:this.idContainer}).then(e=>{this.container=e}),t=g["AjaxHelper"].fetch({method:"TagManager.exportContainerVersion",idContainer:this.idContainer}).then(e=>{this.containerVersion=e});Promise.all([e,t]).finally(()=>{this.isLoading=!1})},methods:{linkTo(e,t){let a=g["MatomoUrl"].stringify(Object.assign(Object.assign({},g["MatomoUrl"].urlParsed.value),{},{module:"TagManager",action:e}));return t&&(a+="#?"+g["MatomoUrl"].stringify(t)),"?"+a},lastVersionLinkTitle(e){return"Created on "+e.created_date_pretty+`, description: '${e.description}'`},releaseTooltip(e){const t=Object(g["translate"])("TagManager_ReleaseInfo",e.release_login,e.release_date_pretty),a=Object(g["translate"])("TagManager_ReleaseVersionInfo",e.version_name);return`${t} ${a}`},ucfirst(e){return`${e.substr(0,1).toUpperCase()}${e.substr(1)}`}},computed:{lastVersions(){var e;return null!==(e=this.container)&&void 0!==e&&null!==(e=e.versions)&&void 0!==e&&e.length?this.container.versions.slice(0,5):[]},contexts(){const e={};return Ml.contexts.value.forEach(({id:t,name:a})=>{e[t]=a}),e},containerMetaInformation(){var e;return Object(g["translate"])("TagManager_ContainerIdInformation",(null===(e=this.containerVersion)||void 0===e?void 0:e.idcontainer)||"")},containerDashboardDescription(){const e=Object(g["externalLink"])("https://matomo.org/guide/tag-manager/getting-started-with-tag-manager/");return Object(g["translate"])("TagManager_ContainerDashboardDescription",e,"</a>")},sortedContainerVersionTags(){var e;const t=(null===(e=this.containerVersion)||void 0===e?void 0:e.tags)||[];return oc(t),t},sortedTriggers(){var e;const t=(null===(e=this.containerVersion)||void 0===e?void 0:e.triggers)||[];return oc(t),t},sortedVariables(){var e;const t=(null===(e=this.containerVersion)||void 0===e?void 0:e.variables)||[];return oc(t),t},tagCount(){var e;return null===(e=this.containerVersion)||void 0===e?void 0:e.tags.length},triggerCount(){var e;return null===(e=this.containerVersion)||void 0===e?void 0:e.triggers.length},versionCount(){var e;return null===(e=this.container)||void 0===e?void 0:e.versions.length},variableCount(){var e;return null===(e=this.containerVersion)||void 0===e?void 0:e.variables.length}}});lc.render=rc;var sc=lc;const cc=["title"],dc={class:"title"},gc=Object(r["createElementVNode"])("span",{class:"icon icon-chevron-down"}," ",-1),mc={class:"dropdown positionInViewport"},bc={class:"custom_select_container"},hc={class:"custom_select_ul_list"},pc=["title"],uc=["href"];function Oc(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("ActivityIndicator"),s=Object(r["resolveDirective"])("focus-anywhere-but-here"),c=Object(r["resolveDirective"])("tooltips");return Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{class:Object(r["normalizeClass"])(["tagContainerSelector piwikSelector borderedControl",{expanded:e.showContainerList}]),onClick:t[1]||(t[1]=t=>{e.fetchContainers(),e.showContainerList=!e.showContainerList}),title:e.translate("TagManager_ChooseContainer")},[Object(r["createElementVNode"])("a",dc,[gc,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.truncateText(e.actualContainerName,50)),1)]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",mc,[Object(r["createVNode"])(l,{loading:e.isLoading},null,8,["loading"]),Object(r["createElementVNode"])("div",bc,[Object(r["createElementVNode"])("ul",hc,[Object(r["withDirectives"])(Object(r["createElementVNode"])("li",null,[Object(r["createElementVNode"])("a",{tabindex:"-1",onClick:t[0]||(t[0]=Object(r["withModifiers"])(()=>{},["prevent","stop"]))},Object(r["toDisplayString"])(e.translate("TagManager_NoContainersFound")),1)],512),[[r["vShow"],!e.isLoading&&0===e.containers.length]]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.containers,t=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{title:`${t.name} (${t.idcontainer})`,key:t.idcontainer},[Object(r["createElementVNode"])("a",{href:e.linkTo(t.idcontainer)},Object(r["toDisplayString"])(t.name)+" ("+Object(r["toDisplayString"])(t.idcontainer)+") ",9,uc)],8,pc))),128))])])],512),[[r["vShow"],e.showContainerList]])],10,cc)),[[s,{blur:e.onBlur}],[c]])}const{tagManagerHelper:jc}=window;var vc=Object(r["defineComponent"])({props:{containerName:String},components:{ActivityIndicator:g["ActivityIndicator"]},directives:{FocusAnywhereButHere:g["FocusAnywhereButHere"],Tooltips:g["Tooltips"]},data(){return{containers:[],isLoading:!1,showContainerList:!1}},created(){setTimeout(()=>{window.initTopControls()})},methods:{fetchContainers(){this.isLoading=!0,this.containers=[],g["AjaxHelper"].fetch({method:"TagManager.getContainers"}).then(e=>{this.containers=e}).finally(()=>{this.isLoading=!1})},linkTo(e){let t=g["MatomoUrl"].urlParsed.value.action;t&&"manageContainers"!==t||(t=this.hasWriteAccess?"dashboard":"manageTags");const a=g["MatomoUrl"].stringify(Object.assign(Object.assign({},g["MatomoUrl"].urlParsed.value),{},{idContainer:e,action:t}));return`${window.location.pathname}?${a}`},onBlur(){this.showContainerList=!1},truncateText(e,t){return jc.truncateText(e,t)}},computed:{actualContainerName(){return this.containerName?Object(g["translate"])("TagManager_ContainerX",this.containerName):Object(g["translate"])("TagManager_ChooseContainer")},hasWriteAccess(){return g["Matomo"].hasUserCapability("tagmanager_write")}}});vc.render=Oc;var Tc=vc;const Vc={style:{"margin-left":"-0.75rem"}},Cc=Object(r["createElementVNode"])("br",null,null,-1),yc=["href"],fc=["textContent"],Nc={style:{"margin-top":"1rem"}},Ec=["innerHTML"],kc=Object(r["createElementVNode"])("br",null,null,-1),Mc=["href"],Sc={class:"environment"},wc={class:"name"},_c={class:"name"},Dc={class:"released_by"},xc={class:"released_on"},Bc={key:0},Lc={colspan:"7"},Uc={class:"loadingPiwik"},Ac=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Pc={key:1},Hc={colspan:"7"},Fc={class:"environment"},Ic={class:"name"},$c={class:"revision"},Gc={class:"released_by"},Rc={class:"released_on"},zc={class:"date"};function qc(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("Field"),s=Object(r["resolveComponent"])("ActivityIndicator"),c=Object(r["resolveComponent"])("ContentBlock"),d=Object(r["resolveDirective"])("copy-to-clipboard"),g=Object(r["resolveDirective"])("content-table");return Object(r["openBlock"])(),Object(r["createBlock"])(c,{class:"manageInstallTagCode",feature:"Tag Manager","content-title":"Install Code"},{default:Object(r["withCtx"])(()=>{var a;return[Object(r["createElementVNode"])("div",Vc,[Object(r["createVNode"])(l,{uicontrol:"select",name:"environment","model-value":e.environment,"onUpdate:modelValue":t[0]||(t[0]=t=>{e.environment=t,e.fetchInstallInstructions(e.environment)}),options:e.environments,title:e.translate("TagManager_Environment")},null,8,["model-value","options","title"])]),Object(r["createVNode"])(s,{loading:e.isLoading},null,8,["loading"]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.installInstructions,(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{key:a},[Object(r["createElementVNode"])("p",null,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(t.description)+" ",1),Cc,t.helpUrl?(Object(r["openBlock"])(),Object(r["createElementBlock"])("a",{key:0,target:"_blank",href:t.helpUrl},Object(r["toDisplayString"])(e.translate("TagManager_LearnMore")),9,yc)):Object(r["createCommentVNode"])("",!0)]),Object(r["createElementVNode"])("div",null,[t.embedCode?Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("pre",{key:0,textContent:Object(r["toDisplayString"])(t.embedCode)},null,8,fc)),[[d,{}]]):Object(r["createCommentVNode"])("",!0)])]))),128)),Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_InstallCodePublishEnvironmentNote","preview"))+" "+Object(r["toDisplayString"])(e.translate("TagManager_ConfigureEnvironmentsSuperUser")),1),Object(r["createElementVNode"])("p",Nc,[Object(r["createElementVNode"])("span",{innerHTML:e.$sanitize(e.translate("TagManager_InstallCodeDataLayerNote","<strong>","</strong>"))},null,8,Ec),kc,Object(r["createElementVNode"])("a",{target:"_blank",href:e.externalRawLink("https://matomo.org/faq/tag-manager/data-layer-in-matomo-tag-manager/")},Object(r["toDisplayString"])(e.translate("TagManager_LearnMore")),9,Mc)]),Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_ReleasesOverview")),1),Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("table",null,[Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",Sc,Object(r["toDisplayString"])(e.translate("TagManager_Environment")),1),Object(r["createElementVNode"])("th",wc,Object(r["toDisplayString"])(e.translate("TagManager_VersionName")),1),Object(r["createElementVNode"])("th",_c,Object(r["toDisplayString"])(e.translate("TagManager_VersionRevision")),1),Object(r["createElementVNode"])("th",Dc,Object(r["toDisplayString"])(e.translate("TagManager_ReleasedBy")),1),Object(r["createElementVNode"])("th",xc,Object(r["toDisplayString"])(e.translate("TagManager_ReleasedOn")),1)])]),Object(r["createElementVNode"])("tbody",null,[e.isLoading?(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",Bc,[Object(r["createElementVNode"])("td",Lc,[Object(r["createElementVNode"])("span",Uc,[Ac,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])])])):Object(r["createCommentVNode"])("",!0),e.isLoading||0!==(null===(a=e.container)||void 0===a||null===(a=a.releases)||void 0===a?void 0:a.length)?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",Pc,[Object(r["createElementVNode"])("td",Hc,Object(r["toDisplayString"])(e.translate("TagManager_NoReleasesFound")),1)])),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedReleases,t=>{var a,n;return Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{key:t.idcontainerrelease},[Object(r["createElementVNode"])("td",Fc,Object(r["toDisplayString"])(e.ucfirst(t.environment)),1),Object(r["createElementVNode"])("td",Ic,Object(r["toDisplayString"])(null===(a=e.releaseVersions[t.idcontainerrelease])||void 0===a?void 0:a.name),1),Object(r["createElementVNode"])("td",$c,Object(r["toDisplayString"])(null===(n=e.releaseVersions[t.idcontainerrelease])||void 0===n?void 0:n.revision),1),Object(r["createElementVNode"])("td",Gc,Object(r["toDisplayString"])(t.release_login),1),Object(r["createElementVNode"])("td",Rc,[Object(r["createElementVNode"])("span",zc,Object(r["toDisplayString"])(t.release_date_pretty),1)])])}),128))])])),[[g]])]}),_:1})}const{$:Wc}=window;var Xc=Object(r["defineComponent"])({props:{idContainer:{type:String,required:!0}},components:{ContentBlock:g["ContentBlock"],Field:m["Field"],ActivityIndicator:g["ActivityIndicator"]},directives:{SelectOnFocus:g["SelectOnFocus"],ContentTable:g["ContentTable"],CopyToClipboard:g["CopyToClipboard"]},data(){return{container:null,environments:[],environment:"live",installInstructions:[],isLoading:!1,isLoadingInstructions:!1}},created(){this.isLoading=!0,this.fetchReleases().finally(()=>{this.isLoading=!1})},methods:{fetchInstallInstructions(e){return this.installInstructions=[],this.isLoadingInstructions=!0,g["AjaxHelper"].fetch({method:"TagManager.getContainerInstallInstructions",filter_limit:"-1",idContainer:this.idContainer,environment:e}).then(e=>{this.installInstructions=e,Object(r["nextTick"])(()=>{const e=Array.isArray(this.$refs.codeblock)?this.$refs.codeblock:[this.$refs.codeblock];e.forEach(e=>{Wc(e).effect("highlight",{},1500)})})}).finally(()=>{this.isLoadingInstructions=!1})},fetchReleases(){return g["AjaxHelper"].fetch([{method:"TagManager.getAvailableEnvironments",filter_limit:"-1"},{method:"TagManager.getContainer",idContainer:this.idContainer,filter_limit:"-1"}]).then(([e,t])=>{var a;this.environments=e.map(e=>({key:e.id,value:e.name})),this.container=t;const n=t.releases.some(e=>"live"===e.environment);if(!n&&null!==(a=this.environments)&&void 0!==a&&null!==(a=a[0])&&void 0!==a&&a.key?this.environment=this.environments[0].key:n||(this.environment=""),this.environment)return this.fetchInstallInstructions(this.environment)})},ucfirst(e){return`${e.substr(0,1).toUpperCase()}${e.substr(1)}`}},computed:{releaseVersions(){var e;const t={};return((null===(e=this.container)||void 0===e?void 0:e.releases)||[]).forEach(e=>{t[e.idcontainerrelease]=this.container.versions.find(t=>t.idcontainerversion===e.idcontainerversion)}),t},sortedReleases(){var e;const t=[...((null===(e=this.container)||void 0===e?void 0:e.releases)||[]).map((e,t)=>Object.assign(Object.assign({},e),{},{index:t}))];return t.sort((e,t)=>e.release_date<t.release_date?1:e.release_date>t.release_date?-1:t.index-e.index),t}}});Xc.render=qc;var Kc=Xc;const Jc={class:"tagManagerTrackingCode"},Yc={key:0},Zc={class:"trackingCodeAdvancedOptions"},Qc={class:"advance-option"},ed=Object(r["createElementVNode"])("span",{class:"icon-chevron-down"},null,-1),td=Object(r["createElementVNode"])("span",{class:"icon-chevron-up"},null,-1),ad={id:"mtm-advanced-options"},nd=["innerHTML"],id={key:1,class:"row"},rd={class:"col s12 m4"},od={class:"form-group row"},ld={class:"col s12 input-field"},sd={for:"tagManagerTrackingCodeSite",class:"siteSelectorLabel"},cd={class:"sites_autocomplete"},dd={class:"col s12 m4"},gd={class:"col s12 m4"},md=["innerHTML"],bd={key:1,class:"alert alert-info"},hd={href:""},pd={key:0},ud=["href"],Od=["innerHTML"],jd=["textContent"],vd=["innerHTML"],Td={key:1};function Vd(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("ActivityIndicator"),s=Object(r["resolveComponent"])("SiteSelector"),c=Object(r["resolveComponent"])("Field"),d=Object(r["resolveDirective"])("copy-to-clipboard");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Jc,[e.showContainerRow?(Object(r["openBlock"])(),Object(r["createElementBlock"])("li",Yc,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_OptionallyCustomiseContainer"))+" ",1),Object(r["createElementVNode"])("div",Zc,[Object(r["createElementVNode"])("div",Qc,[Object(r["createElementVNode"])("span",null,[e.isAdvancedDisplayed?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("a",{key:0,href:"javascript:;",onClick:t[0]||(t[0]=Object(r["withModifiers"])(t=>e.isAdvancedDisplayed=!0,["prevent"]))},[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("CoreAdminHome_ShowAdvancedOptions"))+" ",1),ed])),e.isAdvancedDisplayed?(Object(r["openBlock"])(),Object(r["createElementBlock"])("a",{key:1,href:"javascript:;",onClick:t[1]||(t[1]=Object(r["withModifiers"])(t=>e.isAdvancedDisplayed=!1,["prevent"]))},[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("CoreAdminHome_HideAdvancedOptions"))+" ",1),td])):Object(r["createCommentVNode"])("",!0)])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",ad,[Object(r["createElementVNode"])("ul",null,[Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.getAdvancedStepText)},null,8,nd),e.showContainerRow||e.environments.length>1?Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createBlock"])(l,{key:0,loading:!0},null,512)),[[r["vShow"],e.isLoading]]):Object(r["createCommentVNode"])("",!0),e.showContainerRow||e.environments.length>1?Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("div",id,[Object(r["createElementVNode"])("div",rd,[Object(r["createElementVNode"])("div",od,[Object(r["createElementVNode"])("div",ld,[Object(r["createElementVNode"])("label",sd,Object(r["toDisplayString"])(e.translate("General_Website")),1),Object(r["createElementVNode"])("div",cd,[Object(r["createVNode"])(s,{id:"tagManagerTrackingCodeSite",modelValue:e.site,"onUpdate:modelValue":t[2]||(t[2]=t=>e.site=t),"show-all-sites-item":!1,"switch-site-on-select":!1,"show-selected-site":!0},null,8,["modelValue"])])])])]),Object(r["createElementVNode"])("div",dd,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(c,{uicontrol:"select",name:"containers","model-value":e.idContainer,"onUpdate:modelValue":t[3]||(t[3]=t=>{e.idContainer=t,e.onContainerChange()}),options:e.containerOptions,disabled:e.containerOptions.length<=1,"full-width":!0,title:e.translate("TagManager_Container")},null,8,["model-value","options","disabled","title"])])]),Object(r["createElementVNode"])("div",gd,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(c,{uicontrol:"select",name:"environment","model-value":e.environment,"onUpdate:modelValue":t[4]||(t[4]=t=>{e.environment=t,this.$emit("fetchInstallInstructions")}),options:e.environments,disabled:e.environments.length<=1,"full-width":!0,title:e.translate("TagManager_Environment")},null,8,["model-value","options","disabled","title"])])])],512)),[[r["vShow"],!e.isLoading]]):Object(r["createCommentVNode"])("",!0),e.idContainer?(Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{key:2,innerHTML:e.$sanitize(e.getAdvancedStepInfo)},null,8,md)):Object(r["createCommentVNode"])("",!0)])],512),[[r["vShow"],e.isAdvancedDisplayed]])])])):Object(r["createCommentVNode"])("",!0),e.idContainer&&e.noReleaseFound?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",bd,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_NoReleasesFoundForContainer"))+" ",1),Object(r["createElementVNode"])("a",hd,Object(r["toDisplayString"])(e.translate("TagManager_PublishVersionToEnvironmentToViewEmbedCode")),1)])):Object(r["createCommentVNode"])("",!0),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.installInstructions,(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])(r["Fragment"],{key:a},[e.showDescription?(Object(r["openBlock"])(),Object(r["createElementBlock"])("p",pd,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(t.description)+" ",1),t.helpUrl?(Object(r["openBlock"])(),Object(r["createElementBlock"])("a",{key:0,target:"_blank",href:t.helpUrl},Object(r["toDisplayString"])(e.translate("TagManager_LearnMore")),9,ud)):Object(r["createCommentVNode"])("",!0),Object(r["createTextVNode"])(". ")])):Object(r["createCommentVNode"])("",!0),e.showPlainMtmSteps?(Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{key:1,innerHTML:e.$sanitize(e.getMtmStep3)},null,8,Od)):Object(r["createCommentVNode"])("",!0),Object(r["createElementVNode"])("div",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("pre",{class:"codeblock",textContent:Object(r["toDisplayString"])(t.embedCode),ref_for:!0,ref:"codeblock"},null,8,jd),[[d,{}]])])],64))),128)),e.showBottom&&!e.noReleaseFound&&e.idContainer?(Object(r["openBlock"])(),Object(r["createElementBlock"])(r["Fragment"],{key:2},[e.showTestSection?(Object(r["openBlock"])(),Object(r["createElementBlock"])("li",Td,[(Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["resolveDynamicComponent"])(e.testComponent),{site:e.site},null,8,["site"]))])):(Object(r["openBlock"])(),Object(r["createElementBlock"])("p",{key:0,innerHTML:e.$sanitize(e.getCongratulationsText)},null,8,vd))],64)):Object(r["createCommentVNode"])("",!0)])}function Cd(e){return`${e.substr(0,1).toUpperCase()}${e.substr(1)}`}var yd=Object(r["defineComponent"])({props:{showContainerRow:Boolean,showBottom:Boolean,showDescription:Boolean,showPlainMtmSteps:Boolean,showTestSection:Boolean,showAdvancedOptions:{required:!1,type:Boolean,default:!1}},components:{ActivityIndicator:g["ActivityIndicator"],SiteSelector:g["SiteSelector"],Field:m["Field"]},emits:["fetchInstallInstructions"],directives:{CopyToClipboard:g["CopyToClipboard"]},data(){return{containerVariables:[],isLoading:!1,idContainer:"",environment:"",environments:[],environmentNameMap:{},containerMap:{},containerOptions:[],site:{id:g["Matomo"].idSite,name:g["Matomo"].helper.htmlDecode(g["Matomo"].siteName)},matomoConfigs:[],releases:[],installInstructions:[],noReleaseFound:!1,isAdvancedDisplayed:!1}},created(){g["AjaxHelper"].fetch({method:"TagManager.getAvailableEnvironments",filter_limit:"-1"}).then(e=>{let t;t=Array.isArray(e)?e:Object.values(e),this.environmentNameMap=Object.fromEntries(t.map(({id:e,name:t})=>[e,t]))}),this.onSiteChange(),this.isAdvancedDisplayed=this.showAdvancedOptions},watch:{site(){this.onSiteChange()}},methods:{onSiteChange(){var e;this.installInstructions=[],this.containerOptions=[],this.containerMap={},this.environments=[],this.matomoConfigs=[],this.idContainer="",null!==(e=this.site)&&void 0!==e&&e.id&&(this.isLoading=!0,g["AjaxHelper"].fetch({method:"TagManager.getContainers",filter_limit:"-1",idSite:this.site.id}).then(e=>{if(this.containerOptions=[],null===e||void 0===e||!e.length)return this.idContainer="",this.isAdvancedDisplayed=!0,void this.containerOptions.push({key:"",value:this.translate("TagManager_NoContainersFound")});e.forEach(e=>{this.idContainer||(this.idContainer=e.idcontainer),this.containerMap[e.idcontainer]=e,this.containerOptions.push({key:e.idcontainer,value:e.name})}),this.onContainerChange()}).finally(()=>{this.isLoading=!1}))},onContainerChange(){if(this.noReleaseFound=!1,!this.idContainer)return;this.installInstructions=[];const e=this.containerMap[this.idContainer],t=e.draft.idcontainerversion;this.environment="",this.environments=[];const a=e.releases||[];a.find(e=>"live"===e.environment)&&(this.environment="live"),a.forEach(e=>{if("preview"===e.environment)return;this.environment||(this.environment=e.environment);let t=Cd(e.environment);e.environment in this.environmentNameMap&&(t=this.environmentNameMap[e.environment]),this.environments.push({key:e.environment,value:t})}),this.environments.length||(this.noReleaseFound=!0,this.environments.push({key:"",value:this.translate("TagManager_NoReleasesFound")})),this.$emit("fetchInstallInstructions"),this.fetchVariables(t)},linkTo(e,t,a,n){const i=g["MatomoUrl"].stringify(Object.assign(Object.assign({},g["MatomoUrl"].urlParsed.value),{},{module:"TagManager",action:e,idSite:t,idContainer:a}));let r=`${window.location.pathname}?${i}`;return n&&(r+="#?"+g["MatomoUrl"].stringify(n)),r},fetchVariables(e){var t;this.matomoConfigs=[],this.idContainer&&null!==(t=this.site)&&void 0!==t&&t.id&&e&&g["AjaxHelper"].fetch({method:"TagManager.getContainerVariables",filter_limit:"-1",idContainer:this.idContainer,idContainerVersion:e,idSite:this.site.id}).then(e=>{this.matomoConfigs=e.filter(e=>"MatomoConfiguration"===e.type)}).finally(()=>{this.isLoading=!1})}},computed:{getLearnMoreLink(){return Object(g["translate"])("TagManager_CustomHtmlTagHelpText",Object(g["externalLink"])("https://matomo.org/faq/tag-manager/container-dashboard-in-matomo-tag-manager/"),"</a>")},getMtmStep3(){return Object(g["translate"])("TagManager_CopyCodePasteInHeader","&lt;/head&gt;")},getCongratulationsText(){return Object(g["translate"])("TagManager_SiteWithoutDataReactFollowStepCompleted","<strong>","</strong>")},testComponent(){return this.showTestSection?Object(g["useExternalPluginComponent"])("JsTrackerInstallCheck","JsTrackerInstallCheck"):""},getAdvancedStepText(){var e;const t=Object(g["translate"])("TagManager_SelectContainerForWebsite","<strong>","</strong>");if(this.idContainer)return t;const a=this.linkTo("manageContainers",String(null===(e=this.site)||void 0===e?void 0:e.id),""),n=Object(g["translate"])("TagManager_ManageContainersLink",`<a href="${a}" target="_blank" rel="noreferrer noopener">`,"</a>");return`${t} ${n}`},getAdvancedStepInfo(){const e=this.site&&this.site.id?this.site.id:"",t=this.linkTo("dashboard",e,this.idContainer,[]);return Object(g["translate"])("TagManager_CustomiseContainer",`<a href="${t}">`,"</a>",Object(g["externalLink"])("https://matomo.org/faq/tag-manager/container-dashboard-in-matomo-tag-manager/"),"</a>")}}});yd.render=Vd;var fd=yd;const Nd=Object(r["createElementVNode"])("br",null,null,-1),Ed={class:"followStepsHeading"},kd={style:{"list-style":"inside decimal"}};function Md(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("TrackingCodeCommon");return Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["resolveDynamicComponent"])("getTrackingMethodsForSite"===e.currentAction?"div":"ContentBlock"),{anchor:"tagmanager","content-title":e.translate("TagManager_MatomoTagManager")},{default:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_MtmTrackingCodeIntro")),1),Nd,Object(r["createElementVNode"])("p",Ed,[Object(r["createElementVNode"])("strong",null,Object(r["toDisplayString"])(e.translate("SitesManager_SiteWithoutDataCloudflareFollowStepsIntro")),1)]),Object(r["createElementVNode"])("ol",kd,[Object(r["createVNode"])(l,{"show-container-row":e.showContainerRow,showBottom:!0,showDescription:!1,showPlainMtmSteps:!0,showAdvancedOptions:"trackingCodeGenerator"===e.currentAction,showTestSection:"getTrackingMethodsForSite"===e.currentAction&&e.isJsTrackerInstallCheckAvailable,onFetchInstallInstructions:e.fetchInstallInstructions,ref:"trackingCodeCommon"},null,8,["show-container-row","showAdvancedOptions","showTestSection","onFetchInstallInstructions"])])]),_:1},8,["content-title"])}var Sd=Object(r["defineComponent"])({props:{currentAction:String,showContainerRow:Boolean,isJsTrackerInstallCheckAvailable:Boolean},components:{ContentBlock:g["ContentBlock"],TrackingCodeCommon:fd},methods:{fetchInstallInstructions(){var e,t;const a=this.$refs.trackingCodeCommon;a.installInstructions=[],null!==a&&void 0!==a&&null!==(e=a.site)&&void 0!==e&&e.id&&null!==a&&void 0!==a&&a.environment&&(a.isLoading=!0,g["AjaxHelper"].fetch({method:"TagManager.getContainerInstallInstructions",filter_limit:"-1",idContainer:null===a||void 0===a?void 0:a.idContainer,environment:null===a||void 0===a?void 0:a.environment,idSite:null===a||void 0===a||null===(t=a.site)||void 0===t?void 0:t.id}).then(e=>{a.installInstructions=e,Object(r["nextTick"])(()=>{const e=Array.isArray(this.$refs.codeblock)?this.$refs.codeblock:[this.$refs.codeblock];e.forEach(e=>{$(e).effect("highlight",{},1500)})})}).finally(()=>{a.isLoading=!1}))}}});Sd.render=Md;var wd=Sd;const _d={class:"list-style-decimal"},Dd={ref:"step1"},xd=["innerHTML"],Bd=["innerHTML"],Ld=["textContent"],Ud=["innerHTML"],Ad=["textContent"],Pd=["innerHTML"],Hd=["innerHTML"],Fd=["innerHTML"],Id=["textContent"],$d={style:{"list-style":"lower-alpha","list-style-position":"inside"}},Gd=["innerHTML"],Rd=["innerHTML"],zd=["innerHTML"],qd=["textContent"],Wd=["textContent"],Xd=["innerHTML"],Kd=["textContent"],Jd=["innerHTML"],Yd=["innerHTML"],Zd=["textContent"];function Qd(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("TrackingCodeCommon"),s=Object(r["resolveDirective"])("copy-to-clipboard");return Object(r["openBlock"])(),Object(r["createElementBlock"])("ol",_d,[Object(r["withDirectives"])(Object(r["createElementVNode"])("li",Dd,[Object(r["createVNode"])(l,{"show-container-row":e.showContainerRow,showBottom:!1,showDescription:!1,onFetchInstallInstructions:e.fetchInstallInstructionsSPA,ref:"trackingCodeCommon"},null,8,["show-container-row","onFetchInstallInstructions"])],512),[[r["vShow"],e.step1HasContent]]),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.setupStep2)},null,8,xd),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.fetchFollowStep3)},null,8,Bd),Object(r["createElementVNode"])("li",{textContent:Object(r["toDisplayString"])(e.fetchClickX("TagManager_CreateNewTrigger"))},null,8,Ld),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.fetchFollowStep5)},null,8,Ud),Object(r["createElementVNode"])("li",{textContent:Object(r["toDisplayString"])(e.fetchClickX("TagManager_CreateNewTrigger"))},null,8,Ad),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.setupStep7)},null,8,Pd),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.fetchFollowStep8)},null,8,Hd),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.fetchFollowStep9)},null,8,Fd),Object(r["createElementVNode"])("li",null,[Object(r["createElementVNode"])("span",{textContent:Object(r["toDisplayString"])(e.fetchFollowStep10)},null,8,Id),Object(r["createElementVNode"])("ol",$d,[Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.fetchFollowStep10a)},null,8,Gd),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.fetchFollowStep10b)},null,8,Rd)])]),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.fetchFollowStep11)},null,8,zd),Object(r["createElementVNode"])("li",{textContent:Object(r["toDisplayString"])(e.fetchClickX("General_Update"))},null,8,qd),Object(r["createElementVNode"])("li",{textContent:Object(r["toDisplayString"])(e.fetchFollowStep13)},null,8,Wd),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.fetchFollowStep14)},null,8,Xd),Object(r["createElementVNode"])("li",{textContent:Object(r["toDisplayString"])(e.fetchFollowStep15)},null,8,Kd),Object(r["createElementVNode"])("li",null,["react"===e.jsFramework?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:0,innerHTML:e.$sanitize(e.fetchFollowStep16React)},null,8,Jd)):(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:1,innerHTML:e.$sanitize(e.fetchFollowStep16SPA)},null,8,Yd)),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.installInstructions,(e,t)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{key:t},[Object(r["withDirectives"])(Object(r["createElementVNode"])("pre",{class:"codeblock",textContent:Object(r["toDisplayString"])(e.embedCode),ref_for:!0,ref:"codeblock"},null,8,Zd),[[s,{}]])]))),128))])])}var eg=Object(r["defineComponent"])({props:{showContainerRow:Boolean,jsFramework:String},components:{TrackingCodeCommon:fd},directives:{CopyToClipboard:g["CopyToClipboard"]},data(){return{setupStep1:"",setupStep2:"",setupStep7:"",installInstructions:[]}},methods:{fetchInstallInstructionsSPA(){var e,t;const a=this.$refs.trackingCodeCommon;if(this.installInstructions=[],null===a||void 0===a||!a.idContainer||null===a||void 0===a||!a.environment||null===a||void 0===a||null===(e=a.site)||void 0===e||!e.id)return;const n=this.linkTo("manageContainers",a.site.id,a.idContainer);this.setupStep1=Object(g["translate"])("TagManager_SPAFollowStep1","<br><strong>","</strong>",`<a href="${n}" target="_blank" rel="noreferrer noopener">`,"</a>");const i=this.linkTo("manageTriggers",a.site.id,a.idContainer);this.setupStep2=Object(g["translate"])("TagManager_SPAFollowStep2",`<a href="${i}" target="_blank" rel="noreferrer noopener">`,"</a>");const o=this.linkTo("manageTags",a.site.id,a.idContainer);this.setupStep7=Object(g["translate"])("TagManager_SPAFollowStep7",`<a href="${o}" target="_blank" rel="noreferrer noopener">`,"</a>"),a.isLoading=!0,g["AjaxHelper"].fetch({method:"TagManager.getContainerInstallInstructions",filter_limit:"-1",idContainer:null===a||void 0===a?void 0:a.idContainer,environment:null===a||void 0===a?void 0:a.environment,idSite:null===a||void 0===a||null===(t=a.site)||void 0===t?void 0:t.id,jsFramework:this.jsFramework}).then(e=>{this.installInstructions=e,Object(r["nextTick"])(()=>{const e=Array.isArray(this.$refs.codeblock)?this.$refs.codeblock:[this.$refs.codeblock];e.forEach(e=>{$(e).effect("highlight",{},1500)})})}).finally(()=>{a.isLoading=!1})},linkTo(e,t,a,n){let i=g["MatomoUrl"].stringify(Object.assign(Object.assign({},g["MatomoUrl"].urlParsed.value),{},{module:"TagManager",action:e,idSite:t,idContainer:a}));return n&&(i+="#?"+g["MatomoUrl"].stringify(n)),"?"+i},fetchClickX(e){return Object(g["translate"])("General_ClickX",Object(g["translate"])(e))}},computed:{step1HasContent(){const e=this.$refs.step1;return e&&""!==e.textContent},fetchFollowStep3(){return Object(g["translate"])("TagManager_SPAFollowStep3",`<strong>${Object(g["translate"])("TagManager_PageViewTriggerName")}</strong>`,Object(g["translate"])("TagManager_PageViewTriggerName"),Object(g["externalLink"])("https://matomo.org/faq/tag-manager/how-do-i-track-pageviews-of-my-website-using-matomo-tag-manager/#create-pageview-trigger"),"</a>")},fetchFollowStep5(){return Object(g["translate"])("TagManager_SPAFollowStep5",`<strong>${Object(g["translate"])("TagManager_HistoryChangeTriggerName")}</strong>`,Object(g["translate"])("TagManager_CategoryUserEngagement"))},fetchFollowStep8(){return Object(g["translate"])("TagManager_SPAFollowStep8",`<strong>${Object(g["translate"])("TagManager_PageViewTriggerName")}</strong>`,`<strong>${Object(g["translate"])("TagManager_MatomoTagName")}</strong>`,Object(g["translate"])("TagManager_PageViewTriggerName"),Object(g["externalLink"])("https://matomo.org/faq/tag-manager/how-do-i-track-pageviews-of-my-website-using-matomo-tag-manager/#create-pageview-tag"),"</a>")},fetchFollowStep9(){return Object(g["translate"])("TagManager_SPAFollowStep9",Object(g["translate"])("TagManager_ConfigureWhatTagDoes"),Object(g["translate"])("TagManager_CustomTitle"),"<strong>","</strong>")},fetchFollowStep10(){return Object(g["translate"])("TagManager_SPAFollowStep10",Object(g["translate"])("TagManager_CustomUrl"))},fetchFollowStep10a(){return Object(g["translate"])("TagManager_SPAFollowStep10a","<strong>","</strong>",Object(g["translate"])("TagManager_CustomUrl"))},fetchFollowStep10b(){return Object(g["translate"])("TagManager_SPAFollowStep10b",Object(g["translate"])("TagManager_CustomUrl"),"<strong>","</strong>")},fetchFollowStep11(){return Object(g["translate"])("TagManager_SPAFollowStep11",Object(g["translate"])("TagManager_ConfigureWhenTagDoes"),Object(g["translate"])("TagManager_FireTriggerTitle"),`<strong>${Object(g["translate"])("TagManager_HistoryChangeTriggerName")}</strong>`,`<strong>${Object(g["translate"])("TagManager_PageViewTriggerName")}</strong>`)},fetchFollowStep13(){return Object(g["translate"])("TagManager_SPAFollowStep13",Object(g["translate"])("TagManager_Publish"))},fetchFollowStep14(){return Object(g["translate"])("TagManager_SPAFollowStep14",Object(g["translate"])("TagManager_VersionName"),"<strong>","</strong>")},fetchFollowStep15(){return Object(g["translate"])("TagManager_SPAFollowStep15",Object(g["translate"])("TagManager_CreateVersionAndPublishRelease"))},fetchFollowStep16SPA(){return Object(g["translate"])("TagManager_SPAFollowStep16","&lt;/head&gt;",Object(g["externalLink"])("https://developer.matomo.org/guides/tagmanager/embedding"),"</a>")},fetchFollowStep16React(){return Object(g["translate"])("TagManager_ReactFollowStep16","<strong>","</strong>","<strong>App.js</strong>","<strong>React.useEffect</strong>","<strong>Hello World</strong>","<strong>React.js</strong>")}}});eg.render=Qd;var tg=eg;const ag={class:"nav-wrapper"},ng={class:"pull-right"},ig=Object(r["createElementVNode"])("svg",{class:"tm-icon tm-icon-close"},[Object(r["createElementVNode"])("use",{"xlink:href":"#tm-icon-close"})],-1),rg=[ig],og={class:"pull-right"},lg={"aria-hidden":"true",style:{position:"absolute",width:"0",height:"0",overflow:"hidden"},version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},sg=Object(r["createElementVNode"])("defs",null,[Object(r["createElementVNode"])("symbol",{id:"tm-icon-checkmark",viewBox:"0 0 32 32"},[Object(r["createElementVNode"])("path",{d:"M27 4l-15 15-7-7-5 5 12 12 20-20z"})])],-1),cg=[sg],dg={"aria-hidden":"true",style:{position:"absolute",width:"0",height:"0",overflow:"hidden"},version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},gg=Object(r["createElementVNode"])("symbol",{id:"tm-icon-close",viewBox:"0 0 32 32"},[Object(r["createElementVNode"])("path",{d:"M31.33 0.67c0.893 0.893 0.893 2.34 0 3.232l-27.427 27.427c-0.893 0.893-2.34\n          0.893-3.232 0s-0.893-2.34 0-3.232l27.427-27.427c0.892-0.893 2.34-0.893 3.232 0z"}),Object(r["createElementVNode"])("path",{d:"M0.67 0.67c0.893-0.893 2.34-0.893 3.232 0l27.427 27.427c0.893 0.892 0.893\n          2.34 0 3.232s-2.34 0.892-3.232 0l-27.427-27.427c-0.893-0.893-0.893-2.34 0-3.232z"})],-1),mg=[gg],bg={class:"page",style:{clear:"both"}},hg={key:0,id:"secondNavBar",class:"Menu--dashboard z-depth-1"},pg={class:"navbar",role:"menu",style:{padding:"0"}},ug={class:"menuTab",role:"menuitem"},Og={class:"item",style:{"font-weight":"normal"}},jg={key:0},vg=Object(r["createElementVNode"])("br",null,null,-1),Tg=Object(r["createElementVNode"])("br",null,null,-1),Vg=Object(r["createElementVNode"])("label",{for:"onlyfiredTags",class:"lbl-onlyfiredTags"},"Only fired tags",-1),Cg={key:0,style:{padding:"0 0 1rem 1.2rem"}},yg=["onClick","title"],fg={title:"This tag was fired"},Ng=Object(r["createElementVNode"])("svg",{class:"tm-icon tm-icon-checkmark"},[Object(r["createElementVNode"])("use",{"xlink:href":"#tm-icon-checkmark"})],-1),Eg=[Ng],kg={class:"pageWrap"},Mg={class:"home",id:"content"},Sg=Object(r["createElementVNode"])("h3",null,"Fired Tags",-1),wg={class:"entityTable"},_g=Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",null,"Action"),Object(r["createElementVNode"])("th",null,"Name"),Object(r["createElementVNode"])("th",null,"Type"),Object(r["createElementVNode"])("th",null,"Fired count")])],-1),Dg={key:0},xg=Object(r["createElementVNode"])("td",{colspan:"4"},"No tags",-1),Bg=[xg],Lg=Object(r["createElementVNode"])("h3",{style:{"margin-top":"30px"}},"Not Yet Fired Tags",-1),Ug={class:"entityTable"},Ag=Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",null,"Name"),Object(r["createElementVNode"])("th",null,"Type")])],-1),Pg=Object(r["createElementVNode"])("td",{colspan:"4"},"No tags",-1),Hg=[Pg],Fg=Object(r["createElementVNode"])("h3",null,"Triggers",-1),Ig={class:"entityTable"},$g=Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",null,"Name"),Object(r["createElementVNode"])("th",null,"Type")])],-1),Gg={key:0},Rg=Object(r["createElementVNode"])("td",{colspan:"4"},"No trigger",-1),zg=[Rg],qg={key:1},Wg=Object(r["createElementVNode"])("h3",null,"Pushed data by this event",-1),Xg={class:"entityTable"},Kg={style:{"word-break":"break-all"}},Jg=Object(r["createElementVNode"])("br",null,null,-1),Yg=Object(r["createElementVNode"])("h3",null,"Content after this event",-1),Zg={class:"entityTable"},Qg={style:{"word-break":"break-all"}},em={class:"entityTable"},tm=Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",null,"Name"),Object(r["createElementVNode"])("th",null,"Type"),Object(r["createElementVNode"])("th",null,"Value")])],-1),am={key:0},nm=Object(r["createElementVNode"])("td",{colspan:"3"},"No variables",-1),im=[nm],rm={style:{"word-break":"break-all"}},om={class:"entityTable"},lm=Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",null,"Time"),Object(r["createElementVNode"])("th",null,"Message")])],-1),sm={style:{"word-break":"break-all"}},cm=Object(r["createElementVNode"])("br",null,null,-1);function dm(e,t,a,n,i,o){var l,s,c,d,g,m;return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",null,[Object(r["createElementVNode"])("nav",null,[Object(r["createElementVNode"])("div",ag,[Object(r["createElementVNode"])("ul",null,[Object(r["createElementVNode"])("li",null,[Object(r["renderSlot"])(e.$slots,"logo")]),Object(r["createElementVNode"])("li",{class:Object(r["normalizeClass"])({active:"tags"===e.contentTab||!e.contentTab})},[Object(r["createElementVNode"])("a",{onClick:t[0]||(t[0]=t=>e.contentTab="tags")},"Tags")],2),Object(r["createElementVNode"])("li",{class:Object(r["normalizeClass"])({active:"triggers"===e.contentTab})},[Object(r["createElementVNode"])("a",{onClick:t[1]||(t[1]=t=>e.contentTab="triggers")},"Triggers")],2),Object(r["createElementVNode"])("li",{class:Object(r["normalizeClass"])({active:"variables"===e.contentTab})},[Object(r["createElementVNode"])("a",{onClick:t[2]||(t[2]=t=>e.contentTab="variables")},"Variables")],2),Object(r["createElementVNode"])("li",{class:Object(r["normalizeClass"])({active:"dataLayer"===e.contentTab})},[Object(r["createElementVNode"])("a",{onClick:t[3]||(t[3]=t=>e.contentTab="dataLayer")},"Data Layer")],2),Object(r["createElementVNode"])("li",{class:Object(r["normalizeClass"])({active:"logs"===e.contentTab})},[Object(r["createElementVNode"])("a",{onClick:t[4]||(t[4]=t=>e.contentTab="logs")},"Logs")],2),Object(r["createElementVNode"])("li",ng,[Object(r["createElementVNode"])("a",{id:"mtmCloseDebug",onClick:t[5]||(t[5]=t=>e.mtmCloseDebugWindow())},rg)]),Object(r["createElementVNode"])("li",og,[Object(r["createElementVNode"])("a",{id:"mtmUpdateDebugPosition",onClick:t[6]||(t[6]=t=>e.mtmUpdateDebugPosition())},Object(r["toDisplayString"])(e.positionText),1)])])])]),(Object(r["openBlock"])(),Object(r["createElementBlock"])("svg",lg,cg)),(Object(r["openBlock"])(),Object(r["createElementBlock"])("svg",dg,mg)),Object(r["createElementVNode"])("div",bg,["logs"!==e.contentTab?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",hg,[Object(r["createElementVNode"])("ul",pg,[Object(r["createElementVNode"])("li",ug,[Object(r["createElementVNode"])("span",Og,[Object(r["createTextVNode"])(" Events "),e.mtmEvents.length>0?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",jg,[vg,Tg,Object(r["withDirectives"])(Object(r["createElementVNode"])("input",{type:"checkbox",class:"onlyFiredTags-chk",name:"onlyfiredTags",id:"onlyfiredTags",value:"1","onUpdate:modelValue":t[7]||(t[7]=t=>e.onlyfiredTags=t),style:{"margin-right":"3.5px"}},null,512),[[r["vModelCheckbox"],e.onlyfiredTags]]),Vg])):Object(r["createCommentVNode"])("",!0)])]),0===e.mtmEvents.length?(Object(r["openBlock"])(),Object(r["createElementBlock"])("li",Cg,"No event executed")):Object(r["createCommentVNode"])("",!0),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.mtmEventsReversed,(t,a)=>{var n,i;return Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{class:Object(r["normalizeClass"])(["menuTab",{active:a===e.selectedEventIndex}]),role:"menuitem",key:a},[(t.tags||[]).length||!e.onlyfiredTags?(Object(r["openBlock"])(),Object(r["createElementBlock"])("a",{key:0,class:"item",onClick:a=>e.selectEvent(t.index0),title:`Time: ${t.time}. Trigger: ${null===(n=t.metTrigger)||void 0===n?void 0:n.name}`},[Object(r["createTextVNode"])(Object(r["toDisplayString"])(t.index)+": "+Object(r["toDisplayString"])(t.name)+" ",1),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",fg,Eg,512),[[r["vShow"],null===(i=t.tags)||void 0===i?void 0:i.length]])],8,yg)):Object(r["createCommentVNode"])("",!0)],2)}),128))])])):Object(r["createCommentVNode"])("",!0),Object(r["createElementVNode"])("div",kg,[Object(r["createElementVNode"])("div",Mg,[Object(r["withDirectives"])(Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.homeTabTitle),513),[[r["vShow"],"logs"!==e.contentTab]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Sg,Object(r["createElementVNode"])("table",wg,[_g,Object(r["createElementVNode"])("tbody",null,[null!==(l=e.selectedEvent)&&void 0!==l&&null!==(l=l.tags)&&void 0!==l&&l.length?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",Dg,Bg)),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])((null===(s=e.selectedEvent)||void 0===s?void 0:s.tags)||[],(e,t)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{key:t},[Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.action),1),Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.name),1),Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.type),1),Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.numExecuted),1)]))),128))])]),Lg,Object(r["createElementVNode"])("table",Ug,[Ag,Object(r["createElementVNode"])("tbody",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,Hg,512),[[r["vShow"],0===e.notFiredTags.length]]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.notFiredTags,(e,t)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{key:t},[Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.name),1),Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.type),1)]))),128))])])],512),[[r["vShow"],"tags"===e.contentTab||!e.contentTab]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Fg,Object(r["createElementVNode"])("table",Ig,[$g,Object(r["createElementVNode"])("tbody",null,[null!==(c=e.selectedEvent)&&void 0!==c&&c.metTrigger?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",Gg,zg)),null!==(d=e.selectedEvent)&&void 0!==d&&d.metTrigger?(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",qg,[Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.selectedEvent.metTrigger.name),1),Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.selectedEvent.metTrigger.type),1)])):Object(r["createCommentVNode"])("",!0)])])],512),[[r["vShow"],"triggers"===e.contentTab]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Wg,Object(r["createElementVNode"])("table",Xg,[Object(r["createElementVNode"])("tbody",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",Kg,Object(r["toDisplayString"])(e.selectedEventData),1)])])]),Jg,Yg,Object(r["createElementVNode"])("table",Zg,[Object(r["createElementVNode"])("tbody",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",Qg,Object(r["toDisplayString"])(e.selectedEventContainerDataLayer),1)])])])],512),[[r["vShow"],"dataLayer"===e.contentTab]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("table",em,[tm,Object(r["createElementVNode"])("tbody",null,[null!==(g=e.selectedEvent)&&void 0!==g&&null!==(g=g.container)&&void 0!==g&&null!==(g=g.variables)&&void 0!==g&&g.length?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",am,im)),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])((null===(m=e.selectedEvent)||void 0===m||null===(m=m.container)||void 0===m?void 0:m.variables)||[],(t,a)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{key:a},[Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(t.name),1),Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(t.type),1),Object(r["createElementVNode"])("td",rm,Object(r["toDisplayString"])(e.stringifySelectedVariable(t)),1)]))),128))])])],512),[[r["vShow"],"variables"===e.contentTab]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("table",om,[lm,Object(r["createElementVNode"])("tbody",null,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.mtmLogs,(e,t)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{key:t},[Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.time),1),Object(r["createElementVNode"])("td",sm,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.messages,(e,t)=>(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:t},[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e),1),cm]))),128))])]))),128))])])],512),[[r["vShow"],"logs"===e.contentTab]])])])])])}var gm,mm;window.mtmDbgData=Object(r["reactive"])({mtmEvents:(null===(gm=window.mtmDbgData)||void 0===gm?void 0:gm.mtmEvents)||[],mtmLogs:(null===(mm=window.mtmDbgData)||void 0===mm?void 0:mm.mtmLogs)||[]});const bm="mtmPreviewPosition",hm="Stick to Top",pm="Stick to Bottom";function um(){const e=new WeakSet;function t(t,a){if("object"===typeof a&&null!==a){if(e.has(a))return"";e.add(a)}return a}return t}var Om=Object(r["defineComponent"])({data(){return{contentTab:"tags",selectedEventIndex:0,onlyfiredTags:!1,positionText:"top"===Object(g["getCookie"])(bm)?pm:hm}},methods:{mtmUpdateDebugPosition(){const e=6048e5,t=Object(g["getCookie"])(bm),a="top"===t?"bottom":"top";Object(g["setCookie"])(bm,a,e);const n=window.parent.document.getElementById("mtmDebugFrame");"top"===a?(this.positionText=pm,n.classList.remove("mtmStickyBottom"),n.classList.add("mtmStickyTop")):(this.positionText=hm,n.classList.remove("mtmStickyTop"),n.classList.add("mtmStickyBottom"))},mtmCloseDebugWindow(){const e=window.parent.document.getElementById("mtmDebugFrame");e&&(e.style.display="none")},selectEvent(e){this.mtmEvents[e]&&(this.selectedEventIndex=e)},stringifySelectedVariable(e){return JSON.stringify(e.value,um())}},computed:{homeTabTitle(){var e;if(null===(e=this.selectedEvent)||void 0===e||!e.container)return"";const t=this.selectedEvent.container.versionName||"Draft version",a=this.selectedEvent.container.id,n=this.selectedEventIndex+1;return`Event ${n}: ${this.selectedEvent.name} (${a} - ${t})`},notFiredTags(){var e;if(null===(e=this.selectedEvent)||void 0===e||!e.container)return[];const t=this.selectedEventIndex,a=[];this.mtmEvents.forEach((e,n)=>{n>t||a.push(...e.tags.map(e=>e.name))});const n=[];return this.selectedEvent.container.tags.forEach(e=>{-1===a.indexOf(e.name)&&n.push(e)}),n},selectedEvent(){return this.mtmEvents[this.selectedEventIndex]},mtmEvents(){return window.mtmDbgData.mtmEvents},mtmEventsReversed(){const e=[...this.mtmEvents];return e.reverse(),e},mtmLogs(){return window.mtmDbgData.mtmLogs},selectedEventData(){var e;return(null===(e=this.selectedEvent)||void 0===e?void 0:e.eventData)&&JSON.stringify(this.selectedEvent.eventData,um())},selectedEventContainerDataLayer(){var e;return(null===(e=this.selectedEvent)||void 0===e||null===(e=e.container)||void 0===e?void 0:e.dataLayer)&&JSON.stringify(this.selectedEvent.container.dataLayer,um())}}});Om.render=dm;var jm=Om;const vm={class:"copyMtmObjectDialog"},Tm=["innerHTML"],Vm=["innerHTML"];function Cm(e,t,a,n,i,o){const l=Object(r["resolveComponent"])("Field"),s=Object(r["resolveDirective"])("form");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",vm,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.getCopyDialogTitle),1),Object(r["createElementVNode"])("p",null,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.getCopyDescription)+"  ",1),Object(r["createElementVNode"])("span",{innerHTML:e.$sanitize(e.getLearnMoreLink),class:"learnMore"},null,8,Tm)]),Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"site",name:"destinationSite",title:e.translate("TagManager_ChooseWebsite"),modelValue:e.site,"onUpdate:modelValue":t[0]||(t[0]=t=>e.site=t)},null,8,["title","modelValue"]),"container"!==e.copyType.toLowerCase()?(Object(r["openBlock"])(),Object(r["createBlock"])(l,{key:0,uicontrol:"select",name:"idDestinationContainer",options:e.containerOptions,disabled:e.containerOptions.length<=1,"full-width":!0,title:e.translate("TagManager_Container"),modelValue:e.idDestinationContainer,"onUpdate:modelValue":t[1]||(t[1]=t=>e.idDestinationContainer=t)},null,8,["options","disabled","title","modelValue"])):Object(r["createCommentVNode"])("",!0),"container"===e.copyType.toLowerCase()?(Object(r["openBlock"])(),Object(r["createElementBlock"])("p",{key:1,class:"copyNote",innerHTML:e.$sanitize(e.getCopyContainerNote)},null,8,Vm)):Object(r["createCommentVNode"])("",!0),Object(r["createElementVNode"])("button",{class:"btn",onClick:t[2]||(t[2]=(...t)=>e.performCopy&&e.performCopy(...t))},Object(r["toDisplayString"])(e.translate("General_Copy")),1)])),[[s]])])}var ym=Object(r["defineComponent"])({props:{defaultSite:{type:Object,required:!0},copyType:{type:String,required:!0},copyNonce:{type:String,required:!1,default:""},idToCopy:{type:[String,Number],required:!0},idSourceContainer:{type:String,required:!1,default:""},idContainerVersion:{type:Number,required:!1,default:0}},directives:{Form:m["Form"]},components:{Field:m["Field"]},data(){return{site:this.defaultSite,idDestinationContainer:"",containerOptions:[]}},created(){this.onSiteChange(),this.idDestinationContainer=this.idSourceContainer},watch:{site(){this.onSiteChange()}},methods:{onSiteChange(){var e;"container"!==this.copyType.toLowerCase()&&(this.containerOptions=[],this.idDestinationContainer="",null!==(e=this.site)&&void 0!==e&&e.id&&g["AjaxHelper"].fetch({method:"TagManager.getContainers",filter_limit:"-1",idSite:this.site.id}).then(e=>{if(this.containerOptions=[],null===e||void 0===e||!e.length)return this.idDestinationContainer="",void this.containerOptions.push({key:"",value:this.translate("TagManager_NoContainersFound")});e.forEach(e=>{this.idDestinationContainer||(this.idDestinationContainer=e.idcontainer),this.containerOptions.push({key:e.idcontainer,value:e.name})})}))},performCopy(){var e;const t={module:"TagManager",action:"",idSite:this.defaultSite.id,idDestinationSite:null!==(e=this.site)&&void 0!==e&&e.id?this.site.id:0,nonce:this.copyNonce,idDestinationContainer:"",idSourceContainer:"",idContainerVersion:0,idContainer:0,idTag:0,idTrigger:0,idVariable:0};switch(this.copyType.toLowerCase()){case"container":t.action="copyContainer",t.idContainer=this.idToCopy;break;case"tag":t.action="copyTag",t.idTag=this.idToCopy;break;case"trigger":t.action="copyTrigger",t.idTrigger=this.idToCopy;break;case"variable":t.action="copyVariable",t.idVariable=this.idToCopy;break;default:throw Error("Unrecognised copy object type.")}this.idDestinationContainer&&(t.idDestinationContainer=this.idDestinationContainer),this.idSourceContainer&&(t.idSourceContainer=this.idSourceContainer),this.idContainerVersion>0&&(t.idContainerVersion=this.idContainerVersion),g["AjaxHelper"].fetch(t).then(e=>{if(!e||!e.isSuccess||!e.urlToNewCopy){const e=Object(g["translate"])("General_ErrorRequest","",""),t=g["NotificationsStore"].show({message:e,id:"CopyDialogResultNotification",context:"error",type:"transient"});return g["NotificationsStore"].scrollToNotification(t),void window.Piwik_Popover.close()}this.reloadEntityStore(),this.displaySuccessNotification(e.urlToNewCopy),window.Piwik_Popover.close()})},reloadEntityStore(){switch(this.copyType.toLowerCase()){case"container":_l.reload();break;case"tag":Fi.reload(this.idSourceContainer,this.idContainerVersion);break;case"trigger":fa.reload(this.idSourceContainer,this.idContainerVersion);break;case"variable":Ge.reload(this.idSourceContainer,this.idContainerVersion);break;default:throw Error("Unrecognised copy object type.")}},displaySuccessNotification(e){const t="TagManager_CopyXSuccess";let a="";switch(this.copyType.toLowerCase()){case"container":a="TagManager_ContainerLowercase";break;case"tag":a="TagManager_TagLowercase";break;case"trigger":a="TagManager_TriggerLowercase";break;case"variable":a="TagManager_VariableLowercase";break;default:throw Error("Unrecognised copy object type.")}const n=Object(g["translate"])(t,[`<a href="${e}">`,Object(g["translate"])(a),"</a>"]),i=g["NotificationsStore"].show({message:n,id:"CopyDialogResultNotification",context:"success",type:"transient"});g["NotificationsStore"].scrollToNotification(i)}},computed:{getCopyDialogTitle(){let e="";switch(this.copyType.toLowerCase()){case"container":e=Object(g["translate"])("TagManager_Container");break;case"tag":e=Object(g["translate"])("TagManager_Tag");break;case"trigger":e=Object(g["translate"])("TagManager_Trigger");break;case"variable":e=Object(g["translate"])("TagManager_Variable");break;default:throw Error("Unrecognised copy object type.")}return Object(g["translate"])("TagManager_CopyX",e)},getCopyDescription(){if("container"===this.copyType.toLowerCase())return Object(g["translate"])("TagManager_CopyContainerDescription");let e="";switch(this.copyType.toLowerCase()){case"tag":e=Object(g["translate"])("TagManager_TagLowercase");break;case"trigger":e=Object(g["translate"])("TagManager_TriggerLowercase");break;case"variable":e=Object(g["translate"])("TagManager_VariableLowercase");break;default:throw Error("Unrecognised copy object type.")}return Object(g["translate"])("TagManager_CopyXDescription",e)},getCopyContainerNote(){return Object(g["translate"])("TagManager_CopyContainerNote","<strong>","</strong>")},getCopyUrl(){var e;const t={module:"TagManager",action:"",idSite:this.defaultSite.id,idDestinationSite:null!==(e=this.site)&&void 0!==e&&e.id?this.site.id:0,nonce:this.copyNonce,idDestinationContainer:"",idSourceContainer:"",idContainerVersion:0,idContainer:0,idTag:0,idTrigger:0,idVariable:0};switch(this.copyType.toLowerCase()){case"container":t.action="copyContainer",t.idContainer=this.idToCopy;break;case"tag":t.action="copyTag",t.idTag=this.idToCopy;break;case"trigger":t.action="copyTrigger",t.idTrigger=this.idToCopy;break;case"variable":t.action="copyVariable",t.idVariable=this.idToCopy;break;default:throw Error("Unrecognised copy object type.")}return this.idDestinationContainer&&(t.idDestinationContainer=this.idDestinationContainer),this.idSourceContainer&&(t.idSourceContainer=this.idSourceContainer),this.idContainerVersion>0&&(t.idContainerVersion=this.idContainerVersion),"?"+g["MatomoUrl"].stringify(t)},getLearnMoreLink(){let e="";switch(this.copyType.toLowerCase()){case"container":e="https://matomo.org/faq/tag-manager/how-to-copy-a-matomo-tag-manager-container-and-its-components";break;case"tag":e="https://matomo.org/faq/tag-manager/how-to-copy-a-tag-in-matomo-tag-manager ";break;case"trigger":e="https://matomo.org/faq/tag-manager/how-to-copy-a-trigger-in-matomo-tag-manager";break;case"variable":e="https://matomo.org/faq/tag-manager/how-to-copy-a-variable-in-matomo-tag-manager";break;default:throw Error("Unrecognised copy object type.")}const t=Object(g["externalLink"])(e);return Object(g["translate"])("TagManager_LearnMoreFullStop",t,"</a>")}}});ym.render=Cm;var fm=ym;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=TagManager.umd.min.js.map